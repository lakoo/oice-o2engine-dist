"use strict";$.extend(Tag.actions.trans.rules,{zoom_out_to:{type:"FLOAT"},zoom_in_from:{type:"FLOAT"},zoom_in_draw_count:{type:"INT"}}),Tag.actions.trans.methods.zoom=new TransMethod({prepare:function(t){this.beginning=Date.now(),this.tempCanvas=document.createElement("canvas"),this.tempCanvas.width=config.scWidth,this.tempCanvas.height=config.scHeight,this.tempContext=this.tempCanvas.getContext("2d"),this.zoomOutTo=.5,this.zoomInFrom=1.5,this.drawCount=10,"zoom_out_to"in t&&(this.zoomOutTo=t.zoom_out_to),"zoom_in_from"in t&&(this.zoomInFrom=t.zoom_in_from),"zoom_in_draw_count"in t&&(this.drawCount=t.zoom_in_draw_count)},transit:function(t,e,a,n){var i=(Date.now()-this.beginning)/t.time;i>1&&(i=1);for(var s=n.getContext("2d"),o=this.drawCount,r=1-(1-this.zoomOutTo)*i,m=0;o>m;m++){var h=m/(o-1),d=1-(1-r)*h,c=e.width*d,g=e.height*d,l=(e.width-c)/2,p=(e.height-g)/2;s.globalAlpha=1-h,s.drawImage(e,0,0,e.width,e.height,l,p,c,g)}this.tempContext.clearRect(0,0,this.tempCanvas.width,this.tempCanvas.height);for(var u=this.zoomInFrom-(this.zoomInFrom-1)*i,f=0;o>f;f++){var w=f/(o-1),v=1+(u-1)*w,T=a.width*v,y=a.height*v,b=(a.width-T)/2,C=(a.height-y)/2;this.tempContext.globalAlpha=1-w,this.tempContext.drawImage(a,0,0,a.width,a.height,b,C,T,y)}s.save(),s.globalAlpha=i,s.drawImage(this.tempCanvas,0,0,this.tempCanvas.width,this.tempCanvas.height),s.restore()},teardown:function(){delete this.beginning,delete this.tempCanvas,delete this.zoomOutTo,delete this.zoomInFrom,delete this.drawCount}}),$.extend(Tag.actions.trans.rules,{translatex:{type:"FLOAT",defaultValue:0},translatey:{type:"FLOAT",defaultValue:-40},zoomscale:{type:"FLOAT",defaultValue:1.5}}),Tag.actions.trans.methods.fadethrough=new TransMethod({canRun:function(){return supportCssProperty(["animationName","animationDuration"])},transitAllLayers:function(t,e,a,n){this.cssTag=document.createElement("style"),this.cssTag.type="text/css";var i="@-webkit-keyframes fadethrough {0% { -webkit-transform: scale(1) translate(0,0);opacity: 1;} 100% { -webkit-transform: scale("+t.zoomscale+") translate("+t.translatex+"px,"+t.translatey+"px); opacity: 0; }};";i+=i.replace(/-webkit-/g,"-moz-")+i.replace(/-webkit-/g,"-o-")+i.replace(/-webkit-/g,"");var s=document.createTextNode(i);this.cssTag.appendChild(s),document.getElementsByTagName("head")[0].appendChild(this.cssTag),$(a).css({"animation-duration":t.time+"ms","animation-timing-function":"ease-in-out","animation-fill-mode":"both","animation-name":"fadethrough","z-index":"2"}),$(e).css("z-index","1")},teardownAllLayers:function(t,e,a,n){document.getElementsByTagName("head")[0].removeChild(this.cssTag),$(a).css({"animation-duration":"","animation-timing-function":"","animation-fill-mode":"","animation-name":"","z-index":""}),$(e).css("z-index",""),delete this.cssTag}}),Tag.actions.trans.methods.multiflip=new TransMethod({canRun:function(){return supportCssProperty(["animationName","perspective"])},transitAllLayers:function(t,e,a,n){this.cssTag=document.createElement("style"),this.cssTag.type="text/css";var i="@-webkit-keyframes flip-out { \n0% { \n-webkit-transform:rotateX(0deg); \n} 100% { \n-webkit-transform:rotateX(90deg) \n}} \n@-webkit-keyframes flip-in { \n0% { -webkit-transform:rotateX(-90deg); m} 100% { \n-webkit-transform:rotateX(0deg); \n} \n} ";i+=i.replace(/-webkit-/g,"-moz-")+i.replace(/-webkit-/g,"-o-")+i.replace(/-webkit-/g,"");var s=document.createTextNode(i);this.cssTag.appendChild(s),document.getElementsByTagName("head")[0].appendChild(this.cssTag),$(a).css({display:"none"}),$(e).css({display:"none"}),$(n).css("perspective","1000px");var o=10,r=Math.round(a.width/o),m=.08,h=t.time/((o-1)*m+1),d=h*m;this.foreCanvases=[],this.backCanvases=[];for(var c=0;o>c;c++){var g=document.createElement("canvas"),l=document.createElement("canvas");g.height=l.height=a.height,g.width=l.width=a.width/o,$([g,l]).css({position:"absolute",left:r*c+"px",top:"0","animation-duration":h/2+"ms","animation-fill-mode":"both"}).appendTo(n),$(g).css({"animation-name":"flip-out","animation-delay":c*d+"ms","animation-timing-function":"ease-in"}),$(l).css({"animation-name":"flip-in","animation-delay":c*d+h/2+"ms","animation-timing-function":"ease-out"}),this.foreCanvases.push(g),this.backCanvases.push(l)}var p=Date.now(),u=this;this.syncCanvases=function(t){for(var n=0;n<u.foreCanvases.length;n++){var i=Date.now()-p,s=u.foreCanvases[n],o=u.backCanvases[n];(n*d+h/2>i||t===!0)&&s.getContext("2d").drawImage(a,r*n,0,r,a.height,0,0,r,a.height),(i>=n*d+h/2||t===!0)&&o.getContext("2d").drawImage(e,r*n,0,r,e.height,0,0,r,e.height)}},$([a,e]).on("draw",this.syncCanvases),this.syncCanvases(!0)},teardownAllLayers:function(t,e,a,n){$([a,e]).off("draw",this.syncCanvases),document.getElementsByTagName("head")[0].removeChild(this.cssTag),delete this.cssTag,$(a).css({display:"block"}),$(e).css({display:"block"}),$(n).css("perspective","");for(var i=0;i<this.foreCanvases;i++)$([this.foreCanvases[i],this.backCanvases[i]]).remove();delete this.foreCanvases,delete this.backCanvases,delete this.syncCanvases}}),Tag.actions.trans.methods.cube=new TransMethod({canRun:function(){return browser.isIE?!1:supportCssProperty(["animationName","perspective"])},transitAllLayers:function(t,e,a,n){this.cssTag=document.createElement("style"),this.cssTag.type="text/css";var i="@-webkit-keyframes cube-up {0%{ -webkit-transform:rotateX(0deg) translateZ(0);}100%{-webkit-transform:rotateX(90deg) translateZ("+config.scHeight+"px);}};";i+=i.replace(/-webkit-/g,"-moz-")+i.replace(/-webkit-/g,"-o-")+i.replace(/-webkit-/g,"");var s=document.createTextNode(i);this.cssTag.appendChild(s),document.getElementsByTagName("head")[0].appendChild(this.cssTag),this.rotateDiv=document.createElement("div"),$(e).css({"transform-origin":"50% 0 0",transform:"rotateX(-90deg) translateZ("+config.scHeight+"px)"}),$(a).css({"transform-origin":"50% 0 0"}),$(n).css({width:$(n).width()+"px",height:$(n).height()+"px",perspective:"1000px","transform-style":"preserve-3d","transform-origin":"50% 0"}).append(this.rotateDiv),$(this.rotateDiv).css({width:$(n).width()+"px",height:$(n).height()+"px","transform-origin":"50% 100%","transform-style":"preserve-3d","animation-duration":t.time+"ms","animation-timing-function":"ease-in-out","animation-fill-mode":"both","animation-name":"cube-up"}).append(e).append(a)},teardownAllLayers:function(t,e,a,n){document.getElementsByTagName("head")[0].removeChild(this.cssTag),delete this.cssTag,$(e).css({"transform-origin":"",transform:""}),$(a).css({"transform-origin":""}),$(n).append(a).append(e),$(this.rotateDiv).remove(),delete this.rotateDiv}}),Tag.actions.trans.methods.blindup=new TransMethod({prepare:function(t){this.beginning=Date.now()},transit:function(t,e,a,n){var i=n.getContext("2d");i.clearRect(0,0,n.width,n.height);var s=(Date.now()-this.beginning)/t.time;s>1&&(s=1);var o=10,r=a.height/o,m=r*(1-s);i.drawImage(a,0,0,a.width,a.height);for(var h=0;o>h;h++){var d=r*h;m>0&&i.drawImage(e,0,d,e.width,m,0,d,e.width,m)}},teardown:function(){delete this.beginning}}),Tag.actions.trans.methods.blinddown=new TransMethod({prepare:function(t){this.beginning=Date.now()},transit:function(t,e,a,n){var i=n.getContext("2d");i.clearRect(0,0,n.width,n.height);var s=(Date.now()-this.beginning)/t.time;s>1&&(s=1);var o=10,r=a.height/o,m=r*s;i.drawImage(e,0,0,e.width,e.height);for(var h=0;o>h;h++){var d=r*h;m>0&&i.drawImage(a,0,d,a.width,m,0,d,a.width,m)}},teardown:function(){delete this.beginning}}),Tag.actions.trans.methods.toss=new TransMethod({canRun:function(){return supportCssProperty(["animationName","animationDuration"])},transitAllLayers:function(t,e,a,n){this.cssTag=document.createElement("style"),this.cssTag.type="text/css";var i="@-webkit-keyframes toss {0% { -webkit-transform: rotate(-30deg) scale(1.3) translate(-20px,-250px); opacity: 0; } 100% { transform: scale(1) translate(0,0) rotate(0deg); opacity: 1; }};";i+=i.replace(/-webkit-/g,"-moz-")+i.replace(/-webkit-/g,"-o-")+i.replace(/-webkit-/g,"");var s=document.createTextNode(i);this.cssTag.appendChild(s),document.getElementsByTagName("head")[0].appendChild(this.cssTag),$(e).css({"animation-duration":t.time+"ms","animation-timing-function":"ease-in-out","animation-fill-mode":"both","animation-name":"toss"})},teardownAllLayers:function(t,e,a,n){document.getElementsByTagName("head")[0].removeChild(this.cssTag),$(e).css({"animation-duration":"","animation-timing-function":"","animation-fill-mode":"","animation-name":""}),delete this.cssTag}}),Tag.actions.trans.methods.horizontalflip=new TransMethod({canRun:function(){return supportCssProperty(["animationName","animationDuration","animationFillMode","perspective"])},transitAllLayers:function(t,e,a,n){this.cssTag=document.createElement("style"),this.cssTag.type="text/css";var i="@-webkit-keyframes flip-in {0%{-webkit-transform:rotateX(-90deg);}100%{-webkit-transform:rotateX(0deg);}} \n@-webkit-keyframes flip-out {0%{-webkit-transform:rotateX(0deg);}100%{-webkit-transform:rotateX(90deg);}};";i+=i.replace(/-webkit-/g,"-moz-")+i.replace(/-webkit-/g,"-o-")+i.replace(/-webkit-/g,"");var s=document.createTextNode(i);this.cssTag.appendChild(s),document.getElementsByTagName("head")[0].appendChild(this.cssTag),$(n).css("perspective","1000px"),$(a).css({"animation-duration":t.time/2+"ms","animation-timing-function":"ease-in","animation-fill-mode":"both","animation-name":"flip-out"}),$(e).css({"animation-duration":t.time/2+"ms","animation-delay":t.time/2+"ms","animation-timing-function":"ease-out","animation-fill-mode":"both","animation-name":"flip-in"})},teardownAllLayers:function(t,e,a,n){document.getElementsByTagName("head")[0].removeChild(this.cssTag),$(n).css("perspective",""),$(a).css({"animation-duration":"","animation-timing-function":"","animation-fill-mode":"","animation-name":""}),$(e).css({"animation-duration":"","animation-delay":"","animation-timing-function":"","animation-fill-mode":"","animation-name":""}),delete this.cssTag}});