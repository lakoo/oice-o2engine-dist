"use strict";var _Overlay;!function(){function t(t,o,e,n){function i(){c&&s&&(a.call(r,e,n),o())}var r=$("<div>").css({left:"0",top:"0",width:"100%",height:"100%",position:"absolute",zIndex:20});r.appendTo("body");var a,c=!1,s=!1;return _Overlay=function(t){_Overlay=void 0,s=!0,a=t,i()},r.load(t,function(){c=!0,i()}),r}Tag.actions.showoverlay=new TagAction({rules:{filename:{type:"STRING",required:!0},event:{type:/fullscreen|element|none/,defaultValue:"none"},autoresize:{type:"BOOLEAN",defaultValue:!1}},action:function(t){var o=this,e=this.isOpen();this.isOverlayOpen=!1,this.isPerformingCallback=!1;var n=Tag.actions.showoverlay.showOverlay.call(this,t,function(){e||o.done()},function(){if(!e)return void n();for(var t=[],i=0;i<arguments.length;i++)t.push(arguments[i]);return Tag.actions.showoverlay.performCallback.call(o,n,t)});return this.exitScope=n,this.conductor.wait("overlay callback"),1},closeAction:function(t){return t.isOverlayOpen?(t.isPerformingCallback=!1,this.conductor.wait("overlay callback"),this.keepStack(),1):0},performCallback:function(t,o){function e(){n.conductor.tagActions.close=i}var n=this;if(this.isPerformingCallback)return!1;this.isPerformingCallback=!0;var i=this.conductor.tagActions.close;this.conductor.tagActions.close=new TagAction({action:function(){return t(),e(),n.jumpToTag(n.getCloseTag()),0}}),this.jumpToTag(this,!0);var r=this.makeScopeVars(o);return this.setScopeVars(r),this.conductor.trigger("overlay callback"),!0},showOverlay:function(o,e,n){function i(t){("fullscreen"===o.event||"element"===o.event&&$.contains(l[0],t.target)||l.is(t.target))&&t.stopPropagation()}function r(t){$(o2).bindFirst("click",i),$(o2).bindFirst("rclick",i),u.forEach(function(t){l.on(t,i)})}function a(){$(o2).off("click",i),$(o2).off("rclick",i),u.forEach(function(t){l.off(t,i)})}function c(){l.css({transform:$("#main-wrapper").css("transform"),left:$("#main-wrapper").css("left"),top:$("#main-wrapper").css("top"),transformOrigin:$("#main-wrapper").css("transformOrigin"),bottom:"",right:""})}if(!this.isOverlayOpen){this.isOverlayOpen=!0;var s=function(){r(),e()},l=t("plugin/html_overlay/html/"+o.filename,s,n,o),u="touchstart touchmove touchcancel touchend mousemove mouseup mousedown mouseleave".split(" ");return o.autoresize&&($(window).on("resize",c),c()),function(){l.remove(),a(),o.autoresize&&$(window).off("resize",c),this.isOverlayOpen=!1}.bind(this)}}})}();