"use strict";!function(){if("function"==typeof require){var e=require("fs"),t=require("path"),r=function(){var r=require("os").platform();if("darwin"==r)this.saveDir=t.join(process.env.HOME,"つるみく-Another-");else{if("win32"!=r)throw"サポートされていないプラットフォームです";this.saveDir=t.join(process.env.HOMEPATH,"Documents","つるみく-Another-")}var n=this;e.exists(this.saveDir,function(t){t||e.mkdir(n.saveDir,function(e){e&&console.error(e)})})};r.prototype=Object.create(Tag.actions.save.adapters.LocalAdapter.prototype),$.extend(r.prototype,{setItem:function(r,n){r=r.toString(),n=n.toString();var i=$.Deferred(),o=t.join(this.saveDir,r);return e.writeFile(o,n,function(e){e?i.reject(e):i.resolve()}),i.promise()},getItem:function(r){r=r.toString();var n=$.Deferred(),i=t.join(this.saveDir,r);return e.readFile(i,function(e,t){n.resolve(t?t.toString():void 0)}),n.promise()},deleteItem:function(r){r=r.toString();var n=$.Deferred(),i=t.join(this.saveDir,r);return e.unlink(i,function(e){n.resolve()}),n.promise()},getGlobalSaveData:function(t){function r(){var t=$.Deferred();return e.readdir(n.saveDir,function(e,r){if(e)return t.reject(e);var i=new RegExp(config.gameID+"_([0-9]+)"),o={},a=[];r.forEach(function(e){function t(e,t){o[s[1]]||(o[s[1]]={}),o[s[1]][e]=t}var s=e.match(i);!s||r.indexOf(e+"_date")<0||r.indexOf(e+"_caption")<0||a.push(n.getItem(e+"_date").done(function(e){t("date",new Date(1e3*Number(e)))}),n.getItem(e+"_caption").done(function(e){t("caption",e)}),n.getItem(e+"_screen").done(function(e){t("snapshot",e)}))}),$.when.apply($,a).done(function(){t.resolve(o)})}),t.promise()}var n=this,i=config.gameID+"_sf",o=this.getItem(i).then(function(e){try{return JSON.parse(e)}catch(t){return $.Deferred().reject(t)}});return $.when(o,r())}}),Tag.actions.save.adapters.FileAdapter=r,o2.currentSaveAdapter=new r}}();