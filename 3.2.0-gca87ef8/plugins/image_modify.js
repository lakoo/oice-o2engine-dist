"use strict";Tag.actions.image_modify=new TagAction({rules:{layer:{type:"IMAGE_LAYER",required:!0},page:{type:/fore|back/,defaultValue:"fore"},grayscale:{type:"BOOLEAN"},rgamma:{type:"FLOAT"},ggamma:{type:"FLOAT"},bgamma:{type:"FLOAT"},rfloor:{type:"INT"},gfloor:{type:"INT"},bfloor:{type:"INT"},rceil:{type:"INT"},gceil:{type:"INT"},bceil:{type:"INT"},mcolor:{type:"COLOR"},mopacity:{type:"INT"},shadow:{type:"COLOR"},shadowopacity:{type:"INT"},shadowx:{type:"INT"},shadowy:{type:"INT"},shadowblur:{type:"FLOAT"},clipleft:{type:"INT"},cliptop:{type:"INT"},clipwidth:{type:"INT"},clipheight:{type:"INT"},flipud:{type:"BOOLEAN"},fliplr:{type:"BOOLEAN"},visible:{type:"BOOLEAN"},left:{type:"INT"},top:{type:"INT"},pos:{type:/left|left_center|center|right_center|right|l|lc|c|rc|r/},opacity:{type:"INT"},o2_zoom:{type:/[0-9]+(:[0-9]+)?/},o2_rotate:{type:"FLOAT"},o2_orx:{type:"FLOAT"},o2_ory:{type:"FLOAT"},o2_blur:{type:"INT"},o2_blurx:{type:"INT"},o2_blury:{type:"INT"},o2_blurmode:{type:/linear|constantalpha/}},action:function(t){var e=t.layer[t.page],o=e.images[0];if(!o)return this.warn("No image to modify"),0;var i={},r={rgamma:"rGamma",ggamma:"gGamma",bgamma:"bGamma",rfloor:"rFloor",gfloor:"gFloor",bfloor:"bFloor",rceil:"rCeil",gceil:"gCeil",bceil:"bCeil",mcolor:"tintColor",mopacity:"tintOpacity",shadowopacity:"shadowOpacity",shadowx:"shadowX",shadowy:"shadowY",shadowblur:"shadowBlur",clipleft:"clipLeft",cliptop:"clipTop",clipwidth:"clipWidth",clipheight:"clipHeight",flipud:"flipUD",fliplr:"flipLR",o2_blurx:"blurX",o2_blury:"blurY",o2_blurmode:"blurMode"};for(var a in t)if(-1==["storage","layer","page","allowfail","left","top","pos","o2_zoom","o2_rotate","o2_orx","o2_ory"].indexOf(a)){var c=r[a]||a;i[c]=t[a]}if("opacity"in i&&(e.opacity=i.opacity/255,i.opacity=1),"visible"in i&&(e.visible=i.visible,i.visible=!0),"shadowOpacity"in i&&(i.shadowOpacity/=255),"tintOpacity"in i&&(i.tintOpacity/=255),"o2_blur"in t&&("o2_blurx"in t||(i.blurX=t.o2_blur),"o2_blury"in t||(i.blurY=t.o2_blur)),"pos"in t){switch(t.pos){case"left":case"l":e.rect.x=config.scPositionX_left-o.rect.width/2;break;case"left_center":case"lc":e.rect.x=config.scPositionX_left_center-o.rect.width/2;break;case"center":case"c":e.rect.x=config.scPositionX_center-o.rect.width/2;break;case"right_center":case"rc":e.rect.x=config.scPositionX_right_center-o.rect.width/2;break;case"right":case"r":e.rect.x=config.scPositionX_right-o.rect.width/2}e.rect.y=config.scHeight-o.rect.height}else"left"in t&&(e.rect.x=t.left),"top"in t&&(e.rect.y=t.top);if(e.rect.width=Math.max(config.scWidth,o.rect.width),e.rect.height=Math.max(config.scHeight,o.rect.height),e.setRect(),"o2_zoom"in t){var l=1,p=1,s=t.o2_zoom.split(":");if(s.length>=2?(l=parseFloat(s[0]),p=parseFloat(s[1])):l=p=parseFloat(s[0]),isNaN(l)||isNaN(p))return this.error("o2_zoomが正しくありません。"),0;e.scaleX=l/100,e.scaleY=p/100}"o2_rotate"in t&&(e.rotation=t.o2_rotate/180*Math.PI),"o2_orx"in t?e.transformOrigin.x=t.o2_orx:e.transformOrigin.x=o.rect.width/2,"o2_ory"in t?e.transformOrigin.y=t.o2_ory:e.transformOrigin.y=o.rect.height/2;for(var y in i)o.options[y]=i[y];return e.draw(o),0}});