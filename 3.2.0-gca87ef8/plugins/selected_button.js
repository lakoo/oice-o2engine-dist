"use strict";!function(){["button","o2_sysbutton"].forEach(function(e){Tag.actions[e].rules.graphic_select={type:"STRING"},Tag.actions[e].rules.select_observe={type:"STRING"}});var originalDrawOnContext=Button.prototype.drawOnContext;Button.prototype.drawOnContext=function(){var e=this.image;this.selected&&(this.image=this.selectedImage);var t=originalDrawOnContext.apply(this,arguments);return this.image=e,t};var originalKAGImport=KAGButton.prototype.importFromKAGArgs;KAGButton.prototype.importFromKAGArgs=function(e){if(originalKAGImport.apply(this,arguments),e&&"graphic_select"in e&&"select_observe"in e){var t=this;ResourceLoader.loadImage(e.graphic_select,!1).done(function(r){function o(){return Boolean((0,eval)(e.select_observe))!=Boolean(t.selected)}function n(){for(var e=o2.foreLayers.messageLayers.concat(o2.backLayers.messageLayers),r=0;r<e.length;r++){var i=e[r];if(-1!=i.buttons.indexOf(t))return t.selected=!t.selected,void i.redrawRect(t.rect)}Observer.unobserve(o,n)}t.selectedImage=r,Observer.observe(o,n),t.click=function(e){return function(){var t=e.apply(this,arguments);return Observer.perform(n),t}}(t.click)})}},KAGButton.prototype.importFrom=function(e){return function(t){return this.selected=t.selected,this.selectedImage=t.selectedImage,e.apply(this,arguments)}}(KAGButton.prototype.importFrom);var originalSysImport=RoutineButton.prototype.importFromKAGArgs;RoutineButton.prototype.importFromKAGArgs=function(args){if(originalSysImport.apply(this,arguments),args&&"graphic_select"in args&&"select_observe"in args){var _this=this;ResourceLoader.loadImage(args.graphic_select,!1).done(function(image){function toObserve(){return Boolean(eval(args.select_observe))!=Boolean(_this.selected)}function callback(){for(var e=o2.foreLayers.messageLayers.concat(o2.backLayers.messageLayers),t=0;t<e.length;t++){var r=e[t];if(-1!=r.routineButtons.indexOf(_this))return _this.selected=!_this.selected,void r.redrawRect(_this.rect)}Observer.unobserve(toObserve,callback)}_this.selectedImage=image,Observer.observe(toObserve,callback),_this.click=function(e){return function(){var t=e.apply(this,arguments);return Observer.perform(callback),t}}(_this.click)})}},RoutineButton.prototype.importFrom=function(e){return function(t){return this.selected=t.selected,this.selectedImage=t.selectedImage,e.apply(this,arguments)}}(RoutineButton.prototype.importFrom);var originalRoutineSerialized=Button.prototype.objectToBeSerialized;Button.prototype.objectToBeSerialized=function(e){return"selectedImage"!=e?originalRoutineSerialized.apply(this,arguments):void 0};var originalImport=o2.importFromSaveData;o2.importFromSaveData=function(){return Observer.clear(),originalImport.apply(this,arguments)};var Observer=function(){function e(e){clearTimeout(o),o=setTimeout(function(){r.forEach(function(t){e&&e!=t.condition||t.condition()&&t.callback()}),o=void 0})}function t(e,t){for(var o=0;o<r.length;o++){var n=r[o];if(n.condition==e&&n.callback==t)return o}return-1}var r=[],o=void 0;return $(conductor).on("ran",function(){e()}),{observe:function(e,o){-1==t(e,o)&&r.push({condition:e,callback:o})},unobserve:function(e,o){var n=t(e,o);n>=0&&r.splice(n,1)},perform:e,clear:function(){r=[]}}}()}();