(function(a,b){function c(a){var b=a.length,c=g.type(a);return g.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||"function"!==c&&(0===b||"number"==typeof b&&0<b&&b-1 in a)}function d(){Object.defineProperty(this.cache={},0,{get:function(){return{}}});this.expando=g.expando+Math.random()}function e(a,u,c){var d;if(c===b&&1===a.nodeType)if(d="data-"+u.replace(fc,"-$1").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:gc.test(c)?JSON.parse(c):
c}catch(g){}K.set(a,u,c)}else c=b;return c}function h(){return!0}function j(){return!1}function k(){try{return C.activeElement}catch(a){}}function m(a,b){for(;(a=a[b])&&1!==a.nodeType;);return a}function i(a,b,c){if(g.isFunction(b))return g.grep(a,function(a,t){return!!b.call(a,t,a)!==c});if(b.nodeType)return g.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(hc.test(b))return g.filter(b,a,c);b=g.filter(b,a)}return g.grep(a,function(a){return 0<=Ba.call(b,a)!==c})}function l(a,b){return g.nodeName(a,
"table")&&g.nodeName(1===b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function n(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function q(a){var b=ic.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function s(a,b){for(var c=a.length,d=0;c>d;d++)A.set(a[d],"globalEval",!b||A.get(b[d],"globalEval"))}function I(a,b){var c,d,r,y,p,e;if(1===b.nodeType){if(A.hasData(a)&&(c=A.access(a),d=g.extend({},
c),e=c.events,A.set(b,d),e))for(r in delete d.handle,d.events={},e){c=0;for(d=e[r].length;d>c;c++)g.event.add(b,r,e[r][c])}K.hasData(a)&&(y=K.access(a),p=g.extend({},y),K.set(b,p))}}function v(a,u){var c=a.getElementsByTagName?a.getElementsByTagName(u||"*"):a.querySelectorAll?a.querySelectorAll(u||"*"):[];return u===b||u&&g.nodeName(a,u)?g.merge([a],c):c}function L(a,b){if(b in a)return b;for(var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,g=pb.length;g--;)if(b=pb[g]+c,b in a)return b;return d}function G(a,
b){return a=b||a,"none"===g.css(a,"display")||!g.contains(a.ownerDocument,a)}function O(a,b){for(var c,d,r,y=[],p=0,e=a.length;e>p;p++)d=a[p],d.style&&(y[p]=A.get(d,"olddisplay"),c=d.style.display,b?(y[p]||"none"!==c||(d.style.display=""),""===d.style.display&&G(d)&&(y[p]=A.access(d,"olddisplay",U(d.nodeName)))):y[p]||(r=G(d),(c&&"none"!==c||!r)&&A.set(d,"olddisplay",r?c:g.css(d,"display"))));for(p=0;e>p;p++)d=a[p],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?y[p]||
"":"none"));return a}function H(a,b,c){return(a=jc.exec(b))?Math.max(0,a[1]-(c||0))+(a[2]||"px"):b}function P(a,b,c,d,r){for(var b=c===(d?"border":"content")?4:"width"===b?1:0,y=0;4>b;b+=2)"margin"===c&&(y+=g.css(a,c+ja[b],!0,r)),d?("content"===c&&(y-=g.css(a,"padding"+ja[b],!0,r)),"margin"!==c&&(y-=g.css(a,"border"+ja[b]+"Width",!0,r))):(y+=g.css(a,"padding"+ja[b],!0,r),"padding"!==c&&(y+=g.css(a,"border"+ja[b]+"Width",!0,r)));return y}function D(b,c,w){var d=!0,r="width"===c?b.offsetWidth:b.offsetHeight,
y=a.getComputedStyle(b,null),e=g.support.boxSizing&&"border-box"===g.css(b,"boxSizing",!1,y);if(0>=r||null==r){if(r=ra(b,c,y),(0>r||null==r)&&(r=b.style[c]),Va.test(r))return r;d=e&&(g.support.boxSizingReliable||r===b.style[c]);r=parseFloat(r)||0}return r+P(b,c,w||(e?"border":"content"),d,y)+"px"}function U(a){var b=C,c=qb[a];return c||(c=rb(a,b),"none"!==c&&c||(va=(va||g("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(b.documentElement),b=(va[0].contentWindow||
va[0].contentDocument).document,b.write("<!doctype html><html><body>"),b.close(),c=rb(a,b),va.detach()),qb[a]=c),c}function rb(a,b){var c=g(b.createElement(a)).appendTo(b.body),d=g.css(c[0],"display");return c.remove(),d}function Wa(a,b,c,d){var r;if(g.isArray(b))g.each(b,function(b,u){c||kc.test(a)?d(a,u):Wa(a+"["+("object"==typeof u?b:"")+"]",u,c,d)});else if(c||"object"!==g.type(b))d(a,b);else for(r in b)Wa(a+"["+r+"]",b[r],c,d)}function sb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");
var d,r=0,y=b.toLowerCase().match(Z)||[];if(g.isFunction(c))for(;d=y[r++];)"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function tb(a,c,d,x){function r(ob){var h;return y[ob]=!0,g.each(a[ob]||[],function(a,t){var g=t(c,d,x);return"string"!=typeof g||e||y[g]?e?!(h=g):b:(c.dataTypes.unshift(g),r(g),!1)}),h}var y={},e=a===Xa;return r(c.dataTypes[0])||!y["*"]&&r("*")}function Ya(a,c){var d,x,r=g.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((r[d]?a:x||(x={}))[d]=
c[d]);return x&&g.extend(!0,a,x),a}function ub(){return setTimeout(function(){sa=b}),sa=g.now()}function vb(a,b,c){var d,r,y=0,e=Ca.length,h=g.Deferred().always(function(){delete j.elem}),j=function(){if(r)return!1;for(var b=sa||ub(),b=Math.max(0,i.startTime+i.duration-b),c=1-(b/i.duration||0),u=0,d=i.tweens.length;d>u;u++)i.tweens[u].run(c);return h.notifyWith(a,[i,c,b]),1>c&&d?b:(h.resolveWith(a,[i]),!1)},i=h.promise({elem:a,props:g.extend({},b),opts:g.extend(!0,{specialEasing:{}},c),originalProperties:b,
originalOptions:c,startTime:sa||ub(),duration:c.duration,tweens:[],createTween:function(b,c){var u=g.Tween(a,i.opts,b,c,i.opts.specialEasing[b]||i.opts.easing);return i.tweens.push(u),u},stop:function(b){var c=0,u=b?i.tweens.length:0;if(r)return this;for(r=!0;u>c;c++)i.tweens[c].run(1);return b?h.resolveWith(a,[i,b]):h.rejectWith(a,[i,b]),this}}),b=i.props,c=i.opts.specialEasing,k,M,l,m;for(d in b)if(k=g.camelCase(d),M=c[k],l=b[d],g.isArray(l)&&(M=l[1],l=b[d]=l[0]),d!==k&&(b[k]=l,delete b[d]),m=g.cssHooks[k],
m&&"expand"in m)for(d in l=m.expand(l),delete b[k],l)d in b||(b[d]=l[d],c[d]=M);else c[k]=M;for(;e>y;y++)if(d=Ca[y].call(i,a,b,i.opts))return d;var n=i;g.each(b,function(a,b){for(var t=(wa[a]||[]).concat(wa["*"]),c=0,u=t.length;u>c&&!t[c].call(n,a,b);c++);});return g.isFunction(i.opts.start)&&i.opts.start.call(a,i),g.fx.timer(g.extend(j,{elem:a,anim:i,queue:i.opts.queue})),i.progress(i.opts.progress).done(i.opts.done,i.opts.complete).fail(i.opts.fail).always(i.opts.always)}function R(a,b,c,d,g){return new R.prototype.init(a,
b,c,d,g)}function Da(a,b){for(var c,d={height:a},g=0,b=b?1:0;4>g;g+=2-b)c=ja[g],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}var wb,Ea,Fa=typeof b,mc=a.location,C=a.document,xb=C.documentElement,nc=a.jQuery,oc=a.$,Ga={},Ha=[],yb=Ha.concat,Za=Ha.push,la=Ha.slice,Ba=Ha.indexOf,pc=Ga.toString,$a=Ga.hasOwnProperty,qc="2.0.0".trim,g=function(a,b){return new g.fn.init(a,b,wb)},Ia=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Z=/\S+/g,rc=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,zb=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,
sc=/^-ms-/,tc=/-([\da-z])/gi,uc=function(a,b){return b.toUpperCase()},Ja=function(){C.removeEventListener("DOMContentLoaded",Ja,!1);a.removeEventListener("load",Ja,!1);g.ready()};g.fn=g.prototype={jquery:"2.0.0",constructor:g,init:function(a,c,d){var x,r;if(!a)return this;if("string"==typeof a){if(x="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&3<=a.length?[null,a,null]:rc.exec(a),!x||!x[1]&&c)return!c||c.jquery?(c||d).find(a):this.constructor(c).find(a);if(x[1]){if(c=c instanceof g?c[0]:c,g.merge(this,
g.parseHTML(x[1],c&&c.nodeType?c.ownerDocument||c:C,!0)),zb.test(x[1])&&g.isPlainObject(c))for(x in c)g.isFunction(this[x])?this[x](c[x]):this.attr(x,c[x]);return this}return r=C.getElementById(x[2]),r&&r.parentNode&&(this.length=1,this[0]=r),this.context=C,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):g.isFunction(a)?d.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),g.makeArray(a,this))},selector:"",length:0,toArray:function(){return la.call(this)},
get:function(a){return null==a?this.toArray():0>a?this[this.length+a]:this[a]},pushStack:function(a){a=g.merge(this.constructor(),a);return a.prevObject=this,a.context=this.context,a},each:function(a,b){return g.each(this,a,b)},ready:function(a){return g.ready.promise().done(a),this},slice:function(){return this.pushStack(la.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,a=+a+(0>a?b:0);return this.pushStack(0<=a&&b>
a?[this[a]]:[])},map:function(a){return this.pushStack(g.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:Za,sort:[].sort,splice:[].splice};g.fn.init.prototype=g.fn;g.extend=g.fn.extend=function(){var a,c,d,x,r,y,e=arguments[0]||{},h=1,i=arguments.length,j=!1;"boolean"==typeof e&&(j=e,e=arguments[1]||{},h=2);"object"==typeof e||g.isFunction(e)||(e={});for(i===h&&(e=this,--h);i>h;h++)if(null!=(a=arguments[h]))for(c in a)d=e[c],x=a[c],
e!==x&&(j&&x&&(g.isPlainObject(x)||(r=g.isArray(x)))?(r?(r=!1,y=d&&g.isArray(d)?d:[]):y=d&&g.isPlainObject(d)?d:{},e[c]=g.extend(j,y,x)):x!==b&&(e[c]=x));return e};g.extend({expando:"jQuery"+("2.0.0"+Math.random()).replace(/\D/g,""),noConflict:function(b){return a.$===g&&(a.$=oc),b&&a.jQuery===g&&(a.jQuery=nc),g},isReady:!1,readyWait:1,holdReady:function(a){a?g.readyWait++:g.ready(!0)},ready:function(a){(!0===a?--g.readyWait:g.isReady)||(g.isReady=!0,!0!==a&&0<--g.readyWait||(Ea.resolveWith(C,[g]),
g.fn.trigger&&g(C).trigger("ready").off("ready")))},isFunction:function(a){return"function"===g.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?Ga[pc.call(a)]||"object":typeof a},isPlainObject:function(a){if("object"!==g.type(a)||a.nodeType||g.isWindow(a))return!1;try{if(a.constructor&&!$a.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0},
isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw Error(a);},parseHTML:function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1);var b=b||C,d=zb.exec(a),c=!c&&[];return d?[b.createElement(d[1])]:(d=g.buildFragment([a],b,c),c&&g(c).remove(),g.merge([],d.childNodes))},parseJSON:JSON.parse,parseXML:function(a){var c,d;if(!a||"string"!=typeof a)return null;try{d=new DOMParser,c=d.parseFromString(a,"text/xml")}catch(x){c=b}return(!c||c.getElementsByTagName("parsererror").length)&&
g.error("Invalid XML: "+a),c},noop:function(){},globalEval:function(a){var b,c=eval;(a=g.trim(a))&&(1===a.indexOf("use strict")?(b=C.createElement("script"),b.text=a,C.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(sc,"ms-").replace(tc,uc)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,d){var x,g=0,e=a.length,p=c(a);if(d)if(p)for(;e>g&&!(x=b.apply(a[g],d),!1===x);g++);else for(g in a){if(x=b.apply(a[g],
d),!1===x)break}else if(p)for(;e>g&&!(x=b.call(a[g],g,a[g]),!1===x);g++);else for(g in a)if(x=b.call(a[g],g,a[g]),!1===x)break;return a},trim:function(a){return null==a?"":qc.call(a)},makeArray:function(a,b){var d=b||[];return null!=a&&(c(Object(a))?g.merge(d,"string"==typeof a?[a]:a):Za.call(d,a)),d},inArray:function(a,b,c){return null==b?-1:Ba.call(b,a,c)},merge:function(a,c){var d=c.length,g=a.length,r=0;if("number"==typeof d)for(;d>r;r++)a[g++]=c[r];else for(;c[r]!==b;)a[g++]=c[r++];return a.length=
g,a},grep:function(a,b,c){for(var d,g=[],e=0,p=a.length,c=!!c;p>e;e++)d=!!b(a[e],e),c!==d&&g.push(a[e]);return g},map:function(a,b,d){var g,r=0,e=a.length,p=[];if(c(a))for(;e>r;r++)g=b(a[r],r,d),null!=g&&(p[p.length]=g);else for(r in a)g=b(a[r],r,d),null!=g&&(p[p.length]=g);return yb.apply([],p)},guid:1,proxy:function(a,c){var d,x,r;return"string"==typeof c&&(d=a[c],c=a,a=d),g.isFunction(a)?(x=la.call(arguments,2),r=function(){return a.apply(c||this,x.concat(la.call(arguments)))},r.guid=a.guid=a.guid||
g.guid++,r):b},access:function(a,c,d,x,r,e,p){var h=0,i=a.length,j=null==d;if("object"===g.type(d))for(h in r=!0,d)g.access(a,c,h,d[h],!0,e,p);else if(x!==b&&(r=!0,g.isFunction(x)||(p=!0),j&&(p?(c.call(a,x),c=null):(j=c,c=function(a,b,t){return j.call(g(a),t)})),c))for(;i>h;h++)c(a[h],d,p?x:x.call(a[h],h,c(a[h],d)));return r?a:j?c.call(a):i?c(a[0],d):e},now:Date.now,swap:function(a,b,c,d){var g,e={};for(g in b)e[g]=a.style[g],a.style[g]=b[g];c=c.apply(a,d||[]);for(g in b)a.style[g]=e[g];return c}});
g.ready.promise=function(b){return Ea||(Ea=g.Deferred(),"complete"===C.readyState?setTimeout(g.ready):(C.addEventListener("DOMContentLoaded",Ja,!1),a.addEventListener("load",Ja,!1))),Ea.promise(b)};g.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){Ga["[object "+b+"]"]=b.toLowerCase()});wb=g(C);var ab=a,bb=function(){var a,b=[];return a=function(c,d){return b.push(c+=" ")>z.cacheLength&&delete a[b.shift()],a[c]=d}},X=function(a){return a[J]=!0,a},aa=function(a){var b=
N.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b)}},B=function(a,b,c,d){var g,e,p,h,i;if((b?b.ownerDocument||b:da)!==N&&ta(b),b=b||N,c=c||[],!a||"string"!=typeof a)return c;if(1!==(h=b.nodeType)&&9!==h)return[];if(Y&&!d){if(g=vc.exec(a))if(p=g[1])if(9===h){if(e=b.getElementById(p),!e||!e.parentNode)return c;if(e.id===p)return c.push(e),c}else{if(b.ownerDocument&&(e=b.ownerDocument.getElementById(p))&&xa(b,e)&&e.id===p)return c.push(e),c}else{if(g[2])return ea.apply(c,
b.getElementsByTagName(a)),c;if((p=g[3])&&E.getElementsByClassName&&b.getElementsByClassName)return ea.apply(c,b.getElementsByClassName(p)),c}if(E.qsa&&(!S||!S.test(a))){if(e=g=J,p=b,i=9===h&&a,1===h&&"object"!==b.nodeName.toLowerCase()){h=Ka(a);(g=b.getAttribute("id"))?e=g.replace(wc,"\\$&"):b.setAttribute("id",e);e="[id='"+e+"'] ";for(p=h.length;p--;)h[p]=e+La(h[p]);p=cb.test(a)&&b.parentNode||b;i=h.join(",")}if(i)try{return ea.apply(c,p.querySelectorAll(i)),c}catch(j){}finally{g||b.removeAttribute("id")}}}var k;
a:{var a=a.replace(Ma,"$1"),M,l;e=Ka(a);if(!d&&1===e.length){if(k=e[0]=e[0].slice(0),2<k.length&&"ID"===(M=k[0]).type&&9===b.nodeType&&Y&&z.relative[k[1].type]){if(b=(z.find.ID(M.matches[0].replace(fa,ga),b)||[])[0],!b){k=c;break a}a=a.slice(k.shift().value.length)}for(h=Na.needsContext.test(a)?0:k.length;h--&&!(M=k[h],z.relative[g=M.type]);)if((l=z.find[g])&&(d=l(M.matches[0].replace(fa,ga),cb.test(k[0].type)&&b.parentNode||b))){if(k.splice(h,1),a=d.length&&La(k),!a){k=(ea.apply(c,d),c);break a}break}}k=
(db(a,e)(d,b,!Y,c,cb.test(a)),c)}return k},Bb=function(a,b){var c=b&&a,d=c&&(~b.sourceIndex||Ab)-(~a.sourceIndex||Ab);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1},xc=function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&d.specified?d.value:!0===a[b]?b.toLowerCase():null},yc=function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)},zc=function(a){return function(b){return"input"===b.nodeName.toLowerCase()&&b.type===a}},Ac=function(a){return function(b){var c=
b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}},ma=function(a){return X(function(b){return b=+b,X(function(c,d){for(var g,e=a([],c.length,b),p=e.length;p--;)c[g=e[p]]&&(c[g]=!(d[g]=c[g]))})})},Ka=function(a,b){var c,d,g,e,p,h,i;if(p=Cb[a+" "])return b?0:p.slice(0);p=a;h=[];for(i=z.preFilter;p;){(!c||(d=Bc.exec(p)))&&(d&&(p=p.slice(d[0].length)||p),h.push(g=[]));c=!1;(d=Cc.exec(p))&&(c=d.shift(),g.push({value:c,type:d[0].replace(Ma," ")}),p=p.slice(c.length));for(e in z.filter)!(d=
Na[e].exec(p))||i[e]&&!(d=i[e](d))||(c=d.shift(),g.push({value:c,type:e,matches:d}),p=p.slice(c.length));if(!c)break}return b?p.length:p?B.error(a):Cb(a,h).slice(0)},La=function(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d},eb=function(a,b,c){var d=b.dir,g=c&&"parentNode"===d,e=Dc++;return b.first?function(b,c,u){for(;b=b[d];)if(1===b.nodeType||g)return a(b,c,u)}:function(b,c,u){var w,h,i,j=ba+" "+e;if(u)for(;b=b[d];){if((1===b.nodeType||g)&&a(b,c,u))return!0}else for(;b=b[d];)if(1===
b.nodeType||g)if(i=b[J]||(b[J]={}),(h=i[d])&&h[0]===j){if(!0===(w=h[1])||w===Oa)return!0===w}else if(h=i[d]=[j],h[1]=a(b,c,u)||Oa,!0===h[1])return!0}},fb=function(a){return 1<a.length?function(b,c,d){for(var g=a.length;g--;)if(!a[g](b,c,d))return!1;return!0}:a[0]},Pa=function(a,b,c,d,g){for(var e,p=[],h=0,i=a.length,j=null!=b;i>h;h++)(e=a[h])&&(!c||c(e,d,g))&&(p.push(e),j&&b.push(h));return p},gb=function(a,b,c,d,g,e){return d&&!d[J]&&(d=gb(d)),g&&!g[J]&&(g=gb(g,e)),X(function(e,y,h,i){var j,k,l=
[],m=[],n=y.length,s;if(!(s=e)){s=b||"*";for(var q=h.nodeType?[h]:h,v=[],G=0,A=q.length;A>G;G++)B(s,q[G],v);s=v}s=!a||!e&&b?s:Pa(s,l,a,h,i);q=c?g||(e?a:n||d)?[]:y:s;if(c&&c(s,q,h,i),d){j=Pa(q,m);d(j,[],h,i);for(h=j.length;h--;)(k=j[h])&&(q[m[h]]=!(s[m[h]]=k))}if(e){if(g||a){if(g){j=[];for(h=q.length;h--;)(k=q[h])&&j.push(s[h]=k);g(null,q=[],j,i)}for(h=q.length;h--;)(k=q[h])&&-1<(j=g?na.call(e,k):l[h])&&(e[j]=!(y[j]=k))}}else q=Pa(q===y?q.splice(n,q.length):q),g?g(null,y,q,i):ea.apply(y,q)})},hb=function(a){var b,
c,d,g=a.length,e=z.relative[a[0].type];c=e||z.relative[" "];for(var p=e?1:0,h=eb(function(a){return a===b},c,!0),i=eb(function(a){return-1<na.call(b,a)},c,!0),j=[function(a,c,t){return!e&&(t||c!==Qa)||((b=c).nodeType?h(a,c,t):i(a,c,t))}];g>p;p++)if(c=z.relative[a[p].type])j=[eb(fb(j),c)];else{if(c=z.filter[a[p].type].apply(null,a[p].matches),c[J]){for(d=++p;g>d&&!z.relative[a[d].type];d++);return gb(1<p&&fb(j),1<p&&La(a.slice(0,p-1)).replace(Ma,"$1"),c,d>p&&hb(a.slice(p,d)),g>d&&hb(a=a.slice(d)),
g>d&&La(a))}j.push(c)}return fb(j)},Db=function(){},ua,Oa,z,Ra,Eb,db,Qa,oa,ta,N,ca,Y,S,pa,Sa,xa,J="sizzle"+-new Date,da=ab.document,E={},ba=0,Dc=0,Fb=bb(),Cb=bb(),Gb=bb(),ya=!1,Ta=function(){return 0},Ab=-2147483648,ha=[],Ec=ha.pop,Fc=ha.push,ea=ha.push,Hb=ha.slice,na=ha.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},Ib="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+".replace("w","w#"),Jb="\\[[\\x20\\t\\r\\n\\f]*((?:\\\\.|[\\w-]|[^\\x00-\\xa0])+)[\\x20\\t\\r\\n\\f]*(?:([*^$|!~]?=)[\\x20\\t\\r\\n\\f]*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+
Ib+")|)|)[\\x20\\t\\r\\n\\f]*\\]",ib=":((?:\\\\.|[\\w-]|[^\\x00-\\xa0])+)(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+Jb.replace(3,8)+")*)|.*)\\)|)",Ma=/^[\x20\t\r\n\f]+|((?:^|[^\\])(?:\\.)*)[\x20\t\r\n\f]+$/g,Bc=/^[\x20\t\r\n\f]*,[\x20\t\r\n\f]*/,Cc=/^[\x20\t\r\n\f]*([>+~]|[\x20\t\r\n\f])[\x20\t\r\n\f]*/,cb=/[\x20\t\r\n\f]*[+~]/,Gc=/=[\x20\t\r\n\f]*([^\]'"]*)[\x20\t\r\n\f]*\]/g,Hc=RegExp(ib),Ic=RegExp("^"+Ib+"$"),Na={ID:/^#((?:\\.|[\w-]|[^\x00-\xa0])+)/,CLASS:/^\.((?:\\.|[\w-]|[^\x00-\xa0])+)/,
TAG:RegExp("^("+"(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+".replace("w","w*")+")"),ATTR:RegExp("^"+Jb),PSEUDO:RegExp("^"+ib),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)","i"),"boolean":RegExp("^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$","i"),needsContext:RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)",
"i")},jb=/^[^{]+\{\s*\[native \w/,vc=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Jc=/^(?:input|select|textarea|button)$/i,Kc=/^h\d$/i,wc=/'|\\/g,fa=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,ga=function(a,b){var c="0x"+b-65536;return c!==c?b:0>c?String.fromCharCode(c+65536):String.fromCharCode(55296|c>>10,56320|1023&c)};try{ea.apply(ha=Hb.call(da.childNodes),da.childNodes),ha[da.childNodes.length].nodeType}catch(jd){ea={apply:ha.length?function(a,b){Fc.apply(a,Hb.call(b))}:function(a,b){for(var c=a.length,d=
0;a[c++]=b[d++];);a.length=c-1}}}Eb=B.isXML=function(a){return(a=a&&(a.ownerDocument||a).documentElement)?"HTML"!==a.nodeName:!1};ta=B.setDocument=function(a){var b=a?a.ownerDocument||a:da;if(b!==N&&9===b.nodeType&&b.documentElement){N=b;ca=b.documentElement;Y=!Eb(b);E.getElementsByTagName=aa(function(a){return a.appendChild(b.createComment("")),!a.getElementsByTagName("*").length});E.attributes=aa(function(a){return a.className="i",!a.getAttribute("className")});E.getElementsByClassName=aa(function(a){return a.innerHTML=
"<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length});E.sortDetached=aa(function(a){return 1&a.compareDocumentPosition(N.createElement("div"))});E.getById=aa(function(a){return ca.appendChild(a).id=J,!b.getElementsByName||!b.getElementsByName(J).length});E.getById?(z.find.ID=function(a,b){if("undefined"!==typeof b.getElementById&&Y){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},z.filter.ID=function(a){var b=a.replace(fa,ga);
return function(a){return a.getAttribute("id")===b}}):(z.find.ID=function(a,b){if("undefined"!==typeof b.getElementById&&Y){var c=b.getElementById(a);return c?c.id===a||"undefined"!==typeof c.getAttributeNode&&c.getAttributeNode("id").value===a?[c]:void 0:[]}},z.filter.ID=function(a){var b=a.replace(fa,ga);return function(a){return(a="undefined"!==typeof a.getAttributeNode&&a.getAttributeNode("id"))&&a.value===b}});z.find.TAG=E.getElementsByTagName?function(a,b){return"undefined"!==typeof b.getElementsByTagName?
b.getElementsByTagName(a):void 0}:function(a,b){var c,t=[],d=0,g=b.getElementsByTagName(a);if("*"===a){for(;c=g[d++];)1===c.nodeType&&t.push(c);return t}return g};z.find.CLASS=E.getElementsByClassName&&function(a,b){return"undefined"!==typeof b.getElementsByClassName&&Y?b.getElementsByClassName(a):void 0};pa=[];S=[];(E.qsa=jb.test(b.querySelectorAll+""))&&(aa(function(a){a.innerHTML="<select><option selected=''></option></select>";a.querySelectorAll("[selected]").length||S.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)");
a.querySelectorAll(":checked").length||S.push(":checked")}),aa(function(a){var b=N.createElement("input");b.setAttribute("type","hidden");a.appendChild(b).setAttribute("t","");a.querySelectorAll("[t^='']").length&&S.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")");a.querySelectorAll(":enabled").length||S.push(":enabled",":disabled");a.querySelectorAll("*,:x");S.push(",.*:")}));var a=E,c;c=Sa=ca.webkitMatchesSelector||ca.mozMatchesSelector||ca.oMatchesSelector||ca.msMatchesSelector;c=jb.test(c+"");a=
((a.matchesSelector=c)&&aa(function(a){E.disconnectedMatch=Sa.call(a,"div");Sa.call(a,"[s!='']:x");pa.push("!=",ib)}),S=S.length&&RegExp(S.join("|")),pa=pa.length&&RegExp(pa.join("|")),xa=jb.test(ca.contains+"")||ca.compareDocumentPosition?function(a,b){var c=9===a.nodeType?a.documentElement:a,t=b&&b.parentNode;return a===t||!(!t||1!==t.nodeType||!(c.contains?c.contains(t):a.compareDocumentPosition&&16&a.compareDocumentPosition(t)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},
Ta=ca.compareDocumentPosition?function(a,c){if(a===c)return ya=!0,0;var t=c.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(c);return t?1&t||!E.sortDetached&&c.compareDocumentPosition(a)===t?a===b||xa(da,a)?-1:c===b||xa(da,c)?1:oa?na.call(oa,a)-na.call(oa,c):0:4&t?-1:1:a.compareDocumentPosition?-1:1}:function(a,c){var t,d=0;t=a.parentNode;var g=c.parentNode,w=[a],e=[c];if(a===c)return ya=!0,0;if(!t||!g)return a===b?-1:c===b?1:t?-1:g?1:oa?na.call(oa,a)-na.call(oa,c):0;
if(t===g)return Bb(a,c);for(t=a;t=t.parentNode;)w.unshift(t);for(t=c;t=t.parentNode;)e.unshift(t);for(;w[d]===e[d];)d++;return d?Bb(w[d],e[d]):w[d]===da?-1:e[d]===da?1:0},N)}else a=N;return a};B.matches=function(a,b){return B(a,null,null,b)};B.matchesSelector=function(a,b){if((a.ownerDocument||a)!==N&&ta(a),b=b.replace(Gc,"='$1']"),!(!E.matchesSelector||!Y||pa&&pa.test(b)||S&&S.test(b)))try{var c=Sa.call(a,b);if(c||E.disconnectedMatch||a.document&&11!==a.document.nodeType)return c}catch(d){}return 0<
B(b,N,null,[a]).length};B.contains=function(a,b){return(a.ownerDocument||a)!==N&&ta(a),xa(a,b)};B.attr=function(a,b){(a.ownerDocument||a)!==N&&ta(a);var c=z.attrHandle[b.toLowerCase()],c=c&&c(a,b,!Y);return void 0===c?E.attributes||!Y?a.getAttribute(b):(c=a.getAttributeNode(b))&&c.specified?c.value:null:c};B.error=function(a){throw Error("Syntax error, unrecognized expression: "+a);};B.uniqueSort=function(a){var b,c=[],d=0,g=0;if(ya=!E.detectDuplicates,oa=!E.sortStable&&a.slice(0),a.sort(Ta),ya){for(;b=
a[g++];)b===a[g]&&(d=c.push(g));for(;d--;)a.splice(c[d],1)}return a};Ra=B.getText=function(a){var b,c="",d=0;if(b=a.nodeType)if(1===b||9===b||11===b){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=Ra(a)}else{if(3===b||4===b)return a.nodeValue}else for(;b=a[d];d++)c+=Ra(b);return c};z=B.selectors={cacheLength:50,createPseudo:X,match:Na,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},
"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(fa,ga),a[3]=(a[4]||a[5]||"").replace(fa,ga),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||B.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&B.error(a[0]),a},PSEUDO:function(a){var b,c=!a[5]&&a[2];return Na.CHILD.test(a[0])?null:(a[4]?a[2]=a[4]:c&&Hc.test(c)&&(b=Ka(c,!0))&&(b=
c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(fa,ga).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=Fb[a+" "];return b||(b=RegExp("(^|[\\x20\\t\\r\\n\\f])"+a+"([\\x20\\t\\r\\n\\f]|$)"))&&Fb(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!==typeof a.getAttribute&&a.getAttribute("class")||"")})},
ATTR:function(a,b,c){return function(d){d=B.attr(d,a);return null==d?"!="===b:b?(d+="","="===b?d===c:"!="===b?d!==c:"^="===b?c&&0===d.indexOf(c):"*="===b?c&&-1<d.indexOf(c):"$="===b?c&&d.slice(-c.length)===c:"~="===b?-1<(" "+d+" ").indexOf(c):"|="===b?d===c||d.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,g){var e="nth"!==a.slice(0,3),p="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===g?function(a){return!!a.parentNode}:function(b,c,u){var w,i,j,k,l,c=e!==p?"nextSibling":"previousSibling",
m=b.parentNode,n=h&&b.nodeName.toLowerCase(),u=!u&&!h;if(m){if(e){for(;c;){for(i=b;i=i[c];)if(h?i.nodeName.toLowerCase()===n:1===i.nodeType)return!1;l=c="only"===a&&!l&&"nextSibling"}return!0}if(l=[p?m.firstChild:m.lastChild],p&&u){u=m[J]||(m[J]={});w=u[a]||[];k=w[0]===ba&&w[1];j=w[0]===ba&&w[2];for(i=k&&m.childNodes[k];i=++k&&i&&i[c]||(j=k=0)||l.pop();)if(1===i.nodeType&&++j&&i===b){u[a]=[ba,k,j];break}}else if(u&&(w=(b[J]||(b[J]={}))[a])&&w[0]===ba)j=w[1];else for(;(i=++k&&i&&i[c]||(j=k=0)||l.pop())&&
(!(h?i.nodeName.toLowerCase()===n:1===i.nodeType)||!++j||!(u&&((i[J]||(i[J]={}))[a]=[ba,j]),i===b)););return j-=g,j===d||0===j%d&&0<=j/d}}},PSEUDO:function(a,b){var c,d=z.pseudos[a]||z.setFilters[a.toLowerCase()]||B.error("unsupported pseudo: "+a);return d[J]?d(b):1<d.length?(c=[a,a,"",b],z.setFilters.hasOwnProperty(a.toLowerCase())?X(function(a,c){for(var t,g=d(a,b),w=g.length;w--;)t=na.call(a,g[w]),a[t]=!(c[t]=g[w])}):function(a){return d(a,0,c)}):d}},pseudos:{not:X(function(a){var b=[],c=[],d=
db(a.replace(Ma,"$1"));return d[J]?X(function(a,b,c,t){for(var g,c=d(a,null,t,[]),t=a.length;t--;)(g=c[t])&&(a[t]=!(b[t]=g))}):function(a,t,g){return b[0]=a,d(b,null,g,c),!c.pop()}}),has:X(function(a){return function(b){return 0<B(a,b).length}}),contains:X(function(a){return function(b){return-1<(b.textContent||b.innerText||Ra(b)).indexOf(a)}}),lang:X(function(a){return Ic.test(a||"")||B.error("unsupported lang: "+a),a=a.replace(fa,ga).toLowerCase(),function(b){var c;do if(c=Y?b.lang:b.getAttribute("xml:lang")||
b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(a){var b=ab.location&&ab.location.hash;return b&&b.slice(1)===a.id},root:function(a){return a===ca},focus:function(a){return a===N.activeElement&&(!N.hasFocus||N.hasFocus())&&!(!a.type&&!a.href&&!~a.tabIndex)},enabled:function(a){return!1===a.disabled},disabled:function(a){return!0===a.disabled},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===
b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,!0===a.selected},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if("@"<a.nodeName||3===a.nodeType||4===a.nodeType)return!1;return!0},parent:function(a){return!z.pseudos.empty(a)},header:function(a){return Kc.test(a.nodeName)},input:function(a){return Jc.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;
return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||b.toLowerCase()===a.type)},first:ma(function(){return[0]}),last:ma(function(a,b){return[b-1]}),eq:ma(function(a,b,c){return[0>c?c+b:c]}),even:ma(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:ma(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:ma(function(a,b,c){for(b=0>c?c+b:c;0<=--b;)a.push(b);return a}),gt:ma(function(a,b,c){for(c=0>c?c+b:c;b>++c;)a.push(c);return a})}};for(ua in{radio:!0,
checkbox:!0,file:!0,password:!0,image:!0})z.pseudos[ua]=zc(ua);for(ua in{submit:!0,reset:!0})z.pseudos[ua]=Ac(ua);db=B.compile=function(a,b){var c,d=[],g=[],e=Gb[a+" "];if(!e){b||(b=Ka(a));for(c=b.length;c--;)e=hb(b[c]),e[J]?d.push(e):g.push(e);var h=0,i=0<d.length,j=0<g.length;c=function(a,b,c,t,u){var e,w,y=[],k=0,l="0",m=a&&[],n=null!=u,q=Qa,s=a||j&&z.find.TAG("*",u&&b.parentNode||b),v=ba+=null==q?1:Math.random()||0.1;for(n&&(Qa=b!==N&&b,Oa=h);null!=(u=s[l]);l++){if(j&&u){for(e=0;w=g[e++];)if(w(u,
b,c)){t.push(u);break}n&&(ba=v,Oa=++h)}i&&((u=!w&&u)&&k--,a&&m.push(u))}if(k+=l,i&&l!==k){for(e=0;w=d[e++];)w(m,y,b,c);if(a){if(0<k)for(;l--;)m[l]||y[l]||(y[l]=Ec.call(t));y=Pa(y)}ea.apply(t,y);n&&!a&&0<y.length&&1<k+d.length&&B.uniqueSort(t)}return n&&(ba=v,Qa=q),m};c=i?X(c):c;e=Gb(a,c)}return e};z.pseudos.nth=z.pseudos.eq;Db.prototype=z.filters=z.pseudos;z.setFilters=new Db;E.sortStable=J.split("").sort(Ta).join("")===J;ta();[0,0].sort(Ta);E.detectDuplicates=ya;aa(function(a){if(a.innerHTML="<a href='#'></a>",
"#"!==a.firstChild.getAttribute("href"))for(var a=["type","href","height","width"],b=a.length;b--;)z.attrHandle[a[b]]=yc});aa(function(a){if(null!=a.getAttribute("disabled"))for(var a="checked selected async autofocus autoplay controls defer disabled hidden ismap loop multiple open readonly required scoped".split(" "),b=a.length;b--;)z.attrHandle[a[b]]=xc});g.find=B;g.expr=B.selectors;g.expr[":"]=g.expr.pseudos;g.unique=B.uniqueSort;g.text=B.getText;g.isXMLDoc=B.isXML;g.contains=B.contains;var Kb=
{};g.Callbacks=function(a){var c;if("string"==typeof a){if(!(c=Kb[a])){c=a;var d=Kb[c]={};c=(g.each(c.match(Z)||[],function(a,b){d[b]=!0}),d)}}else c=g.extend({},a);var a=c,e,r,h,p,i,j,k=[],l=!a.once&&[],m=function(b){e=a.memory&&b;r=!0;j=p||0;p=0;i=k.length;for(h=!0;k&&i>j;j++)if(!1===k[j].apply(b[0],b[1])&&a.stopOnFalse){e=!1;break}h=!1;k&&(l?l.length&&m(l.shift()):e?k=[]:n.disable())},n={add:function(){if(k){var b=k.length;(function lc(b){g.each(b,function(b,c){var d=g.type(c);"function"===d?a.unique&&
n.has(c)||k.push(c):c&&c.length&&"string"!==d&&lc(c)})})(arguments);h?i=k.length:e&&(p=b,m(e))}return this},remove:function(){return k&&g.each(arguments,function(a,b){for(var c;-1<(c=g.inArray(b,k,c));)k.splice(c,1),h&&(i>=c&&i--,j>=c&&j--)}),this},has:function(a){return a?-1<g.inArray(a,k):!(!k||!k.length)},empty:function(){return k=[],i=0,this},disable:function(){return k=l=e=b,this},disabled:function(){return!k},lock:function(){return l=b,e||n.disable(),this},locked:function(){return!l},fireWith:function(a,
b){return b=b||[],b=[a,b.slice?b.slice():b],!k||r&&!l||(h?l.push(b):m(b)),this},fire:function(){return n.fireWith(this,arguments),this},fired:function(){return!!r}};return n};g.extend({Deferred:function(a){var b=[["resolve","done",g.Callbacks("once memory"),"resolved"],["reject","fail",g.Callbacks("once memory"),"rejected"],["notify","progress",g.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;
return g.Deferred(function(c){g.each(b,function(b,t){var u=t[0],w=g.isFunction(a[b])&&a[b];e[t[1]](function(){var a=w&&w.apply(this,arguments);a&&g.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[u+"With"](this===d?c.promise():this,w?[a]:arguments)})});a=null}).promise()},promise:function(a){return null!=a?g.extend(a,d):d}},e={};return d.pipe=d.then,g.each(b,function(a,t){var g=t[2],h=t[3];d[t[1]]=g.add;h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock);
e[t[0]]=function(){return e[t[0]+"With"](this===e?d:this,arguments),this};e[t[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=la.call(arguments),d=c.length,e=1!==d||a&&g.isFunction(a.promise)?d:0,h=1===e?a:g.Deferred(),p=function(a,b,c){return function(d){b[a]=this;c[a]=1<arguments.length?la.call(arguments):d;c===i?h.notifyWith(b,c):--e||h.resolveWith(b,c)}},i,j,k;if(1<d){i=Array(d);j=Array(d);for(k=Array(d);d>b;b++)c[b]&&g.isFunction(c[b].promise)?c[b].promise().done(p(b,
k,c)).fail(h.reject).progress(p(b,j,i)):--e}return e||h.resolveWith(k,c),h.promise()}});var Lc=g,Lb,Q={},V=C.createElement("input"),Mb=C.createDocumentFragment(),W=C.createElement("div"),Nb=C.createElement("select"),Ob=Nb.appendChild(C.createElement("option"));Lb=V.type?(V.type="checkbox",Q.checkOn=""!==V.value,Q.optSelected=Ob.selected,Q.reliableMarginRight=!0,Q.boxSizingReliable=!0,Q.pixelPosition=!1,V.checked=!0,Q.noCloneChecked=V.cloneNode(!0).checked,Nb.disabled=!0,Q.optDisabled=!Ob.disabled,
V=C.createElement("input"),V.value="t",V.type="radio",Q.radioValue="t"===V.value,V.setAttribute("checked","t"),V.setAttribute("name","t"),Mb.appendChild(V),Q.checkClone=Mb.cloneNode(!0).cloneNode(!0).lastChild.checked,Q.focusinBubbles="onfocusin"in a,W.style.backgroundClip="content-box",W.cloneNode(!0).style.backgroundClip="",Q.clearCloneStyle="content-box"===W.style.backgroundClip,g(function(){var b,c,d=C.getElementsByTagName("body")[0];d&&(b=C.createElement("div"),b.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",
d.appendChild(b).appendChild(W),W.innerHTML="",W.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",g.swap(d,null!=d.style.zoom?{zoom:1}:{},function(){Q.boxSizing=4===W.offsetWidth}),a.getComputedStyle&&(Q.pixelPosition="1%"!==(a.getComputedStyle(W,null)||{}).top,Q.boxSizingReliable="4px"===(a.getComputedStyle(W,null)||{width:"4px"}).width,c=W.appendChild(C.createElement("div")),
c.style.cssText=W.style.cssText="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",c.style.marginRight=c.style.width="0",W.style.width="1px",Q.reliableMarginRight=!parseFloat((a.getComputedStyle(c,null)||{}).marginRight)),d.removeChild(b))}),Q):Q;Lc.support=Lb;var K,A,gc=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,fc=/([A-Z])/g;d.uid=1;d.accepts=function(a){return a.nodeType?1===a.nodeType||9===a.nodeType:!0};d.prototype={key:function(a){if(!d.accepts(a))return 0;
var b={},c=a[this.expando];if(!c){c=d.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(e){b[this.expando]=c,g.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,a=this.key(a),e=this.cache[a];if("string"==typeof b)e[b]=c;else if(g.isEmptyObject(e))this.cache[a]=b;else for(d in b)e[d]=b[d]},get:function(a,c){var d=this.cache[this.key(a)];return c===b?d:d[c]},access:function(a,c,d){return c===b||c&&"string"==typeof c&&d===b?this.get(a,c):(this.set(a,
c,d),d!==b?d:c)},remove:function(a,c){var d,e;d=this.key(a);var r=this.cache[d];if(c===b)this.cache[d]={};else{g.isArray(c)?e=c.concat(c.map(g.camelCase)):c in r?e=[c]:(e=g.camelCase(c),e=e in r?[e]:e.match(Z)||[]);for(d=e.length;d--;)delete r[e[d]]}},hasData:function(a){return!g.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){delete this.cache[this.key(a)]}};K=new d;A=new d;g.extend({acceptData:d.accepts,hasData:function(a){return K.hasData(a)||A.hasData(a)},data:function(a,b,
c){return K.access(a,b,c)},removeData:function(a,b){K.remove(a,b)},_data:function(a,b,c){return A.access(a,b,c)},_removeData:function(a,b){A.remove(a,b)}});g.fn.extend({data:function(a,c){var d,x,r=this[0],h=0,p=null;if(a===b){if(this.length&&(p=K.get(r),1===r.nodeType&&!A.get(r,"hasDataAttrs"))){for(d=r.attributes;d.length>h;h++)x=d[h].name,0===x.indexOf("data-")&&(x=g.camelCase(x.substring(5)),e(r,x,p[x]));A.set(r,"hasDataAttrs",!0)}return p}return"object"==typeof a?this.each(function(){K.set(this,
a)}):g.access(this,function(c){var d,u=g.camelCase(a);if(r&&c===b){if((d=K.get(r,a),d!==b)||(d=K.get(r,u),d!==b)||(d=e(r,u,b),d!==b))return d}else this.each(function(){var d=K.get(this,u);K.set(this,u,c);-1!==a.indexOf("-")&&d!==b&&K.set(this,a,c)})},null,c,1<arguments.length,null,!0)},removeData:function(a){return this.each(function(){K.remove(this,a)})}});g.extend({queue:function(a,c,d){var e;return a?(c=(c||"fx")+"queue",e=A.get(a,c),d&&(!e||g.isArray(d)?e=A.access(a,c,g.makeArray(d)):e.push(d)),
e||[]):b},dequeue:function(a,b){var b=b||"fx",c=g.queue(a,b),d=c.length,e=c.shift(),h=g._queueHooks(a,b),p=function(){g.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--);(h.cur=e)&&("fx"===b&&c.unshift("inprogress"),delete h.stop,e.call(a,p,h));!d&&h&&h.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return A.get(a,c)||A.access(a,c,{empty:g.Callbacks("once memory").add(function(){A.remove(a,[b+"queue",c])})})}});g.fn.extend({queue:function(a,c){var d=2;return"string"!=typeof a&&(c=a,
a="fx",d--),d>arguments.length?g.queue(this[0],a):c===b?this:this.each(function(){var b=g.queue(this,a,c);g._queueHooks(this,a);"fx"===a&&"inprogress"!==b[0]&&g.dequeue(this,a)})},dequeue:function(a){return this.each(function(){g.dequeue(this,a)})},delay:function(a,b){return a=g.fx?g.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var d,e=1,r=g.Deferred(),
h=this,p=this.length,i=function(){--e||r.resolveWith(h,[h])};"string"!=typeof a&&(c=a,a=b);for(a=a||"fx";p--;)(d=A.get(h[p],a+"queueHooks"))&&d.empty&&(e++,d.empty.add(i));return i(),r.promise(c)}});var Pb,kb=/[\t\r\n]/g,Mc=/\r/g,Nc=/^(?:input|select|textarea|button)$/i;g.fn.extend({attr:function(a,b){return g.access(this,g.attr,a,b,1<arguments.length)},removeAttr:function(a){return this.each(function(){g.removeAttr(this,a)})},prop:function(a,b){return g.access(this,g.prop,a,b,1<arguments.length)},
removeProp:function(a){return this.each(function(){delete this[g.propFix[a]||a]})},addClass:function(a){var b,c,d,e,h,p=0,i=this.length;b="string"==typeof a&&a;if(g.isFunction(a))return this.each(function(b){g(this).addClass(a.call(this,b,this.className))});if(b)for(b=(a||"").match(Z)||[];i>p;p++)if(c=this[p],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(kb," "):" ")){for(h=0;e=b[h++];)0>d.indexOf(" "+e+" ")&&(d+=e+" ");c.className=g.trim(d)}return this},removeClass:function(a){var b,
c,d,e,h,p=0,i=this.length;b=0===arguments.length||"string"==typeof a&&a;if(g.isFunction(a))return this.each(function(b){g(this).removeClass(a.call(this,b,this.className))});if(b)for(b=(a||"").match(Z)||[];i>p;p++)if(c=this[p],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(kb," "):"")){for(h=0;e=b[h++];)for(;0<=d.indexOf(" "+e+" ");)d=d.replace(" "+e+" "," ");c.className=a?g.trim(d):""}return this},toggleClass:function(a,b){var c=typeof a,d="boolean"==typeof b;return g.isFunction(a)?
this.each(function(c){g(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if("string"===c)for(var e,h=0,p=g(this),i=b,j=a.match(Z)||[];e=j[h++];)i=d?i:!p.hasClass(e),p[i?"addClass":"removeClass"](e);else(c===Fa||"boolean"===c)&&(this.className&&A.set(this,"__className__",this.className),this.className=this.className||!1===a?"":A.get(this,"__className__")||"")})},hasClass:function(a){for(var a=" "+a+" ",b=0,c=this.length;c>b;b++)if(1===this[b].nodeType&&0<=(" "+this[b].className+
" ").replace(kb," ").indexOf(a))return!0;return!1},val:function(a){var c,d,e,r=this[0];if(arguments.length)return e=g.isFunction(a),this.each(function(d){var w,r=g(this);1===this.nodeType&&(w=e?a.call(this,d,r.val()):a,null==w?w="":"number"==typeof w?w+="":g.isArray(w)&&(w=g.map(w,function(a){return null==a?"":a+""})),c=g.valHooks[this.type]||g.valHooks[this.nodeName.toLowerCase()],c&&"set"in c&&c.set(this,w,"value")!==b||(this.value=w))});if(r)return c=g.valHooks[r.type]||g.valHooks[r.nodeName.toLowerCase()],
c&&"get"in c&&(d=c.get(r,"value"))!==b?d:(d=r.value,"string"==typeof d?d.replace(Mc,""):null==d?"":d)}});g.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){for(var b,c=a.options,d=a.selectedIndex,e="select-one"===a.type||0>d,h=e?null:[],p=e?d+1:c.length,i=0>d?p:e?d:0;p>i;i++)if(b=c[i],!(!b.selected&&i!==d||(g.support.optDisabled?b.disabled:null!==b.getAttribute("disabled"))||b.parentNode.disabled&&g.nodeName(b.parentNode,
"optgroup"))){if(a=g(b).val(),e)return a;h.push(a)}return h},set:function(a,b){for(var c,d,e=a.options,h=g.makeArray(b),p=e.length;p--;)d=e[p],(d.selected=0<=g.inArray(g(d).val(),h))&&(c=!0);return c||(a.selectedIndex=-1),h}}},attr:function(a,c,d){var e,r,h=a.nodeType;if(a&&3!==h&&8!==h&&2!==h)return typeof a.getAttribute===Fa?g.prop(a,c,d):(1===h&&g.isXMLDoc(a)||(c=c.toLowerCase(),e=g.attrHooks[c]||(g.expr.match.boolean.test(c)?Pb:void 0)),d===b?e&&"get"in e&&null!==(r=e.get(a,c))?r:(r=g.find.attr(a,
c),null==r?b:r):null!==d?e&&"set"in e&&(r=e.set(a,d,c))!==b?r:(a.setAttribute(c,d+""),d):(g.removeAttr(a,c),b))},removeAttr:function(a,b){var c,d,e=0,h=b&&b.match(Z);if(h&&1===a.nodeType)for(;c=h[e++];)d=g.propFix[c]||c,g.expr.match.boolean.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!g.support.radioValue&&"radio"===b&&g.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(a,
c,d){var e,h,i,p=a.nodeType;if(a&&3!==p&&8!==p&&2!==p)return i=1!==p||!g.isXMLDoc(a),i&&(c=g.propFix[c]||c,h=g.propHooks[c]),d!==b?h&&"set"in h&&(e=h.set(a,d,c))!==b?e:a[c]=d:h&&"get"in h&&null!==(e=h.get(a,c))?e:a[c]},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||Nc.test(a.nodeName)||a.href?a.tabIndex:-1}}}});Pb={set:function(a,b,c){return!1===b?g.removeAttr(a,c):a.setAttribute(c,c),c}};g.each(g.expr.match.boolean.source.match(/\w+/g),function(a,c){var d=g.expr.attrHandle[c]||
g.find.attr;g.expr.attrHandle[c]=function(a,c,t){var e=g.expr.attrHandle[c],a=t?b:(g.expr.attrHandle[c]=b)!=d(a,c,t)?c.toLowerCase():null;return g.expr.attrHandle[c]=e,a}});g.support.optSelected||(g.propHooks.selected={get:function(a){a=a.parentNode;return a&&a.parentNode&&a.parentNode.selectedIndex,null}});g.each("tabIndex readOnly maxLength cellSpacing cellPadding rowSpan colSpan useMap frameBorder contentEditable".split(" "),function(){g.propFix[this.toLowerCase()]=this});g.each(["radio","checkbox"],
function(){g.valHooks[this]={set:function(a,c){return g.isArray(c)?a.checked=0<=g.inArray(g(a).val(),c):b}};g.support.checkOn||(g.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var Oc=/^key/,Pc=/^(?:mouse|contextmenu)|click/,Qb=/^(?:focusinfocus|focusoutblur)$/,Rb=/^([^.]*)(?:\.(.+)|)$/;g.event={global:{},add:function(a,c,d,e,h){var i,p,j,k,l,m,M,n,q,s;if(l=A.get(a)){d.handler&&(i=d,d=i.handler,h=i.selector);d.guid||(d.guid=g.guid++);(k=l.events)||(k=l.events=
{});(p=l.handle)||(p=l.handle=function(a){return typeof g===Fa||a&&g.event.triggered===a.type?b:g.event.dispatch.apply(p.elem,arguments)},p.elem=a);c=(c||"").match(Z)||[""];for(l=c.length;l--;)j=Rb.exec(c[l])||[],q=s=j[1],j=(j[2]||"").split(".").sort(),q&&(M=g.event.special[q]||{},q=(h?M.delegateType:M.bindType)||q,M=g.event.special[q]||{},m=g.extend({type:q,origType:s,data:e,handler:d,guid:d.guid,selector:h,needsContext:h&&g.expr.match.needsContext.test(h),namespace:j.join(".")},i),(n=k[q])||(n=
k[q]=[],n.delegateCount=0,M.setup&&!1!==M.setup.call(a,e,j,p)||a.addEventListener&&a.addEventListener(q,p,!1)),M.add&&(M.add.call(a,m),m.handler.guid||(m.handler.guid=d.guid)),h?n.splice(n.delegateCount++,0,m):n.push(m),g.event.global[q]=!0);a=null}},remove:function(a,b,c,d,e){var h,i,j,k,l,m,n,q,s,v,G,I=A.hasData(a)&&A.get(a);if(I&&(k=I.events)){b=(b||"").match(Z)||[""];for(l=b.length;l--;)if(j=Rb.exec(b[l])||[],s=G=j[1],v=(j[2]||"").split(".").sort(),s){n=g.event.special[s]||{};s=(d?n.delegateType:
n.bindType)||s;q=k[s]||[];j=j[2]&&RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)");for(i=h=q.length;h--;)m=q[h],!e&&G!==m.origType||c&&c.guid!==m.guid||j&&!j.test(m.namespace)||d&&d!==m.selector&&("**"!==d||!m.selector)||(q.splice(h,1),m.selector&&q.delegateCount--,n.remove&&n.remove.call(a,m));i&&!q.length&&(n.teardown&&!1!==n.teardown.call(a,v,I.handle)||g.removeEvent(a,s,I.handle),delete k[s])}else for(s in k)g.event.remove(a,s+b[l],c,d,!0);g.isEmptyObject(k)&&(delete I.handle,A.remove(a,"events"))}},
trigger:function(c,d,e,h){var r,i,p,j,k,l,m,n=[e||C],q=$a.call(c,"type")?c.type:c;r=$a.call(c,"namespace")?c.namespace.split("."):[];if(i=p=e=e||C,3!==e.nodeType&&8!==e.nodeType&&!Qb.test(q+g.event.triggered)&&(0<=q.indexOf(".")&&(r=q.split("."),q=r.shift(),r.sort()),k=0>q.indexOf(":")&&"on"+q,c=c[g.expando]?c:new g.Event(q,"object"==typeof c&&c),c.isTrigger=h?2:3,c.namespace=r.join("."),c.namespace_re=c.namespace?RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,c.result=b,c.target||(c.target=
e),d=null==d?[c]:g.makeArray(d,[c]),m=g.event.special[q]||{},h||!m.trigger||!1!==m.trigger.apply(e,d))){if(!h&&!m.noBubble&&!g.isWindow(e)){j=m.delegateType||q;for(Qb.test(j+q)||(i=i.parentNode);i;i=i.parentNode)n.push(i),p=i;p===(e.ownerDocument||C)&&n.push(p.defaultView||p.parentWindow||a)}for(r=0;(i=n[r++])&&!c.isPropagationStopped();)c.type=1<r?j:m.bindType||q,(l=(A.get(i,"events")||{})[c.type]&&A.get(i,"handle"))&&l.apply(i,d),(l=k&&i[k])&&g.acceptData(i)&&l.apply&&!1===l.apply(i,d)&&c.preventDefault();
return c.type=q,h||c.isDefaultPrevented()||m._default&&!1!==m._default.apply(n.pop(),d)||!g.acceptData(e)||k&&g.isFunction(e[q])&&!g.isWindow(e)&&(p=e[k],p&&(e[k]=null),g.event.triggered=q,e[q](),g.event.triggered=b,p&&(e[k]=p)),c.result}},dispatch:function(a){var a=g.event.fix(a),c,d,e,h,i,p=[],j=la.call(arguments);c=(A.get(this,"events")||{})[a.type]||[];var k=g.event.special[a.type]||{};if(j[0]=a,a.delegateTarget=this,!k.preDispatch||!1!==k.preDispatch.call(this,a)){p=g.event.handlers.call(this,
a,c);for(c=0;(h=p[c++])&&!a.isPropagationStopped();){a.currentTarget=h.elem;for(d=0;(i=h.handlers[d++])&&!a.isImmediatePropagationStopped();)(!a.namespace_re||a.namespace_re.test(i.namespace))&&(a.handleObj=i,a.data=i.data,e=((g.event.special[i.origType]||{}).handle||i.handler).apply(h.elem,j),e!==b&&!1===(a.result=e)&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,c){var d,e,h,i,p=[],j=c.delegateCount,k=a.target;if(j&&k.nodeType&&
(!a.button||"click"!==a.type))for(;k!==this;k=k.parentNode||this)if(!0!==k.disabled||"click"!==a.type){e=[];for(d=0;j>d;d++)i=c[d],h=i.selector+" ",e[h]===b&&(e[h]=i.needsContext?0<=g(h,this).index(k):g.find(h,this,null,[k]).length),e[h]&&e.push(i);e.length&&p.push({elem:k,handlers:e})}return c.length>j&&p.push({elem:this,handlers:c.slice(j)}),p},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:["char",
"charCode","key","keyCode"],filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){var d,g,e,h=c.button;return null==a.pageX&&null!=c.clientX&&(d=a.target.ownerDocument||C,g=d.documentElement,e=d.body,a.pageX=c.clientX+(g&&g.scrollLeft||e&&e.scrollLeft||0)-(g&&g.clientLeft||e&&e.clientLeft||0),a.pageY=c.clientY+(g&&g.scrollTop||
e&&e.scrollTop||0)-(g&&g.clientTop||e&&e.clientTop||0)),a.which||h===b||(a.which=1&h?1:2&h?3:4&h?2:0),a}},fix:function(a){if(a[g.expando])return a;var b,c,d;b=a.type;var e=a,h=this.fixHooks[b];h||(this.fixHooks[b]=h=Pc.test(b)?this.mouseHooks:Oc.test(b)?this.keyHooks:{});d=h.props?this.props.concat(h.props):this.props;a=new g.Event(e);for(b=d.length;b--;)c=d[b],a[c]=e[c];return 3===a.target.nodeType&&(a.target=a.target.parentNode),h.filter?h.filter(a,e):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==
k()&&this.focus?(this.focus(),!1):b},delegateType:"focusin"},blur:{trigger:function(){return this===k()&&this.blur?(this.blur(),!1):b},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&g.nodeName(this,"input")?(this.click(),!1):b},_default:function(a){return g.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){a.result!==b&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){a=g.extend(new g.Event,c,{type:a,isSimulated:!0,originalEvent:{}});
d?g.event.trigger(a,null,b):g.event.dispatch.call(b,a);a.isDefaultPrevented()&&c.preventDefault()}};g.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)};g.Event=function(a,c){return this instanceof g.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.getPreventDefault&&a.getPreventDefault()?h:j):this.type=a,c&&g.extend(this,c),this.timeStamp=a&&a.timeStamp||g.now(),this[g.expando]=!0,b):new g.Event(a,c)};g.Event.prototype=
{isDefaultPrevented:j,isPropagationStopped:j,isImmediatePropagationStopped:j,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=h;a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=h;a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=h;this.stopPropagation()}};g.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){g.event.special[a]=
{delegateType:b,bindType:b,handle:function(a){var c,d=a.relatedTarget,e=a.handleObj;return(!d||d!==this&&!g.contains(this,d))&&(a.type=e.origType,c=e.handler.apply(this,arguments),a.type=b),c}}});g.support.focusinBubbles||g.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){g.event.simulate(b,a.target,g.event.fix(a),!0)};g.event.special[b]={setup:function(){0===c++&&C.addEventListener(a,d,!0)},teardown:function(){0===--c&&C.removeEventListener(a,d,!0)}}});g.fn.extend({on:function(a,
c,d,e,h){var i,p;if("object"==typeof a){"string"!=typeof c&&(d=d||c,c=b);for(p in a)this.on(p,c,d,a[p],h);return this}if(null==d&&null==e?(e=c,d=c=b):null==e&&("string"==typeof c?(e=d,d=b):(e=d,d=c,c=b)),!1===e)e=j;else if(!e)return this;return 1===h&&(i=e,e=function(a){return g().off(a),i.apply(this,arguments)},e.guid=i.guid||(i.guid=g.guid++)),this.each(function(){g.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){var e,h;if(a&&a.preventDefault&&a.handleObj)return e=
a.handleObj,g(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if("object"==typeof a){for(h in a)this.off(h,c,a[h]);return this}return(!1===c||"function"==typeof c)&&(d=c,c=b),!1===d&&(d=j),this.each(function(){g.event.remove(this,a,d,c)})},trigger:function(a,b){return this.each(function(){g.event.trigger(a,b,this)})},triggerHandler:function(a,c){var d=this[0];return d?g.event.trigger(a,c,d,!0):b}});var hc=/^.[^:#\[\.,]*$/,Sb=g.expr.match.needsContext,
Qc={children:!0,contents:!0,next:!0,prev:!0};g.fn.extend({find:function(a){var b,c,d,e=this.length;if("string"!=typeof a)return b=this,this.pushStack(g(a).filter(function(){for(d=0;e>d;d++)if(g.contains(b[d],this))return!0}));c=[];for(d=0;e>d;d++)g.find(a,this[d],c);return c=this.pushStack(1<e?g.unique(c):c),c.selector=(this.selector?this.selector+" ":"")+a,c},has:function(a){var b=g(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(g.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(i(this,
a||[],!0))},filter:function(a){return this.pushStack(i(this,a||[],!1))},is:function(a){return!!a&&("string"==typeof a?Sb.test(a)?0<=g(a,this.context).index(this[0]):0<g.filter(a,this).length:0<this.filter(a).length)},closest:function(a,b){for(var c,d=0,e=this.length,h=[],i=Sb.test(a)||"string"!=typeof a?g(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(11>c.nodeType&&(i?-1<i.index(c):1===c.nodeType&&g.find.matchesSelector(c,a))){h.push(c);break}return this.pushStack(1<h.length?
g.unique(h):h)},index:function(a){return a?"string"==typeof a?Ba.call(g(a),this[0]):Ba.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){var c="string"==typeof a?g(a,b):g.makeArray(a&&a.nodeType?[a]:a),c=g.merge(this.get(),c);return this.pushStack(g.unique(c))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});g.each({parent:function(a){return(a=a.parentNode)&&11!==a.nodeType?a:null},parents:function(a){return g.dir(a,
"parentNode")},parentsUntil:function(a,b,c){return g.dir(a,"parentNode",c)},next:function(a){return m(a,"nextSibling")},prev:function(a){return m(a,"previousSibling")},nextAll:function(a){return g.dir(a,"nextSibling")},prevAll:function(a){return g.dir(a,"previousSibling")},nextUntil:function(a,b,c){return g.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return g.dir(a,"previousSibling",c)},siblings:function(a){return g.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return g.sibling(a.firstChild)},
contents:function(a){return g.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:g.merge([],a.childNodes)}},function(a,b){g.fn[a]=function(c,d){var e=g.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=g.filter(d,e)),1<this.length&&(Qc[a]||g.unique(e),"p"===a[0]&&e.reverse()),this.pushStack(e)}});g.extend({filter:function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?g.find.matchesSelector(d,a)?[d]:[]:g.find.matches(a,g.grep(b,function(a){return 1===
a.nodeType}))},dir:function(a,c,d){for(var e=[],h=d!==b;(a=a[c])&&9!==a.nodeType;)if(1===a.nodeType){if(h&&g(a).is(d))break;e.push(a)}return e},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}});var Tb=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Ub=/<([\w:]+)/,Rc=/<|&#?\w+;/,Sc=/<(?:script|style|link)/i,Vb=/^(?:checkbox|radio)$/i,Tc=/checked\s*(?:[^=]|=\s*.checked.)/i,Wb=/^$|\/(?:java|ecma)script/i,ic=/^true\/(.*)/,Uc=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,
T={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};T.optgroup=T.option;T.tbody=T.tfoot=T.colgroup=T.caption=T.col=T.thead;T.th=T.td;g.fn.extend({text:function(a){return g.access(this,function(a){return a===b?g.text(this):this.empty().append((this[0]&&this[0].ownerDocument||C).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,
function(a){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&l(this,a).appendChild(a)})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=l(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},
remove:function(a,b){for(var c,d=a?g.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||g.cleanData(v(c)),c.parentNode&&(b&&g.contains(c.ownerDocument,c)&&s(v(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(g.cleanData(v(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return g.clone(this,a,b)})},html:function(a){return g.access(this,function(a){var c=
this[0]||{},d=0,e=this.length;if(a===b&&1===c.nodeType)return c.innerHTML;if("string"==typeof a&&!Sc.test(a)&&!T[(Ub.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Tb,"<$1></$2>");try{for(;e>d;d++)c=this[d]||{},1===c.nodeType&&(g.cleanData(v(c,!1)),c.innerHTML=a);c=0}catch(h){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=g.map(this,function(a){return[a.nextSibling,a.parentNode]}),b=0;return this.domManip(arguments,function(c){var d=a[b++],e=a[b++];e&&(g(this).remove(),
e.insertBefore(c,d))},!0),b?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b,c){var a=yb.apply([],a),d,e,h,i,j=0,k=this.length,l=this,m=k-1,s=a[0],G=g.isFunction(s);if(G||!(1>=k||"string"!=typeof s||g.support.checkClone)&&Tc.test(s))return this.each(function(d){var g=l.eq(d);G&&(a[0]=s.call(this,d,g.html()));g.domManip(a,b,c)});if(k&&(d=g.buildFragment(a,this[0].ownerDocument,!1,!c&&this),e=d.firstChild,1===d.childNodes.length&&(d=e),e)){e=g.map(v(d,"script"),
n);for(h=e.length;k>j;j++)i=d,j!==m&&(i=g.clone(i,!0,!0),h&&g.merge(e,v(i,"script"))),b.call(this[j],i,j);if(h){d=e[e.length-1].ownerDocument;g.map(e,q);for(j=0;h>j;j++)i=e[j],Wb.test(i.type||"")&&!A.access(i,"globalEval")&&g.contains(d,i)&&(i.src?g._evalUrl(i.src):g.globalEval(i.textContent.replace(Uc,"")))}}return this}});g.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){g.fn[a]=function(a){for(var c=[],d=g(a),e=d.length-
1,h=0;e>=h;h++)a=h===e?this:this.clone(!0),g(d[h])[b](a),Za.apply(c,a.get());return this.pushStack(c)}});g.extend({clone:function(a,b,c){var d,e,h,i,j=a.cloneNode(!0),k=g.contains(a.ownerDocument,a);if(!g.support.noCloneChecked&&!(1!==a.nodeType&&11!==a.nodeType||g.isXMLDoc(a))){i=v(j);h=v(a);d=0;for(e=h.length;e>d;d++){var l=h[d],m=i[d],q=m.nodeName.toLowerCase();"input"===q&&Vb.test(l.type)?m.checked=l.checked:("input"===q||"textarea"===q)&&(m.defaultValue=l.defaultValue)}}if(b)if(c){h=h||v(a);
i=i||v(j);d=0;for(e=h.length;e>d;d++)I(h[d],i[d])}else I(a,j);return i=v(j,"script"),0<i.length&&s(i,!k&&v(a,"script")),j},buildFragment:function(a,b,c,d){for(var e,h,i,j,k=0,l=a.length,m=b.createDocumentFragment(),q=[];l>k;k++)if(e=a[k],e||0===e)if("object"===g.type(e))g.merge(q,e.nodeType?[e]:e);else if(Rc.test(e)){h=h||m.appendChild(b.createElement("div"));i=(Ub.exec(e)||["",""])[1].toLowerCase();i=T[i]||T._default;h.innerHTML=i[1]+e.replace(Tb,"<$1></$2>")+i[2];for(i=i[0];i--;)h=h.firstChild;
g.merge(q,h.childNodes);h=m.firstChild;h.textContent=""}else q.push(b.createTextNode(e));m.textContent="";for(k=0;e=q[k++];)if((!d||-1===g.inArray(e,d))&&(j=g.contains(e.ownerDocument,e),h=v(m.appendChild(e),"script"),j&&s(h),c))for(i=0;e=h[i++];)Wb.test(e.type||"")&&c.push(e);return m},cleanData:function(a){for(var b,c,d,e=a.length,h=0,i=g.event.special;e>h;h++){if(c=a[h],g.acceptData(c)&&(b=A.access(c)))for(d in b.events)i[d]?g.event.remove(c,d):g.removeEvent(c,d,b.handle);K.discard(c);A.discard(c)}},
_evalUrl:function(a){return g.ajax({url:a,type:"GET",dataType:"text",async:!1,global:!1,success:g.globalEval})}});g.fn.extend({wrapAll:function(a){var b;return g.isFunction(a)?this.each(function(b){g(this).wrapAll(a.call(this,b))}):(this[0]&&(b=g(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return g.isFunction(a)?this.each(function(b){g(this).wrapInner(a.call(this,
b))}):this.each(function(){var b=g(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=g.isFunction(a);return this.each(function(c){g(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){g.nodeName(this,"body")||g(this).replaceWith(this.childNodes)}).end()}});var ra,va,Vc=/^(none|table(?!-c[ea]).+)/,Xb=/^margin/,jc=RegExp("^("+Ia+")(.*)$","i"),Va=RegExp("^("+Ia+")(?!px)[a-z%]+$","i"),Wc=RegExp("^([+-])=("+Ia+")","i"),qb={BODY:"block"},
Xc={position:"absolute",visibility:"hidden",display:"block"},Yb={letterSpacing:0,fontWeight:400},ja=["Top","Right","Bottom","Left"],pb=["Webkit","O","Moz","ms"];g.fn.extend({css:function(c,d){return g.access(this,function(c,d,e){var h,i={},t=0;if(g.isArray(d)){e=a.getComputedStyle(c,null);for(h=d.length;h>t;t++)i[d[t]]=g.css(c,d[t],!1,e);return i}return e!==b?g.style(c,d,e):g.css(c,d)},c,d,1<arguments.length)},show:function(){return O(this,!0)},hide:function(){return O(this)},toggle:function(a){var b=
"boolean"==typeof a;return this.each(function(){(b?a:G(this))?g(this).show():g(this).hide()})}});g.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=ra(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,c,d,e){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var h,i,j,k=g.camelCase(c),l=a.style;return c=g.cssProps[k]||(g.cssProps[k]=L(l,k)),j=
g.cssHooks[c]||g.cssHooks[k],d===b?j&&"get"in j&&(h=j.get(a,!1,e))!==b?h:l[c]:(i=typeof d,"string"===i&&(h=Wc.exec(d))&&(d=(h[1]+1)*h[2]+parseFloat(g.css(a,c)),i="number"),null==d||"number"===i&&isNaN(d)||("number"!==i||g.cssNumber[k]||(d+="px"),g.support.clearCloneStyle||""!==d||0!==c.indexOf("background")||(l[c]="inherit"),j&&"set"in j&&(d=j.set(a,d,e))===b||(l[c]=d)),b)}},css:function(a,c,d,e){var h,i,j,k=g.camelCase(c);return c=g.cssProps[k]||(g.cssProps[k]=L(a.style,k)),j=g.cssHooks[c]||g.cssHooks[k],
j&&"get"in j&&(h=j.get(a,!0,d)),h===b&&(h=ra(a,c,e)),"normal"===h&&c in Yb&&(h=Yb[c]),""===d||d?(i=parseFloat(h),!0===d||g.isNumeric(i)?i||0:h):h}});ra=function(c,d,e){var h,i,j,k=(e=e||a.getComputedStyle(c,null))?e.getPropertyValue(d)||e[d]:b,l=c.style;return e&&(""!==k||g.contains(c.ownerDocument,c)||(k=g.style(c,d)),Va.test(k)&&Xb.test(d)&&(h=l.width,i=l.minWidth,j=l.maxWidth,l.minWidth=l.maxWidth=l.width=k,k=e.width,l.width=h,l.minWidth=i,l.maxWidth=j)),k};g.each(["height","width"],function(c,
d){g.cssHooks[d]={get:function(a,c,e){return c?0===a.offsetWidth&&Vc.test(g.css(a,"display"))?g.swap(a,Xc,function(){return D(a,d,e)}):D(a,d,e):b},set:function(b,c,e){var h=e&&a.getComputedStyle(b,null);return H(b,c,e?P(b,d,e,g.support.boxSizing&&"border-box"===g.css(b,"boxSizing",!1,h),h):0)}}});g(function(){g.support.reliableMarginRight||(g.cssHooks.marginRight={get:function(a,c){return c?g.swap(a,{display:"inline-block"},ra,[a,"marginRight"]):b}});!g.support.pixelPosition&&g.fn.position&&g.each(["top",
"left"],function(a,c){g.cssHooks[c]={get:function(a,d){return d?(d=ra(a,c),Va.test(d)?g(a).position()[c]+"px":d):b}}})});g.expr&&g.expr.filters&&(g.expr.filters.hidden=function(a){return 0>=a.offsetWidth&&0>=a.offsetHeight},g.expr.filters.visible=function(a){return!g.expr.filters.hidden(a)});g.each({margin:"",padding:"",border:"Width"},function(a,b){g.cssHooks[a+b]={expand:function(c){for(var d=0,e={},c="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+ja[d]+b]=c[d]||c[d-2]||c[0];return e}};Xb.test(a)||
(g.cssHooks[a+b].set=H)});var Yc=/%20/g,kc=/\[\]$/,Zb=/\r?\n/g,Zc=/^(?:submit|button|image|reset|file)$/i,$c=/^(?:input|select|textarea|keygen)/i;g.fn.extend({serialize:function(){return g.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=g.prop(this,"elements");return a?g.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!g(this).is(":disabled")&&$c.test(this.nodeName)&&!Zc.test(a)&&(this.checked||!Vb.test(a))}).map(function(a,b){var c=
g(this).val();return null==c?null:g.isArray(c)?g.map(c,function(a){return{name:b.name,value:a.replace(Zb,"\r\n")}}):{name:b.name,value:c.replace(Zb,"\r\n")}}).get()}});g.param=function(a,c){var d,e=[],h=function(a,b){b=g.isFunction(b)?b():null==b?"":b;e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(c===b&&(c=g.ajaxSettings&&g.ajaxSettings.traditional),g.isArray(a)||a.jquery&&!g.isPlainObject(a))g.each(a,function(){h(this.name,this.value)});else for(d in a)Wa(d,a[d],c,h);return e.join("&").replace(Yc,
"+")};g.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){g.fn[b]=function(a,c){return 0<arguments.length?this.on(b,null,a,c):this.trigger(b)}});g.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},
delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var qa,ia,lb=g.now(),mb=/\?/,ad=/#.*$/,$b=/([?&])_=[^&]*/,bd=/^(.*?):[ \t]*([^\r\n]*)$/gm,cd=/^(?:GET|HEAD)$/,dd=/^\/\//,ac=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,bc=g.fn.load,cc={},Xa={},dc="*/".concat("*");try{ia=mc.href}catch(kd){ia=C.createElement("a"),ia.href="",ia=ia.href}qa=ac.exec(ia.toLowerCase())||[];g.fn.load=function(a,c,d){if("string"!=
typeof a&&bc)return bc.apply(this,arguments);var e,h,i,j=this,k=a.indexOf(" ");return 0<=k&&(e=a.slice(k),a=a.slice(0,k)),g.isFunction(c)?(d=c,c=b):c&&"object"==typeof c&&(h="POST"),0<j.length&&g.ajax({url:a,type:h,dataType:"html",data:c}).done(function(a){i=arguments;j.html(e?g("<div>").append(g.parseHTML(a)).find(e):a)}).complete(d&&function(a,b){j.each(d,i||[a.responseText,b,a])}),this};g.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){g.fn[b]=function(a){return this.on(b,
a)}});g.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ia,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(qa[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":dc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},
converters:{"* text":String,"text html":!0,"text json":g.parseJSON,"text xml":g.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Ya(Ya(a,g.ajaxSettings),b):Ya(g.ajaxSettings,a)},ajaxPrefilter:sb(cc),ajaxTransport:sb(Xa),ajax:function(a,c){function d(a,c,j,t){var l,p,u,q,w=c;if(2!==C){C=2;k&&clearTimeout(k);e=b;i=t||"";F.readyState=0<a?4:0;t=200<=a&&300>a||304===a;if(j){u=n;for(var L=F,z,H,D,B,P=u.contents,O=u.dataTypes;"*"===O[0];)O.shift(),z===b&&(z=u.mimeType||L.getResponseHeader("Content-Type"));
if(z)for(H in P)if(P[H]&&P[H].test(z)){O.unshift(H);break}if(O[0]in j)D=O[0];else{for(H in j){if(!O[0]||u.converters[H+" "+O[0]]){D=H;break}B||(B=H)}D=D||B}u=D?(D!==O[0]&&O.unshift(D),j[D]):b}var ka;a:{j=n;z=u;H=F;D=t;var E,J,K;u={};L=j.dataTypes.slice();if(L[1])for(E in j.converters)u[E.toLowerCase()]=j.converters[E];for(B=L.shift();B;)if(j.responseFields[B]&&(H[j.responseFields[B]]=z),!K&&D&&j.dataFilter&&(z=j.dataFilter(z,j.dataType)),K=B,B=L.shift())if("*"===B)B=K;else if("*"!==K&&K!==B){if(E=
u[K+" "+B]||u["* "+B],!E)for(ka in u)if(J=ka.split(" "),J[1]===B&&(E=u[K+" "+J[0]]||u["* "+J[0]])){!0===E?E=u[ka]:!0!==u[ka]&&(B=J[0],L.unshift(J[1]));break}if(!0!==E)if(E&&j["throws"])z=E(z);else try{z=E(z)}catch(N){ka={state:"parsererror",error:E?N:"No conversion from "+K+" to "+B};break a}}ka={state:"success",data:z}}u=ka;t?(n.ifModified&&(q=F.getResponseHeader("Last-Modified"),q&&(g.lastModified[h]=q),q=F.getResponseHeader("etag"),q&&(g.etag[h]=q)),204===a?w="nocontent":304===a?w="notmodified":
(w=u.state,l=u.data,p=u.error,t=!p)):(p=w,(a||!w)&&(w="error",0>a&&(a=0)));F.status=a;F.statusText=(c||w)+"";t?G.resolveWith(s,[l,w,F]):G.rejectWith(s,[F,w,p]);F.statusCode(A);A=b;m&&v.trigger(t?"ajaxSuccess":"ajaxError",[F,n,t?l:p]);I.fireWith(s,[F,w]);m&&(v.trigger("ajaxComplete",[F,n]),--g.active||g.event.trigger("ajaxStop"))}}"object"==typeof a&&(c=a,a=b);var c=c||{},e,h,i,j,k,l,m,q,n=g.ajaxSetup({},c),s=n.context||n,v=n.context&&(s.nodeType||s.jquery)?g(s):g.event,G=g.Deferred(),I=g.Callbacks("once memory"),
A=n.statusCode||{},L={},z={},C=0,H="canceled",F={readyState:0,getResponseHeader:function(a){var b;if(2===C){if(!j)for(j={};b=bd.exec(i);)j[b[1].toLowerCase()]=b[2];b=j[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===C?i:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return C||(a=z[c]=z[c]||a,L[a]=b),this},overrideMimeType:function(a){return C||(n.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>C)for(b in a)A[b]=[A[b],a[b]];else F.always(a[F.status]);
return this},abort:function(a){a=a||H;return e&&e.abort(a),d(0,a),this}};if(G.promise(F).complete=I.add,F.success=F.done,F.error=F.fail,n.url=((a||n.url||ia)+"").replace(ad,"").replace(dd,qa[1]+"//"),n.type=c.method||c.type||n.method||n.type,n.dataTypes=g.trim(n.dataType||"*").toLowerCase().match(Z)||[""],null==n.crossDomain&&(l=ac.exec(n.url.toLowerCase()),n.crossDomain=!(!l||l[1]===qa[1]&&l[2]===qa[2]&&(l[3]||("http:"===l[1]?"80":"443"))===(qa[3]||("http:"===qa[1]?"80":"443")))),n.data&&n.processData&&
"string"!=typeof n.data&&(n.data=g.param(n.data,n.traditional)),tb(cc,n,c,F),2===C)return F;(m=n.global)&&0===g.active++&&g.event.trigger("ajaxStart");n.type=n.type.toUpperCase();n.hasContent=!cd.test(n.type);h=n.url;n.hasContent||(n.data&&(h=n.url+=(mb.test(h)?"&":"?")+n.data,delete n.data),!1===n.cache&&(n.url=$b.test(h)?h.replace($b,"$1_="+lb++):h+(mb.test(h)?"&":"?")+"_="+lb++));n.ifModified&&(g.lastModified[h]&&F.setRequestHeader("If-Modified-Since",g.lastModified[h]),g.etag[h]&&F.setRequestHeader("If-None-Match",
g.etag[h]));(n.data&&n.hasContent&&!1!==n.contentType||c.contentType)&&F.setRequestHeader("Content-Type",n.contentType);F.setRequestHeader("Accept",n.dataTypes[0]&&n.accepts[n.dataTypes[0]]?n.accepts[n.dataTypes[0]]+("*"!==n.dataTypes[0]?", "+dc+"; q=0.01":""):n.accepts["*"]);for(q in n.headers)F.setRequestHeader(q,n.headers[q]);if(n.beforeSend&&(!1===n.beforeSend.call(s,F,n)||2===C))return F.abort();H="abort";for(q in{success:1,error:1,complete:1})F[q](n[q]);if(e=tb(Xa,n,c,F)){F.readyState=1;m&&
v.trigger("ajaxSend",[F,n]);n.async&&0<n.timeout&&(k=setTimeout(function(){F.abort("timeout")},n.timeout));try{C=1,e.send(L,d)}catch(D){if(!(2>C))throw D;d(-1,D)}}else d(-1,"No Transport");return F},getJSON:function(a,b,c){return g.get(a,b,c,"json")},getScript:function(a,c){return g.get(a,b,c,"script")}});g.each(["get","post"],function(a,c){g[c]=function(a,d,e,h){return g.isFunction(d)&&(h=h||e,e=d,d=b),g.ajax({url:a,type:c,dataType:h,data:d,success:e})}});g.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},
contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return g.globalEval(a),a}}});g.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1);a.crossDomain&&(a.type="GET")});g.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=g("<script>").prop({async:!0,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove();c=null;a&&e("error"===a.type?404:200,a.type)});C.head.appendChild(b[0])},abort:function(){c&&c()}}}});
var ec=[],nb=/(=)\?(?=&|$)|\?\?/;g.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=ec.pop()||g.expando+"_"+lb++;return this[a]=!0,a}});g.ajaxPrefilter("json jsonp",function(c,d,e){var h,i,j,k=!1!==c.jsonp&&(nb.test(c.url)?"url":"string"==typeof c.data&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&nb.test(c.data)&&"data");return k||"jsonp"===c.dataTypes[0]?(h=c.jsonpCallback=g.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,k?c[k]=c[k].replace(nb,"$1"+
h):!1!==c.jsonp&&(c.url+=(mb.test(c.url)?"&":"?")+c.jsonp+"="+h),c.converters["script json"]=function(){return j||g.error(h+" was not called"),j[0]},c.dataTypes[0]="json",i=a[h],a[h]=function(){j=arguments},e.always(function(){a[h]=i;c[h]&&(c.jsonpCallback=d.jsonpCallback,ec.push(h));j&&g.isFunction(i)&&i(j[0]);j=i=b}),"script"):b});g.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var za=g.ajaxSettings.xhr(),ed={"0":200,1223:204},fd=0,Aa={};a.ActiveXObject&&g(a).on("unload",
function(){for(var a in Aa)Aa[a]();Aa=b});g.support.cors=!!za&&"withCredentials"in za;g.support.ajax=za=!!za;g.ajaxTransport(function(a){var c;return g.support.cors||za&&!a.crossDomain?{send:function(d,e){var g,h,i=a.xhr();if(i.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(g in a.xhrFields)i[g]=a.xhrFields[g];a.mimeType&&i.overrideMimeType&&i.overrideMimeType(a.mimeType);a.crossDomain||d["X-Requested-With"]||(d["X-Requested-With"]="XMLHttpRequest");for(g in d)i.setRequestHeader(g,
d[g]);c=function(a){return function(){c&&(delete Aa[h],c=i.onload=i.onerror=null,"abort"===a?i.abort():"error"===a?e(i.status||404,i.statusText):e(ed[i.status]||i.status,i.statusText,"string"==typeof i.responseText?{text:i.responseText}:b,i.getAllResponseHeaders()))}};i.onload=c();i.onerror=c("error");c=Aa[h=fd++]=c("abort");i.send(a.hasContent&&a.data||null)},abort:function(){c&&c()}}:b});var sa,Ua,gd=/^(?:toggle|show|hide)$/,hd=RegExp("^(?:([+-])=|)("+Ia+")([a-z%]*)$","i"),id=/queueHooks$/,Ca=[function(a,
c,d){var e,h,i,j,k,l,n=this,m=a.style,q={},s=[],v=a.nodeType&&G(a);d.queue||(k=g._queueHooks(a,"fx"),null==k.unqueued&&(k.unqueued=0,l=k.empty.fire,k.empty.fire=function(){k.unqueued||l()}),k.unqueued++,n.always(function(){n.always(function(){k.unqueued--;g.queue(a,"fx").length||k.empty.fire()})}));1===a.nodeType&&("height"in c||"width"in c)&&(d.overflow=[m.overflow,m.overflowX,m.overflowY],"inline"===g.css(a,"display")&&"none"===g.css(a,"float")&&(m.display="inline-block"));d.overflow&&(m.overflow=
"hidden",n.always(function(){m.overflow=d.overflow[0];m.overflowX=d.overflow[1];m.overflowY=d.overflow[2]}));j=A.get(a,"fxshow");for(e in c)if(i=c[e],gd.exec(i)){if(delete c[e],h=h||"toggle"===i,i===(v?"hide":"show")){if("show"!==i||j===b||j[e]===b)continue;v=!0}s.push(e)}if(c=s.length){j=A.get(a,"fxshow")||A.access(a,"fxshow",{});"hidden"in j&&(v=j.hidden);h&&(j.hidden=!v);v?g(a).show():n.done(function(){g(a).hide()});n.done(function(){var b;A.remove(a,"fxshow");for(b in q)g.style(a,b,q[b])});for(e=
0;c>e;e++)h=s[e],i=n.createTween(h,v?j[h]:0),q[h]=j[h]||g.style(a,h),h in j||(j[h]=i.start,v&&(i.end=i.start,i.start="width"===h||"height"===h?1:0))}}],wa={"*":[function(a,b){var c,d,e=this.createTween(a,b),h=hd.exec(b),i=e.cur(),j=+i||0,k=1,l=20;if(h){if(c=+h[2],d=h[3]||(g.cssNumber[a]?"":"px"),"px"!==d&&j){j=g.css(e.elem,a,!0)||c||1;do k=k||".5",j/=k,g.style(e.elem,a,j+d);while(k!==(k=e.cur()/i)&&1!==k&&--l)}e.unit=d;e.start=j;e.end=h[1]?j+(h[1]+1)*c:c}return e}]};g.Animation=g.extend(vb,{tweener:function(a,
b){g.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],wa[c]=wa[c]||[],wa[c].unshift(b)},prefilter:function(a,b){b?Ca.unshift(a):Ca.push(a)}});g.Tween=R;R.prototype={constructor:R,init:function(a,b,c,d,e,h){this.elem=a;this.prop=c;this.easing=e||"swing";this.options=b;this.start=this.now=this.cur();this.end=d;this.unit=h||(g.cssNumber[c]?"":"px")},cur:function(){var a=R.propHooks[this.prop];return a&&a.get?a.get(this):R.propHooks._default.get(this)},run:function(a){var b,
c=R.propHooks[this.prop];return this.pos=b=this.options.duration?g.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):R.propHooks._default.set(this),this}};R.prototype.init.prototype=R.prototype;R.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=g.css(a.elem,a.prop,""),b&&"auto"!==
b?b:0):a.elem[a.prop]},set:function(a){g.fx.step[a.prop]?g.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[g.cssProps[a.prop]]||g.cssHooks[a.prop])?g.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}};R.propHooks.scrollTop=R.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}};g.each(["toggle","show","hide"],function(a,b){var c=g.fn[b];g.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(Da(b,!0),
a,d,e)}});g.fn.extend({fadeTo:function(a,b,c,d){return this.filter(G).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=g.isEmptyObject(a),h=g.speed(b,c,d),i=function(){var b=vb(this,g.extend({},a),h);i.finish=function(){b.stop(!0)};(e||A.get(this,"finish"))&&b.stop(!0)};return i.finish=i,e||!1===h.queue?this.each(i):this.queue(h.queue,i)},stop:function(a,c,d){var e=function(a){var b=a.stop;delete a.stop;b(d)};return"string"!=typeof a&&(d=c,c=a,a=b),c&&!1!==
a&&this.queue(a||"fx",[]),this.each(function(){var b=!0,c=null!=a&&a+"queueHooks",h=g.timers,i=A.get(this);if(c)i[c]&&i[c].stop&&e(i[c]);else for(c in i)i[c]&&i[c].stop&&id.test(c)&&e(i[c]);for(c=h.length;c--;)h[c].elem!==this||null!=a&&h[c].queue!==a||(h[c].anim.stop(d),b=!1,h.splice(c,1));(b||!d)&&g.dequeue(this,a)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var b,c=A.get(this),d=c[a+"queue"];b=c[a+"queueHooks"];var e=g.timers,h=d?d.length:0;c.finish=!0;g.queue(this,a,[]);
b&&b.cur&&b.cur.finish&&b.cur.finish.call(this);for(b=e.length;b--;)e[b].elem===this&&e[b].queue===a&&(e[b].anim.stop(!0),e.splice(b,1));for(b=0;h>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}});g.each({slideDown:Da("show"),slideUp:Da("hide"),slideToggle:Da("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){g.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}});g.speed=function(a,b,c){var d=a&&"object"==typeof a?g.extend({},
a):{complete:c||!c&&b||g.isFunction(a)&&a,duration:a,easing:c&&b||b&&!g.isFunction(b)&&b};return d.duration=g.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in g.fx.speeds?g.fx.speeds[d.duration]:g.fx.speeds._default,(null==d.queue||!0===d.queue)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){g.isFunction(d.old)&&d.old.call(this);d.queue&&g.dequeue(this,d.queue)},d};g.easing={linear:function(a){return a},swing:function(a){return 0.5-Math.cos(a*Math.PI)/2}};g.timers=[];g.fx=R.prototype.init;
g.fx.tick=function(){var a,c=g.timers,d=0;for(sa=g.now();c.length>d;d++)a=c[d],a()||c[d]!==a||c.splice(d--,1);c.length||g.fx.stop();sa=b};g.fx.timer=function(a){a()&&g.timers.push(a)&&g.fx.start()};g.fx.interval=13;g.fx.start=function(){Ua||(Ua=setInterval(g.fx.tick,g.fx.interval))};g.fx.stop=function(){clearInterval(Ua);Ua=null};g.fx.speeds={slow:600,fast:200,_default:400};g.fx.step={};g.expr&&g.expr.filters&&(g.expr.filters.animated=function(a){return g.grep(g.timers,function(b){return a===b.elem}).length});
g.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){g.offset.setOffset(this,a,b)});var c,d,e=this[0],h={top:0,left:0},i=e&&e.ownerDocument;if(i)return c=i.documentElement,g.contains(c,e)?(typeof e.getBoundingClientRect!==Fa&&(h=e.getBoundingClientRect()),d=g.isWindow(i)?i:9===i.nodeType&&i.defaultView,{top:h.top+d.pageYOffset-c.clientTop,left:h.left+d.pageXOffset-c.clientLeft}):h};g.offset={setOffset:function(a,b,c){var d,e,h,i,j,k,l=g.css(a,"position"),n=g(a),m={};
"static"===l&&(a.style.position="relative");j=n.offset();h=g.css(a,"top");k=g.css(a,"left");("absolute"===l||"fixed"===l)&&-1<(h+k).indexOf("auto")?(d=n.position(),i=d.top,e=d.left):(i=parseFloat(h)||0,e=parseFloat(k)||0);g.isFunction(b)&&(b=b.call(a,c,j));null!=b.top&&(m.top=b.top-j.top+i);null!=b.left&&(m.left=b.left-j.left+e);"using"in b?b.using.call(a,m):n.css(m)}};g.fn.extend({position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===g.css(c,"position")?b=c.getBoundingClientRect():
(a=this.offsetParent(),b=this.offset(),g.nodeName(a[0],"html")||(d=a.offset()),d.top+=g.css(a[0],"borderTopWidth",!0),d.left+=g.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-g.css(c,"marginTop",!0),left:b.left-d.left-g.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||xb;a&&!g.nodeName(a,"html")&&"static"===g.css(a,"position");)a=a.offsetParent;return a||xb})}});g.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(c,d){var e=
"pageYOffset"===d;g.fn[c]=function(h){return g.access(this,function(c,h,i){var j=g.isWindow(c)?c:9===c.nodeType&&c.defaultView;return i===b?j?j[d]:c[h]:(j?j.scrollTo(e?a.pageXOffset:i,e?i:a.pageYOffset):c[h]=i,b)},c,h,arguments.length,null)}});g.each({Height:"height",Width:"width"},function(a,c){g.each({padding:"inner"+a,content:c,"":"outer"+a},function(d,e){g.fn[e]=function(e,h){var i=arguments.length&&(d||"boolean"!=typeof e),j=d||(!0===e||!0===h?"margin":"border");return g.access(this,function(c,
d,e){var h;return g.isWindow(c)?c.document.documentElement["client"+a]:9===c.nodeType?(h=c.documentElement,Math.max(c.body["scroll"+a],h["scroll"+a],c.body["offset"+a],h["offset"+a],h["client"+a])):e===b?g.css(c,d,j):g.style(c,d,e,j)},c,i?e:b,i,null)}})});g.fn.size=function(){return this.length};g.fn.andSelf=g.fn.addBack;"object"==typeof module&&"object"==typeof module.exports?module.exports=g:"function"==typeof define&&define.amd&&define("jquery",[],function(){return g});"object"==typeof a&&"object"==
typeof a.document&&(a.jQuery=a.$=g)})(window);var ResourceLoader;
(function(){var a,b=new Audio,c="ogg";"maybe"==b.canPlayType("audio/mp4")?c="mp4":"maybe"==b.canPlayType("audio/ogg")?c="ogg":"maybe"==b.canPlayType("audio/mp3")?c="mp3":"maybe"==b.canPlayType("audio/wav")&&(c="wav");a=c;var d=function(){var a=document.createElement("video");if("maybe"==a.canPlayType("video/webm"))return"webm";if("maybe"==a.canPlayType("video/mp4"))return"mp4";if("maybe"==a.canPlayType("video/ogg"))return"ogv"}(),e=3,h=3,j={},k={},m=function(a,b,c){var d=$.Deferred();c||(c="video"==
b?document.createElement("video"):new Audio);$(c).one("canplaythrough stalled suspend",function(){d.resolve(c)});$(c).one("error",function(){d.reject()});c.autoplay=!1;c.src="";c.src=a;c.load();setTimeout(function(){d.reject()},1E4);return d.promise()};ResourceLoader={loadImage:function(a,b){"undefined"===typeof b&&(b=!0);var c=a;a in o2.imageList&&(a=o2.imageList[a]);if(a in k)return k[a].promise();var d=$.Deferred();if(a in j)d.resolve(j[a]);else{k[a]=d;var e=0,h,m=function(){var j=a,k=$.Deferred(),
H=new Image;$(H).one("readystatechange load",function(){H.complete||4==H.readyState||"complete"==H.readyState?k.resolve(H):$(H).trigger("error")});$(H).one("error",function(a){k.reject(a)});var L=setTimeout(function(){$(H).trigger("error")},1E4);k.always(function(){clearTimeout(L)});$(H).attr("src",j);h=k.promise();h.done(function(a){a.originalURL=c;d.resolve(a)}).fail(function(a){(browser.isIOs||browser.isAndroid)&&!navigator.onLine||10>e?(setTimeout(m,100),e++,b&&Renderer.showLoadingSign()):b?(Renderer.hideLoadingSign(),
Renderer.showServerError(function(){e=0;b&&Renderer.showLoadingSign();m()})):d.reject(a)})};m();var L;b&&(L=setTimeout(function(){Renderer.showLoadingSign()},3E3));d.done(function(b){j[a]=b});d.always(function(){b&&(clearTimeout(L),Renderer.hideLoadingSign());delete d[a]})}return d.promise()},loadAudio:function(b,c,d){function h(){m(b+"."+a,"audio",d).done(function(a){j.resolve(a)}).fail(function(a){(browser.isIOs||browser.isAndroid)&&!navigator.onLine||k<e?(setTimeout(h,100),k++,c&&Renderer.showLoadingSign()):
c?(Renderer.hideLoadingSign(),Renderer.showServerError(function(){k=0;c&&Renderer.showLoadingSign();h()})):j.reject(a)})}"undefined"===typeof c&&(c=!0);b in o2.soundList&&(b=o2.soundList[b]);var j=$.Deferred(),k=0;h();var v;c&&(v=setTimeout(function(){Renderer.showLoadingSign()},3E3));j.always(function(){c&&(clearTimeout(v),Renderer.hideLoadingSign())});return j.promise()},loadVideo:function(a,b,c){function e(){m(a+"."+d,"video",c).done(function(a){j.resolve(a)}).fail(function(a){(browser.isIOs||
browser.isAndroid)&&!navigator.onLine||k<h?(setTimeout(e,100),k++,b&&Renderer.showLoadingSign()):b?(Renderer.hideLoadingSign(),Renderer.showServerError(function(){k=0;b&&Renderer.showLoadingSign();e()})):j.reject(a)})}"undefined"===typeof b&&(b=!0);if(a in o2.videoList)a=o2.videoList[a];else throw a+"\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u306fvideoList\u306b\u306a\u3044\u3067\u3059";var j=$.Deferred(),k=0;e();var v;b&&(v=setTimeout(function(){Renderer.showLoadingSign()},3E3));j.always(function(){b&&
(clearTimeout(v),Renderer.hideLoadingSign())});return j.promise()}}})();
var Conductor=function(a){this.waitTag={};this.file;this.lineNumber=-1;this.currentTag;this.stack=[];this.status=Conductor.STATUS_STOP;this.callStack=[];this.macroStack=[];this.macros={};this.ifStack=[];a.file&&this.setFile(a.file);var b=this;this.stack.push=function(a){if(a instanceof Tag){var d=Array.prototype.push.apply(this,arguments);if("click"in b.waitTag)trigger("click");else if(b.status==Conductor.STATUS_STOP)b.oneShot();return d}}};Conductor.STATUS_STOP=0;Conductor.STATUS_RUN=1;
Conductor.STATUS_WAIT=2;Conductor.prototype.toJSON=function(){return{currentTag:this.currentTag,macroStack:this.macroStack}};Conductor.prototype.importFromSaveData=function(a){this.macroStack=[];this.setTag(a.currentTag.restore(),!0);var b=this;this.status!=Conductor.STATUS_RUN&&setTimeout(function(){b.oneShot()});delete a.currentTag;return Object.prototype.importFromSaveData.call(this,a)};
Conductor.prototype.run=function(){this.waitTag={};this.status=Conductor.STATUS_RUN;if(this.stack.length)this.currentTag=this.stack.shift();else{this.currentTag=this.file.lines[this.lineNumber];if(!this.currentTag)return;var a="\u30d5\u30a1\u30a4\u30eb\uff1a"+this.file.filename+"\u3002",a=a+("\u884c\uff1a"+(this.currentTag.originalLineNumber||this.currentTag.lineNumber)+"\u3002");"undefined"!=typeof this.currentTag.originalCharNumber&&(a+="\u6587\u5b57\uff1a"+this.currentTag.originalCharNumber+"\u3002");
a+="\u30bf\u30b0\u540d\uff1a"+this.currentTag.tagName;console.log(a);this.lineNumber++}if(this.isMacro(this.currentTag))this.jumpIntoMacro(this.currentTag);else if(this.shouldMacroEnd())this.jumpOutOfMacro();else{a=!0;if("o2_cond"in this.currentTag.args)try{eval(this.currentTag.args.o2_cond)||(a=!1)}catch(b){a=!1}a=a?this.currentTag.run():0;if(0==a||void 0==a)this.oneShot();else 1==a?wait(this.currentTag.tagName):2==a&&(conductor.status=Conductor.STATUS_STOP)}};Conductor.prototype.setFile=function(a){this.setTag(a.line(0))};
Conductor.prototype.setTag=function(a,b){this.file=a.file;this.lineNumber=a.lineNumber;b&&this.lineNumber++};Conductor.prototype.getNextTag=function(a){if(!a)return this.stack.length?this.stack[0]:this.file.lines[this.lineNumber];for(var b=this.upCommingTags(),c=0;c<b.length;c++)if(b[c].tagName==a)return b[c]};Conductor.prototype.upCommingTags=function(){return this.stack.concat(this.file.lines.slice(this.lineNumber))};Conductor.prototype.oneShot=function(){this.run()};
(function(){function a(){window.mp=currentConductor.macroStack.length?currentConductor.macroStack[currentConductor.macroStack.length-1].args:{}}Conductor.prototype.isMacro=function(a){a instanceof Tag&&(a=a.tagName);return a in this.macros};Conductor.prototype.jumpIntoMacro=function(b){var c=new Macro,d;if(b instanceof Tag){d=this.macros[b.tagName];if(!d)throw b.tagName+"\u3068\u3044\u3046\u30de\u30af\u30ed\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u3002";c.args=b.argsForAction()}else d=this.macros[b];
c.definition=d;c.returnTag=this.getNextTag();this.macroStack.push(c);a();this.setTag(d.startTag);this.oneShot()};Conductor.prototype.shouldMacroEnd=function(){return!this.macroStack.length?!1:"endmacro"==this.currentTag.tagName?!0:!1};Conductor.prototype.jumpOutOfMacro=function(){var b=this.macroStack.pop();a();b&&this.setTag(b.returnTag);this.oneShot()};Conductor.prototype.clearMacroStack=function(){this.macroStack=[];a()}})();Conductor.prototype.clearIfStack=function(){this.ifStack=[]};
Conductor.prototype.wait=function(a,b){conductor.status=Conductor.STATUS_WAIT;a in this.waitTag||(this.waitTag[a]=[]);b&&this.waitTag[a].push(b)};Conductor.prototype.trigger=function(a){var b=[],c=!1;a instanceof Tag&&(a in this.waitTag&&(c=!0,b=b.concat(this.waitTag[a])),a=a.tagName);a in this.waitTag&&a in this.waitTag&&(c=!0,b=b.concat(this.waitTag[a]));for(a=0;a<b.length;a++)b[a]();if(c)this.oneShot()};trigger=function(){currentConductor.trigger.apply(currentConductor,arguments)};
wait=function(){currentConductor.wait.apply(currentConductor,arguments)};MacroDefinition=function(a){this.startTag=a.startTag;this.endTag=a.endTag};Macro=function(a){a&&(this.definition=a.definition,this.returnTag=a.returnTag,this.args=a.args)};Macro.prototype.initializer="Macro";
function clone(a,b){if(a&&a.clone&&"function"===typeof a.clone)return a.clone(a);if(null==a||"object"!=typeof a||/\[object HTML[A-Za-z]*Element\]/.test(Object.prototype.toString.apply(a))||/\[object Window\]/.test(Object.prototype.toString.apply(a)))return a;if(a instanceof Date){var c=new Date;c.setTime(a.getTime());return c}if(a instanceof Array){for(var c=[],d=0,e=a.length;d<e;d++)c[d]=clone(a[d]);return c}if(a instanceof Object){c=window[a.initializer]?new window[a.initializer]:new a.constructor;
b&&(c.originalReference=a);if("function"===typeof c.importFrom)c.importFrom(a);else for(d in a)a.hasOwnProperty(d)&&(c[d]=clone(a[d]));return c}throw Error("Unable to copy obj! Its type isn't supported.");}
browser={isIE:-1!=navigator.userAgent.indexOf("MSIE"),isFirefox:-1!=navigator.userAgent.toLowerCase().indexOf("firefox"),isNativeApp:-1!=navigator.userAgent.toLowerCase().indexOf("adsphere"),isIOs:navigator.userAgent.match(/(iPad|iPhone|iPod)/i)?!0:!1,isAndroid:navigator.userAgent.match(/(android)/i)?!0:!1};
Event.prototype.normalizedCoordinate=function(a){var b=document.getElementById("main-wrapper");returnCoordinate=this.changedTouches?{x:(this.changedTouches[0].pageX-b.getBoundingClientRect().left)/scale+0,y:(this.changedTouches[0].pageY-b.getBoundingClientRect().top)/scale+0}:{x:(this.clientX-b.getBoundingClientRect().left)/scale+0,y:(this.clientY-b.getBoundingClientRect().top)/scale+0};a instanceof Layer&&(returnCoordinate=a.localLocation(returnCoordinate.x,returnCoordinate.y));return returnCoordinate};
var scaleToFitPage,scale=1;
(function(){function a(){var a=window,b=document,e=b.documentElement,b=b.getElementsByTagName("body")[0];return{width:a.innerWidth||e.clientWidth||b.clientWidth,height:a.innerHeight||e.clientHeight||b.clientHeight}}var b;scaleToFitPage=function(){var c=a();if(!b||!(b.width==c.width&&b.height==c.height)){var d=document.body;d.style.overflow="hidden";d.style.height=browser.isIOs?2*c.height+"px":c.height+"px";window.scrollTo(0,0);b=c=a();d=Math.min(c.width/config.scWidth,c.height/config.scHeight);scale!=
d&&(scale=d,$("#main-wrapper").css("transformOrigin","0% 0%").css("transform","scale("+scale+")"));$("#main-wrapper").css("top",(c.height-config.scHeight*d)/2+"px").css("left",(c.width-config.scWidth*d)/2+"px");return this}}})();function KeySpline(a,b,c,d){this.get=function(e){if(a==b&&c==d)return e;a:{for(var h=e,j=0;4>j;++j){var k=3*(1-3*c+3*a)*h*h+2*(3*c-6*a)*h+3*a;if(0==k){e=h;break a}h-=((((1-3*c+3*a)*h+(3*c-6*a))*h+3*a)*h-e)/k}e=h}return(((1-3*d+3*b)*e+(3*d-6*b))*e+3*b)*e}}
function B_Spline_Generator(a){var b=a.length,c=b-1,d=b+2,e=(b+1)/100;return function(b){var b=e*(0>b?0:100<b?100:b)-1,j={x:0,y:0},k,m,i,l;for(k=-2;k<d;k++)m=b-k,i=1>(m=Math.abs(m))?(l=3*m*m,(m*l-2*l+4)/6):2>m?(l=m-2,l*l*l/-6):0,m=0>k?0:c<k?c:k,j.x+=a[m][0]*i,j.y+=a[m][1]*i;return j}}
function supportCssProperty(a){"string"==typeof a&&(a=[a]);for(var b=0;b<a.length;b++){var c=a[b],d=document.body;if("string"!=typeof d.style[c]&&"string"!=typeof d.style["Webkit"+c.substring(0,1).toUpperCase()+c.substring(1)]&&"string"!=typeof d.style["Moz"+c.substring(0,1).toUpperCase()+c.substring(1)]&&"string"!=typeof d.style["O"+c.substring(0,1).toUpperCase()+c.substring(1)])return!1}return!0}
(function(){browser.isAndroid&&(window.requestAnimationFrame=function(a){window.setTimeout(a,1E3/60)});for(var a=0,b=Date.now(),c=["ms","moz","webkit","o"],d=0;d<c.length&&!window.requestAnimationFrame;++d)window.requestAnimationFrame=window[c[d]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[c[d]+"CancelAnimationFrame"]||window[c[d]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(c){var d=(new Date).getTime(),j=Math.max(0,16-(d-a)),
k=window.setTimeout(function(){c(d-b)},j);a=d+j;return k});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})})();(function(){if(window.chrome){var a=CanvasRenderingContext2D.prototype.fillText;CanvasRenderingContext2D.prototype.fillText=function(b,c,d,e){if(-1==b.indexOf("\u3000"))return a.apply(this,arguments);for(var h=b.split(""),j=c,k=0;k<h.length;k++){var m=h[k],i=this.measureText(m).width;if(c+i-j>e)break;a.call(this,m,c,d);c+=i}}}})();
Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};d.prototype=this.prototype;e.prototype=new d;return e});
function hexToRgb(a){return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}$(function(){$.fn.bindFirst=function(a,b){this.on(a,b);this.each(function(){var b=$._data(this,"events")[a.split(".")[0]],d=b.pop();b.splice(0,0,d)})}});
function wheelDistance(a){a||(a=event);var b=0,c=0,c=a.wheelDelta,d=a.detail;d?c?c=0<c/d/40*d?1:-1:a.deltaX||a.deltaY?(b=a.deltaX,c=a.deltaY):c=-d/3:a.wheelDeltaX||a.wheelDeltaY?(c=a.wheelDeltaY/120,b=a.wheelDeltaX/120):a.deltaX||a.deltaY?(b=-a.deltaX/3,c=-a.deltaY/3):c/=120;"DOMMouseScroll"==a.type?(c*=40,b*=40):browser.isIE||(c*=10,b*=10);return{x:b,y:c}}
function multiplyMatrix(a,b){for(var c=a.length,d=a[0].length,e=b[0].length,h=[],j=0;j<c;j++){h[j]=[];for(var k=0;k<e;k++){for(var m=0,i=0;i<d;i++)m+=a[j][i]*b[i][k];h[j][k]=m}}return h}var KAGFiles,KAGFile;
(function(){var a={};KAGFiles=function(b,c){return void 0==c?a[b]:a[b]=c};KAGFile=function(a){this.filename=a;this.lines=[];this.labels=[];KAGFiles(a,this);var c=this;this.lines.push=function(a){a.file=c;a.lineNumber=this.length;"label"==a.tagName&&c.labels.push(a);return Array.prototype.push.apply(this,arguments)}};KAGFile.prototype.line=function(a){return this.lines[a]};KAGFile.prototype.getLabelTag=function(a){for(var c=0;c<this.labels.length;c++)if(this.labels[c].args.name==a)return this.labels[c];
return null}})();Rect=function(){if(4==arguments.length)return new Rect({x:arguments[0],y:arguments[1],width:arguments[2],height:arguments[3]});if(1==arguments.length&&"object"===typeof arguments[0])for(var a in arguments[0])this[a]=arguments[0][a];else this.x=this.y=this.width=this.height=0};Rect.prototype.initializer="Rect";Rect.prototype.isEqual=function(a){return a.x==this.x&&a.y==this.y&&a.width==this.width&&a.height==this.height};
Rect.prototype.isZero=function(){return this.isEqual(new Rect(0,0,0,0))};Rect.prototype.coverCoordinate=function(a,b){return a>=this.x&&a<this.x+this.width&&b>this.y&&b<this.y+this.height?!0:!1};Rect.prototype.extend=function(a){(0==this.width||0==this.height)&&$.extend(this,a);var b=Math.min(a.x,this.x),c=Math.min(a.y,this.y),d=Math.max(a.x+a.width,this.x+this.width);maxY=Math.max(a.y+a.height,this.y+this.height);this.x=b;this.y=c;this.width=d-b;this.height=maxY-c};
Rect.prototype.intersect=function(a){if(a.x+a.width>this.x&&a.x<this.x+this.width&&a.y+a.height>this.y&&a.y<this.y+this.height){var b=Math.max(this.x,a.x),c=Math.max(this.y,a.y),d=Math.min(this.x+this.width,a.x+a.width),a=Math.min(this.y+this.height,a.y+a.height);return new Rect({x:b,y:c,width:d-b,height:a-c})}return!1};Rect.prototype.round=function(){this.x=~~(0.5+this.x);this.y=~~(0.5+this.y);this.width=~~(0.5+this.width);this.height=~~(0.5+this.height)};
Drawable=function(a){this.rect=clone(a)||new Rect;this.needRedraw=!0;this.partialDraw=!1};Drawable.prototype.initializer="Drawable";Drawable.prototype.objectToBeSerialized=function(a){switch(a){case "needRedraw":case "partialDraw":return}return this[a]};Drawable.prototype.importFrom=function(a){this.rect=clone(a.rect);this.transform=clone(a.transform)};Drawable.prototype.drawOnContext=function(){};Drawable.prototype.frame=function(){return this.rect};Drawable.prototype.canDrawPartial=function(){return!1};
DrawableCanvas=function(a){Drawable.call(this,a);this.canvas=document.createElement("canvas");this.canvas.width=this.rect.width;this.canvas.height=this.rect.height;this.ctx=this.canvas.getContext("2d")};DrawableCanvas.prototype=new Drawable;DrawableCanvas.prototype.initializer="DrawableCanvas";DrawableCanvas.prototype.objectToBeSerialized=function(a){switch(a){case canvas:case ctx:return}return this[a]};DrawableCanvas.prototype.canDrawPartial=function(){return!0};
DrawableCanvas.prototype.clone=function(a){var b=new DrawableCanvas;b.importFrom(a);b.canvas.width=this.rect.width;b.canvas.height=this.rect.height;b.ctx.drawImage(a.canvas,0,0);return b};DrawableCanvas.prototype.drawOnContext=function(a,b){if(b){var c=b.intersect(this.rect);a.drawImage(this.canvas,c.x-this.rect.x,c.y-this.rect.y,c.width,c.height,c.x,c.y,c.width,c.height)}else a.drawImage(this.canvas,this.rect.x,this.rect.y,this.rect.width,this.rect.height)};
DrawableSolidColor=function(a){Drawable.call(this,a);this.color="#000000";this.opacity=1};DrawableSolidColor.prototype=new Drawable;DrawableSolidColor.prototype.initializer="DrawableSolidColor";DrawableSolidColor.prototype.canDrawPartial=function(){return!0};DrawableSolidColor.prototype.drawOnContext=function(a,b){b=b?b.intersect(this.rect):this.rect;a.save();a.globalAlpha=this.opacity;a.fillStyle=this.color;a.fillRect(b.x,b.y,b.width,b.height);a.restore()};
DrawableSolidColor.prototype.importFrom=function(a){a instanceof DrawableSolidColor&&(this.color=a.color,this.opacity=a.opacity)};DrawableImage=function(a,b,c){Drawable.call(this);if(null==a)throw"image needed";null==b&&(b=0);null==c&&(c=0);Drawable.call(this,new Rect(b,c,a.width,a.height));this.image=a;this.cacheEnabled=!0;this.cacheCanvas;this.options={}};DrawableImage.prototype=new Drawable;DrawableImage.prototype.initializer="DrawableImage";
DrawableImage.prototype.objectToBeSerialized=function(a){switch(a){case "image":if(this.image.originalURL)return this.image.originalURL;case "cacheCanvas":return}return this[a]};DrawableImage.restore=function(a){return $.when(ResourceLoader.loadImage(a.image,!0)).then(function(b){b=new DrawableImage(b);b.importFrom(a);return b})};DrawableImage.prototype.canDrawPartial=function(){return!0};
DrawableImage.prototype.clone=function(a){if(!(a instanceof DrawableImage))throw"DrawableImage\u3067\u306f\u306a\u3044\u3067\u3059";var b=new DrawableImage(a.image);b.importFrom(a);this.cacheCanvas&&(b.cacheCanvas=document.createElement("canvas"),b.cacheCanvas.width=this.cacheCanvas.width,b.cacheCanvas.height=this.cacheCanvas.height,b.cacheCanvas.getContext("2d").drawImage(this.cacheCanvas,0,0));return b};DrawableImage.prototype.importFrom=function(a){this.options=clone(a.options);this.rect=clone(a.rect)};
DrawableImage.prototype.drawOnContext=function(a,b){b||(b=this.rect);var c=0,d=0,e=this.rect.width,h=this.rect.height;this.options.clipLeft&&(c+=this.options.clipLeft,e-=this.options.clipLeft);this.options.clipTop&&(d+=this.options.clipTop,h-=this.options.clipTop);this.options.clipWidth&&(e=this.options.clipWidth);this.options.clipHeight&&(h=this.options.clipHeight);var j=b.intersect(new Rect({x:this.rect.x,y:this.rect.y,width:e,height:h}));if(j){var k=this.image;if(this.cacheCanvas)k=this.cacheCanvas;
else{var m=this,i,l=function(){$(k).is("canvas")||(m.cacheCanvas=document.createElement("canvas"),m.cacheCanvas.width=k.width,m.cacheCanvas.height=k.height,i=m.cacheCanvas.getContext("2d"),i.drawImage(k,0,0),k=m.cacheCanvas)};if(0!=c||0!=d||e!=this.rect.width||h!=this.rect.height){l();var n=document.createElement("canvas");n.width=e;n.height=h;tempContext=n.getContext("2d");tempContext.drawImage(this.cacheCanvas,c,d,e,h,0,0,e,h);this.cacheCanvas.width=e;this.cacheCanvas.height=h;i.drawImage(n,0,0)}this.options.flipLR&&
(l(),n=document.createElement("canvas"),n.width=this.cacheCanvas.width,n.height=this.cacheCanvas.height,tempContext=n.getContext("2d"),tempContext.translate(this.cacheCanvas.width,0),tempContext.scale(-1,1),tempContext.drawImage(this.cacheCanvas,0,0),i.drawImage(n,0,0));this.options.flipUD&&(l(),n=document.createElement("canvas"),n.width=this.cacheCanvas.width,n.height=this.cacheCanvas.height,tempContext=n.getContext("2d"),tempContext.translate(0,this.cacheCanvas.height),tempContext.scale(1,-1),tempContext.drawImage(this.cacheCanvas,
0,0),i.drawImage(n,0,0));if(this.options.grayscale){l();c=i.getImageData(0,0,k.width,k.height);d=c.data;for(e=0;e<d.length;e+=4)h=0.34*d[e]+0.5*d[e+1]+0.16*d[e+2],d[e]=h,d[e+1]=h,d[e+2]=h;i.putImageData(c,0,0)}}a.save();"opacity"in this.options&&(a.globalAlpha=this.options.opacity);a.drawImage(k,j.x-this.rect.x,j.y-this.rect.y,j.width,j.height,j.x,j.y,j.width,j.height);a.restore();this.cacheEnabled||(this.cacheCanvas=null)}};
var Renderer=function(){this.animator=new Animator(this);this.foreLayers=[];this.backLayers=[];this.foreCanvas=document.createElement("canvas");this.foreCtx=this.foreCanvas.getContext("2d");this.backCanvas=document.createElement("canvas");this.backCtx=this.backCanvas.getContext("2d");this.yShift=this.xShift=0;this.foreCanvas.width=this.backCanvas.width=config.scWidth;this.foreCanvas.height=this.backCanvas.height=config.scHeight;this.renderBackCanvas=!1;this.transForeCanvas;this.transBackCanvas;this.transCanvas};
Renderer.prototype={render:function(){for(var a=-1,b=this.foreLayers.length-1;0<=b;b--)if(this.foreLayers[b].transTag){a=b;break}this.foreCtx.clearRect(0,0,this.foreCanvas.width,this.foreCanvas.height);(this.renderBackCanvas||0<=a)&&this.backCtx.clearRect(0,0,this.backCanvas.width,this.backCanvas.height);this.foreCtx.save();this.foreCtx.translate(this.xShift,this.yShift);for(var c=!1,b=0;b<this.foreLayers.length;b++){var d=this.foreLayers[b],e=this.backLayers[b];d.flush();e.flush();if(d.transTag){this.transForeCanvas||
(this.transForeCanvas=document.createElement("canvas"),this.transBackCanvas=document.createElement("canvas"),this.transCanvas=document.createElement("canvas"),this.transForeCanvas.width=this.transBackCanvas.width=this.transCanvas.width=this.backCanvas.width,this.transForeCanvas.height=this.transBackCanvas.height=this.transCanvas.height=this.foreCanvas.height);var h=this.transForeCanvas.getContext("2d"),j=this.transBackCanvas.getContext("2d");h.clearRect(0,0,this.transForeCanvas.width,this.transForeCanvas.height);
j.clearRect(0,0,this.transBackCanvas.width,this.transBackCanvas.height);j.drawImage(this.backCanvas,0,0);e.drawOnContext(j);h.drawImage(this.foreCanvas,0,0);d.drawOnContext(h);d.transTag.method.transit.call(d.transTag,d.transTag.transArgs,this.transForeCanvas,this.transBackCanvas,this.transCanvas);this.foreCtx.drawImage(this.transCanvas,0,0,this.transCanvas.width,this.transCanvas.height)}else if(d.drawOnContext(this.foreCtx),this.renderBackCanvas||b<=a)c=!0,e.drawOnContext(this.backCtx)}this.foreCtx.restore();
$(this.foreCanvas).trigger("draw");c&&$(this.backCanvas).trigger("draw")}};Renderer.showLoadingSign=function(){$("#loading").show()};Renderer.hideLoadingSign=function(){$("#loading").hide()};Renderer.showServerError=function(a){$("#error").show();$("#retryButton").one("click",function(){Renderer.hideServerError();a()})};Renderer.hideServerError=function(){$("#error").hide()};var Animator=function(a){this.renderer=a;this.animationRequests=[];this.timeoutId=this.nextCallTimestamp=void 0};
Animator.prototype={requestFrame:function(a,b){void 0==b&&(b=0);a||(a=function(){});var c=Date.now()+b;if(c<this.nextCallTimestamp||void 0==this.nextCallTimestamp)clearTimeout(this.timeoutId),0<b?this.timeoutId=setTimeout(this.animationLoopCalled.bind(this),b):requestAnimationFrame(this.animationLoopCalled.bind(this)),this.nextCallTimestamp=c;this.animationRequests.push({callback:a,begin:c})},animationLoopCalled:function(){window.meter&&window.meter.tickStart();this.nextCallTimestamp=void 0;var a=
this.animationRequests;this.animationRequests=[];for(var b=[],c=0;c<a.length;c++){var d=a[c],e=d.begin-Date.now();0<e?b.push(d):"function"===typeof d.callback&&d.callback()}for(c=0;c<b.length;c++)d=b[c],e=d.begin-Date.now(),this.requestFrame(d.callback,e);this.renderer.render();window.meter&&window.meter.tick()}};
Layer=function(a){Drawable.call(this,a);this.rect.width||(this.rect.width=config.scWidth);this.rect.height||(this.rect.height=config.scHeight);this.canvas=document.createElement("canvas");this.canvas.width=this.rect.width;this.canvas.height=this.rect.height;this.ctx=this.canvas.getContext("2d");this.stackedClearRect=new Rect;this.requestedFrame=!1;this.visible=!0;this.opacity=1;this.rotation=0;this.scale=1;this.transformOrigin={x:0,y:0};this.cachedTransform={};this.transTag};Layer.prototype=new Drawable;
Layer.prototype.initializer="Layer";Layer.prototype.objectToBeSerialized=function(a){switch(a){case "canvas":case "ctx":case "cachedTransform":case "transTag":return}return this[a]};Layer.prototype.importFromSaveData=function(a){var b=this;return Drawable.prototype.importFromSaveData.call(this,a).done(function(){b.setRect()})};
Layer.prototype.importFrom=function(a){this.rect=clone(a.rect);this.visible=a.visible;this.opacity=a.opacity;this.canvas.width=a.canvas.width;this.canvas.height=a.canvas.height;this.redrawRect();this.transTag;this.rotation=a.rotation;this.scale=a.scale;this.transformOrigin=clone(a.transformOrigin);this.cachedTransform={}};Layer.prototype.setRect=function(a){a&&(this.rect=a);this.canvas.width=this.rect.width;this.canvas.height=this.rect.height};
Layer.prototype.transformMatrix=function(){if(this.cachedTransform.x==this.rect.x&&this.cachedTransform.y==this.rect.y&&this.cachedTransform.rotation==this.rotation&&this.cachedTransform.scale==this.scale&&this.cachedTransform.originX==this.transformOrigin.x&&this.cachedTransform.originY==this.transformOrigin.y&&void 0!=this.cachedTransform.matrix)return this.cachedTransform.matrix;var a=[[1,0,0],[0,1,0],[0,0,1]],a=multiplyMatrix(a,[[1,0,this.rect.x+this.transformOrigin.x],[0,1,this.rect.y+this.transformOrigin.y],
[0,0,1]]);0!=this.rotation&&(a=multiplyMatrix(a,[[Math.cos(this.rotation),Math.sin(this.rotation),0],[-Math.sin(this.rotation),Math.cos(this.rotation),0],[0,0,1]]));1!=this.scale&&(a=multiplyMatrix(a,[[this.scale,0,0],[0,this.scale,0],[0,0,1]]));this.cachedTransform.x=this.rect.x;this.cachedTransform.y=this.rect.y;this.cachedTransform.rotation=this.rotation;this.cachedTransform.scale=this.scale;this.cachedTransform.originX=this.transformOrigin.x;this.cachedTransform.originY=this.transformOrigin.y;
this.cachedTransform.matrix=a;this.cachedTransform.inverted=void 0;return a};
Layer.prototype.localLocation=function(a,b){var c=this.cachedTransform.inverted;if(!c){var c=this.transformMatrix(),d=[[c[0][0],c[0][1]],[c[1][0],c[1][1]]],e=d[0][0]*d[1][1]-d[0][1]*d[1][0],d=[[d[1][1]/e,d[0][1]/-e],[d[1][0]/-e,d[0][0]/e]],c=multiplyMatrix(d,[[c[0][2]],[c[1][2]]]),c=[[-c[0][0]],[-c[1][0]]],c=[[d[0][0],d[0][1],c[0][0]],[d[1][0],d[1][1],c[1][0]],[0,0,1]];this.cachedTransform.inverted=c}c=multiplyMatrix(c,[[a],[b],[1]]);return{x:c[0][0]+this.transformOrigin.x,y:c[1][0]+this.transformOrigin.y}};
Layer.prototype.transit=function(a){this.transTag=a;"function"==typeof a.method.prepare&&a.method.prepare.call(a,a.transArgs)};Layer.prototype.isTransiting=function(){return void 0!=this.transTag};Layer.prototype.stopTransition=function(){this.transTag&&(typeof this.transTag.method.teardown&&this.transTag.method.teardown(),this.importFrom(this.transTag.transArgs.layer.back),this.transTag=void 0)};
Layer.prototype.drawOnContext=function(a){if(this.visible){a.save();var b=this.transformMatrix();a.setTransform(b[0][0],b[1][0],b[0][1],b[1][1],b[0][2],b[1][2]);a.globalAlpha=this.opacity;a.drawImage(this.canvas,-this.transformOrigin.x,-this.transformOrigin.y,this.rect.width,this.rect.height);a.restore()}};Layer.prototype.children=function(){return[]};Layer.prototype.mousemove=function(){};Layer.prototype.mouseup=function(){};
Layer.prototype.draw=function(a){a.needRedraw=!0;this.requestedFrame||(renderer.animator.requestFrame(),this.requestedFrame=!0)};Layer.prototype.redrawRect=function(a){a||(a=new Rect(0,0,this.rect.width,this.rect.height));this.stackedClearRect.extend(a);this.requestedFrame||(renderer.animator.requestFrame(),this.requestedFrame=!0)};
Layer.prototype.flush=function(){if(this.requestedFrame){for(var a=!0,b=this.children();a;)for(var a=!1,c=b.length-1;0<=c;c--){var d=b[c];!d.needRedraw&&d.frame().intersect(this.stackedClearRect)&&(d.canDrawPartial()?d.partialDraw=!0:this.stackedClearRect.extend(d.frame()),a=d.needRedraw=!0)}this.stackedClearRect.round();this.ctx.clearRect(this.stackedClearRect.x,this.stackedClearRect.y,this.stackedClearRect.width,this.stackedClearRect.height);a=this.stackedClearRect.isZero();for(c=0;c<b.length;c++)d=
b[c],d.needRedraw&&(!a&&d.partialDraw?d.drawOnContext(this.ctx,this.stackedClearRect):d.drawOnContext(this.ctx),d.needRedraw=!1,d.partialDraw=!1);this.stackedClearRect=new Rect;this.requestedFrame=!1}};AnimationLayer=function(){Layer.call(this);this.animationSeg=[]};AnimationLayer.prototype=Object.create(Layer.prototype);AnimationLayer.prototype.initializer="AnimationLayer";
AnimationLayer.prototype.importFrom=function(a){this.animationSeg=clone(a.animationSeg);Layer.prototype.importFrom.apply(this,arguments)};AnimationLayer.prototype.drawImage=function(){};var ImageLayer=function(){AnimationLayer.call(this);this.images=[]};ImageLayer.prototype=Object.create(AnimationLayer.prototype);ImageLayer.prototype.initializer="ImageLayer";ImageLayer.prototype.children=function(){return this.images};
ImageLayer.prototype.importFrom=function(a){this.images=clone(a.images);AnimationLayer.prototype.importFrom.apply(this,arguments)};
ImageLayer.prototype.importFromSaveData=function(a){this.images=[];for(var b=this,c=[],d=0;d<a.images.length;d++)c.push($.when(a.images[d].restore()).done(function(a){b.images.push(a)}));delete a.images;c.push(AnimationLayer.prototype.importFromSaveData.call(this,a));return $.when.apply($,c).done(function(){console.log("\u30a4\u30e1\u30fc\u30b8\u3092\u5168\u90e8\u30ed\u30fc\u30c9\u3057\u307e\u3057\u305f\u3001\u518d\u63cf\u753b\u3057\u307e\u3059");b.redrawRect()})};
ImageLayer.prototype.loadImage=function(a,b,c){var d=this;return ResourceLoader.loadImage(a,!c).done(function(c){d.images.length?d.redrawRect(d.images[0].rect):d.redrawRect();c=new DrawableImage(c,0,0);c.originalURL=a;d.images=[c];c.options=b;d.draw(c)})};ImageLayer.prototype.clearImage=function(){for(var a=0;a<this.images.length;a++)this.redrawRect(this.images[a].rect);this.images=[]};
BaseLayer=function(){ImageLayer.call(this);this.backgroundSolid=new DrawableSolidColor;this.backgroundSolid.rect=new Rect(0,0,this.rect.width,this.rect.height);this.backgroundSolid.color=config.backgroundColor};BaseLayer.prototype=Object.create(ImageLayer.prototype);BaseLayer.prototype.initializer="BaseLayer";BaseLayer.prototype.children=function(){return[this.backgroundSolid].concat(this.images)};
TextProperties=function(a){Drawable.call(this);this.text=a;this.rubyText;this.styles={opacity:1,size:20,face:"Arial",visible:!1,shadowBlur:2,vertical:!1,shadowOffsetX:0,shadowOffsetY:0};this.useCanvasCache=!1;this.canvas};TextProperties.prototype=new Drawable;TextProperties.prototype.initializer="TextProperties";TextProperties.prototype.importFrom=function(a){Drawable.prototype.importFrom.call(this,a);this.text=a.text;this.rubyText=a.rubyText;this.styles=clone(a.styles);this.useCanvasCache=a.useCanvasCache};
TextProperties.prototype.objectToBeSerialized=function(a){switch(a){case "canvas":return}return this[a]};
TextProperties.prototype.drawOnContext=function(a){if(this.styles.visible&&0!=this.styles.opacity){if(this.useCanvasCache){var b=this.frame();if(!this.canvas){this.canvas=document.createElement("canvas");this.canvas.width=b.width;this.canvas.height=b.height;var c=this.canvas.getContext("2d");c.textBaseline="top";var d=this.rect.x-b.x,e=this.rect.y-b.y;this.useCanvasCache=!1;var h=this.rect,j=this.styles.opacity;this.styles.opacity=1;this.rect=new Rect(d,e,this.rect.width,this.rect.height);this.drawOnContext(c);
this.rect=h;this.styles.opacity=j;this.useCanvasCache=!0}a.save();a.globalAlpha=this.styles.opacity;a.drawImage(this.canvas,b.x,b.y,this.canvas.width,this.canvas.height)}else a.save(),b=this.styles.color,a.fillStyle!=b&&(a.fillStyle=b),this.styles.shadow?(a.shadowColor=this.styles.shadowColor,a.shadowBlur=this.styles.shadowBlur,a.shadowOffsetX=this.styles.shadowOffsetX,a.shadowOffsetY=this.styles.shadowOffsetY):a.shadowBlur=0,a.globalAlpha!=this.styles.opacity&&(a.globalAlpha=this.styles.opacity),
this.styles.vertical?this.fillTextVertical(a):(this.rubyText&&(b=this.rubyFont(),a.font!=b&&(a.font=b),b=this.measureRuby(a),a.fillText(this.rubyText,this.rect.x+(this.rect.width-b.width)/2,this.rect.y-b.height-this.styles.rubyOffset)),b=this.font(),a.font!=b&&(a.font=b),a.fillText(this.text,this.rect.x,this.rect.y),this.styles.edge&&(a.lineWidth=2,a.strokeStyle=this.styles.edgeColor,a.strokeText(this.text,this.rect.x,this.rect.y)));a.restore()}};
TextProperties.prototype.clearCache=function(){this.canvas&&($(this.canvas).remove(),this.canvas=void 0)};
TextProperties.prototype.frame=function(){var a=0;this.styles.edge&&(a+=10);a=new Rect({x:this.rect.x-a,y:this.rect.y-a,width:this.rect.width+2*a,height:this.rect.height+2*a});if(this.styles.shadow){var b=new Rect({x:a.x-this.styles.shadowBlur,y:a.y-this.styles.shadowBlur,width:a.width+2*this.styles.shadowBlur,height:a.height+2*this.styles.shadowBlur});b.x+=this.styles.shadowOffsetX;b.y+=this.styles.shadowOffsetY;a.extend(b)}if(browser.isIOs||browser.isAndroid)a.height+=5;this.rubyText&&(b=this.measureRuby(),
b=this.styles.vertical?new Rect({x:this.rect.x+this.rect.width+this.styles.rubyOffset,y:this.rect.y-(this.rect.height-b.height)/2-10,width:b.width,height:b.height+10}):new Rect({x:this.rect.x+(this.rect.width-b.width)/2,y:this.rect.y-this.styles.rubySize+this.styles.rubyOffset-10,width:b.width,height:b.height+10}),a.extend(b));this.styles.italic&&(a.width+=10);return a};
TextProperties.prototype.font=function(){var a="";this.styles.italic&&(a+="italic ");this.styles.bold&&(a+="bold ");a+=this.styles.size+"px ";a+=this.styles.face;return a+" , Arial"};TextProperties.prototype.rubyFont=function(){return this.styles.rubySize+"px "+this.styles.face};
TextProperties.prototype.measure=function(a){a.save();var b=this.font();this.font!=b&&(a.font=b);this.styles.vertical?b=this.measureVertical(a,this.text):(b=a.measureText(this.text),b.height=this.styles.size);a.restore();return b};
TextProperties.prototype.measureRuby=function(a){a||(a=o2.currentMessageLayer.ctx);a.save();var b=this.rubyFont();this.font!=b&&(a.font=b);this.styles.vertical?b=this.measureVertical(a,this.rubyText,this.styles.rubySize):(b=a.measureText(this.rubyText),b.height=this.styles.rubySize);a.restore();return b};
(function(){function a(a,b,c,d,e){var h=c*Math.PI/180,c=Math.cos(h),h=Math.sin(h);return[[a*c,b*h],[-a*h,b*c],[a*(c*d-h*e),b*(h*d+c*e)]]}function b(b,m,i,l,n){var q=b.measureText(m),n=n||this.styles.size,s=this.styles.size;m in c&&(m=c[m]);var I="";-1!=d.indexOf(m)?I="offsetTopRight":-1!=e.indexOf(m)?I="offsetRight":-1!=h.indexOf(m)?(i+=s,l-=n,I="rotate90"):-1!=j.indexOf(m)&&(i+=s,l-=n,I="reflect45");b.save();a:{var s=i,v=l,L=q.width,G=n;switch(I){case "rotate90":s=a(1,1,90,-s+v+G,-s-v);break a;case "reflect45":s=
a(1,-1,270,-s+v+L,s-v-G);break a;case "offsetTopRight":s=a(1,1,0,0.625*L,-0.625*G);break a;case "offsetRight":s=a(1,1,0,0.125*L,-0.125*G);break a;default:s=[[1,0],[0,1],[0,0]]}}b.setTransform(s[0][0],s[0][1],s[1][0],s[1][1],s[2][0],s[2][1]);b.fillText(m,i,l);this.styles.edge&&(b.lineWidth=2,b.strokeStyle=this.styles.edgeColor,b.strokeText(this.text,i,l));b.restore();return"rotate90"==I?q.width:n}var c={"\u300a":"\ufe3d","\u300b":"\ufe3e","(":"\ufe35","\uff08":"\ufe35",")":"\ufe36","\uff09":"\ufe36",
"{":"\ufe37","\uff5b":"\ufe37","}":"\ufe38","\uff5d":"\ufe38","\u3010":"\ufe3b","\u3011":"\ufe3c","\uff1c":"\ufe3f","<":"\ufe3f","\uff1e":"\ufe40",">":"\ufe40","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44"},d=["\u3001","\u3002"],e="\u3041\u3043\u3045\u3047\u3049\u3063\u3083\u3085\u3087\u308e\u30f5\u30f6",h="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ~ ".split(""),j=["\u30fc","\u2015"];TextProperties.prototype.measureVertical=function(a,b,c){for(var b=b.split(""),
d=0,e=0,j=0;j<b.length;j++){var s=b[j],I=a.measureText(s).width,v=c||this.styles.size;-1!=h.indexOf(s)&&(s=v,v=I,I=s);e+=v;d<I&&(d=I)}return{width:d,height:e}};TextProperties.prototype.fillTextVertical=function(a){var c=this.text.split(""),d=this.rect.y,e=this.font();a.font!=e&&(a.font=e);a.save();for(e=0;e<c.length;e++)var h=c[e],d=d+b.call(this,a,h,this.rect.x,d);a.restore();if(this.rubyText){e=this.rubyFont();a.font!=e&&(a.font=e);d=this.measureRuby(a);d=(this.rect.height-d.height)/2;c=this.rubyText.split("");
d=this.rect.y+d;for(e=0;e<c.length;e++)h=c[e],d+=b.call(this,a,h,this.rect.x+this.rect.width+this.styles.rubyOffset,d,this.styles.rubySize)}}})();TextProperties.prototype.calculateSize=function(){var a=this.measure();this.rect.width=a.width;this.rect.height=a.height;return a};TextProperties.prototype.isEqual=function(a){if(!(a instanceof TextProperties)||!this.frame().isEqual(a.frame()))return!1;for(var b in this.styles)if(this.styles[b]!=a.styles[b])return!1;return!0};
function BaseTextCustomizer(a,b,c){for(var d=b.delaySpeed,e=[],h=b.textCursor.x,j=b.textCursor.y,k=0,m=0,i=void 0,l=a.length-1;0<=l;l--){var n=a[l];$.extend(n.styles,clone(b.font));n.styles.vertical=b.vertical}for(l=0;l<a.length;l++)if(n=a[l],n.rect.isZero()){if(b.style.autoReturn&&void 0==i){var q=i=function(){for(var c=b.vertical?j:h,d=l;d<a.length;d++){var e=a[d].measure(b.ctx);if(b.vertical){if(c+=e.height,c>b.rect.height-b.margin.bottom)return d}else if(c+=e.width,c>b.rect.width-b.margin.right)return d}return-1}();
if(-1!=i){var s=a[i],I=a[i+1];if(b.style.kinsoku==MessageLayer.KINSOKU_BURASAGARI&&-1!=b.style.kinsokuBurasagariChar.indexOf(s.text)&&(!I||-1==b.style.kinsokuBolChar.indexOf(I.text)))I?i++:i=-1;else if(b.style.kinsoku!=MessageLayer.KINSOKU_NONE)for(;-1!=b.style.kinsokuBolChar.indexOf(a[i].text)||-1!=b.style.kinsokuEolChar.indexOf(a[i-1].text);)if(i--,i<=l){i=q;break}}}q=n.measure(b.ctx);q.width>k&&(k=q.width);i===l&&(i=void 0,b.vertical?(j=b.margin.top,h-=k+b.style.lineSpacing):(h=b.margin.left,-1!=
b.style.lineSize&&(m=b.style.lineSize),j+=m+b.style.lineSpacing,m=0),k=0);e[l]={x:h,y:j,width:q.width,height:q.height};n.rect=new Rect(e[l]);b.vertical?j+=q.height:(h+=q.width+b.style.pitch,k+=q.width+b.style.pitch,m<q.height&&(m=q.height))}this.isAnimation=!1;var v=this;this.textProperties=function(b){var h=a[b];if(!h)debugger;$.extend(h.rect,new Rect(e[b]));h.styles.visible=v.timePassed/d+(a.length-c)>=b?!0:!1;return h};this.isEnded=function(){return v.timePassed/d>=c?!0:!1}}
function AlignTextCustomizer(a,b){if(b.vertical){if("center"!=b.style.align&&"bottom"!=b.style.align)return}else if("left"==b.style.align)return;var c=b.style.align;this.allTextsProperties=function(){if(b.vertical)for(var d=-1,e=0;e<a.length;e++){if(j=a[e],k=0,-1==d&&(d=j.rect.x,k=e),e>=a.length-1||d!=a[e+1].rect.x){d=0;for(j=k;j<=e;j++)a[j].styles.visible&&(d+=a[j].rect.height);var h=0,j=b.rect.height-b.margin.top-b.margin.bottom;"center"==c?h=(j-d)/2:"bottom"==c&&(h=j-d);for(j=k;j<=e;j++)a[j].styles.visible&&
(a[j].rect.y=h,h+=a[j].rect.height);d=-1}}else for(var d=-1,k=0,e=0;e<a.length;e++){var j=a[e];-1==d&&(d=j.rect.y,k=e);if(e>=a.length-1||d!=a[e+1].rect.y){d=0;for(j=k;j<=e;j++)a[j].styles.visible&&(d+=a[j].rect.width+b.style.pitch);h=0;j=b.rect.width-b.margin.left-b.margin.right;"center"==c?h=(j-d)/2+b.margin.left:"right"==c&&(h=j-d+b.margin.left);for(j=k;j<=e;j++)a[j].styles.visible&&(a[j].rect.x=h,h+=a[j].rect.width+b.style.pitch);d=-1}}return a}}
Button=function(a,b,c){DrawableImage.call(this,a,b,c);this.cacheEnabled=!1;this.hovering};Button.prototype=Object.create(DrawableImage.prototype);Button.prototype.initializer="Button";Button.prototype.click=Button.prototype.enter=Button.prototype.leave=function(){};Button.prototype.clone=function(a){var b=new Button(this.image);b.importFrom(a);return b};Button.restore=function(a){return $.when(ResourceLoader.loadImage(a.image,!0)).then(function(){var b=new Button(image);b.importFrom(a);return b})};
Link=function(){DrawableSolidColor.call(this);this.color=config.defaultLinkColor||"#0000ff";this.opacity=0.5;this.hovering;this.textsProperties=[];this.rects=[];this.vertical=!1};Link.prototype=Object.create(DrawableSolidColor.prototype);Link.prototype.initializer="Link";Link.restore=function(){return(new Link).importFromSaveData()};Link.prototype.isHovering=function(a,b){for(var c=0;c<this.rects.length;c++)if(this.rects[c].coverCoordinate(a,b))return!0;return!1};
Link.prototype.drawOnContext=function(a){if(this.hovering){for(var b=this.rect,c=0;c<this.rects.length;c++)this.rect=this.rects[c],DrawableSolidColor.prototype.drawOnContext.call(this,a);this.rect=b}};Link.prototype.addTextProperties=function(a){this.textsProperties.push(a);this.refreshRects()};
Link.prototype.refreshRects=function(){this.rects=[];this.rect=new Rect;for(var a,b=0;b<this.textsProperties.length;b++){var c=this.textsProperties[b].frame();a||(a=new Rect);a.extend(c);if(b==this.textsProperties.length-1||this.textsProperties[b+1].frame().y!=c.y&&!this.vertical||this.textsProperties[b+1].frame().x!=c.x&&this.vertical)this.rects.push(a),this.rect.extend(a),a=void 0}};Link.prototype.click=Link.prototype.enter=Link.prototype.leave=function(){};
MessageLayer=function(){Layer.call(this,new Rect({x:config.messageLayerCurrentPositionX,y:config.messageLayerCurrentPositionY,width:config.messageLayerCurrentWidth,height:config.messageLayerCurrentHeight}));this.frameImage;this.frameSolid=new DrawableSolidColor(new Rect(0,0,this.rect.width,this.rect.height));this.frameSolid.color=config.messageLayerColor||"#000";this.frameSolid.opacity=config.messageLayerOpacity;this.visible=!1;this.opacity=1;this.margin={top:config.messageLayerMarginT||20,right:config.messageLayerMarginR||
20,bottom:config.messageLayerMarginB||20,left:config.messageLayerMarginL||20};this.textsProperties=[];this.vertical=!1;this.textCursor={x:0,y:0};this.resetCursor();this.align="left";this.delaySpeed=config.chSpeeds||20;this.ctx.textBaseline="top";this.defaultFont={size:config.messageLayerDefaultFontSize||20,face:config.messageLayerDefaultFontFace||"Arial",color:config.messageLayerDefaultFontColor||"#000000",rubySize:10,rubyOffset:0,shadow:!0,edge:!1,edgeColor:"#00ff00",shadowColor:"#999999",bold:config.messageLayerDefaultFontBold,
italic:config.messageLayerDefaultFontItalic};this.defaultStyle={lineSpacing:Number(config.messageLayerDefaultStyleLineSpacing)||0,pitch:Number(config.messageLayerDefaultStylePitch)||0,lineSize:Number(config.messageLayerDefaultFontSize)||-1,align:"left",autoReturn:!0,kinsoku:MessageLayer.KINSOKU_BURASAGARI,kinsokuBolChar:" \u3002\uff0e\u3001\uff0c\u300d\u300f\uff09\u3009\u3011\u300b\uff3d\u3015\u201d\uff5d\u2019\u301f",kinsokuEolChar:"\u300c\u300e\uff08\u3008\u3010\u300a\uff3b\u3014\u201c\uff5b\u2018\u301d",
kinsokuBurasagariChar:"\u3002\uff0e\u3001\uff0c"};this.font=clone(this.defaultFont);this.style=clone(this.defaultStyle);this.textCustomizers=[BaseTextCustomizer,AlignTextCustomizer];this.buttons=[];this.links=[];this.images=[]};MessageLayer.prototype=Object.create(Layer.prototype);MessageLayer.prototype.initializer="MessageLayer";
MessageLayer.prototype.objectToBeSerialized=function(a){switch(a){case "textsProperties":return;case "textCustomizers":return this.textCustomizers.map(function(a){return a.name})}return Layer.prototype.objectToBeSerialized.call(this,a)};
MessageLayer.prototype.importFromSaveData=function(a){var b=this;this.buttons=[];for(var c=[],d=0;d<a.buttons.length;d++)c.push($.when(a.buttons[d].restore()).done(function(a){b.buttons.push(a)}));delete a.buttons;this.images=[];for(d=0;d<a.images.length;d++)c.push($.when(a.images[d].restore()).done(function(a){b.images.push(a)}));delete a.images;this.links=[];for(d=0;d<a.links.length;d++)c.push($.when(a.links[d].restore()).done(function(a){b.links.push(a)}));delete a.links;this.textCustomizers=[];
for(d=0;d<a.textCustomizers.length;d++)this.textCustomizers.push(window[a.textCustomizers[d]]);delete a.textCustomizers;this.textsProperties=[];c.push(Layer.prototype.importFromSaveData.call(this,a));return $.when.apply($,c).done(function(){b.setRect(b.rect);b.redrawRect()})};MessageLayer.KINSOKU_NONE=0;MessageLayer.KINSOKU_OIDASHI=1;MessageLayer.KINSOKU_BURASAGARI=2;
MessageLayer.prototype.children=function(){var a=[];this.frameImage?a.push(this.frameImage):a.push(this.frameSolid);return a=a.concat(this.textsProperties,this.links,this.images,this.buttons)};
MessageLayer.prototype.importFrom=function(a){if(!(a instanceof MessageLayer))throw"otherLayer\u306fMessageLayer\u3067\u306f\u306a\u3044\u3067\u3059";this.visible=a.visible;this.opacity=a.opacity;a.frameImage&&(this.frameImage=clone(a.frameImage));for(var b="frameSolid margin textsProperties vertical lineWidth textCursor align delaySpeed defaultFont defaultStyle font style textCustomizers buttons links images".split(" "),c=0;c<b.length;c++){var d=b[c];this[d]=clone(a[d])}this.setRect(clone(a.rect),
!0)};MessageLayer.prototype.mousemove=function(a){if(!this.visible)return!1;a=a.originalEvent.normalizedCoordinate(this);this.refreshButtons(a.x,a.y);this.refreshLinks(a.x,a.y)};
MessageLayer.prototype.mouseup=function(a){if(!this.visible)return!1;for(var a=a.originalEvent.normalizedCoordinate(this),b=this.buttons.length-1;0<=b;b--){var c=this.buttons[b];if(c.rect.coverCoordinate(a.x,a.y))return c.click(),this.addButtonLinkImages(),this.buttons=[],this.links=[],!0}for(b=this.links.length-1;0<=b;b--)if(c=this.links[b],c.isHovering(a.x,a.y))return c.click(),this.addButtonLinkImages(),this.buttons=[],this.links=[],!0};
MessageLayer.prototype.setRect=function(a,b){a||(a=this.rect);var c=this.rect.width!=a.width||this.rect.height!=a.height||this.canvas.width!=a.width||this.canvas.height!=a.height;c&&(this.canvas.width=a.width,this.canvas.height=a.height,this.ctx.textBaseline="top");this.rect=a;this.frameSolid.rect.width=a.width;this.frameSolid.rect.height=a.height;(c||b)&&this.redrawRect()};
MessageLayer.prototype.resetCursor=function(){this.textCursor=this.vertical?{x:this.rect.width-this.margin.right-this.font.size,y:this.margin.top}:{x:this.margin.left,y:this.margin.top}};MessageLayer.prototype.linebreak=function(){this.vertical?(this.textCursor.y=this.margin.top,this.textCursor.x-=this.font.size+this.style.lineSpacing):(this.textCursor.x=this.margin.left,this.textCursor.y+=this.font.size+this.style.lineSpacing)};
MessageLayer.prototype.drawText=function(a,b){function c(){for(var a=!0,e=Date.now()-m,n=0;n<j.length;n++){var q=j[n];q.timePassed=e;if(o2.skipMode||0==this.delaySpeed)q.timePassed=Infinity;if("function"===typeof q.allTextsProperties)this.textsProperties=q.allTextsProperties(this.textsProperties);else if("function"===typeof q.textProperties)for(var s=d;s<this.textsProperties.length;s++)this.textsProperties[s]=q.textProperties(s);"function"===typeof q.isEnded&&!1==q.isEnded()&&(a=!1)}e=!1;for(n=0;n<
this.textsProperties.length;n++)q=this.textsProperties[n],s=k[n],q.isEqual(s)||(s&&s.styles.visible&&(this.redrawRect(s.frame()),e=!0),this.draw(q));if(e)for(n=0;n<this.links.length;n++)this.links[n].refreshRects();k=clone(this.textsProperties);a?(a=this.textsProperties[this.textsProperties.length-1],this.textCursor=this.vertical?{x:a.rect.x,y:a.rect.y+a.rect.height}:{x:a.rect.x+a.rect.width,y:a.rect.y},"function"==typeof b&&setTimeout(b.bind(this),0)):renderer.animator.requestFrame(c.bind(this),
h?0:this.delaySpeed)}var d=this.textsProperties.length;"string"===typeof a&&(a=a.split(""));var e=a.map(function(a){return a instanceof TextProperties?a:new TextProperties(a)});this.textsProperties=this.textsProperties.concat(e);var h=!1,j=this.textCustomizers.map(function(a){a=new a(this.textsProperties,this,e.length);!h&&a.isAnimation&&(h=!0);return a},this);(h||0<=["center","right","bottom"].indexOf(this.style.align))&&this.textsProperties.forEach(function(a){a.useCanvasCache=!0});var k=clone(this.textsProperties),
m=Date.now();c.call(this)};MessageLayer.prototype.refreshButtons=function(a,b){for(var c=this.buttons.length-1;0<=c;c--){var d=this.buttons[c],e=d.rect.coverCoordinate(a,b);this.drawButton(d,e)}};MessageLayer.prototype.drawButton=function(a,b){b&&!a.hovering?(a.enter(),a.hovering=!0,this.redrawRect(a.rect)):!b&&a.hovering&&(a.leave(),a.hovering=!1,this.redrawRect(a.rect))};MessageLayer.prototype.addButton=function(a){this.buttons.push(a);this.draw(a)};
MessageLayer.prototype.refreshLinks=function(a,b){for(var c=this.links.length-1;0<=c;c--){var d=this.links[c],e=d.isHovering(a,b);this.drawLink(d,e)}};MessageLayer.prototype.drawLink=function(a,b){b&&!a.hovering?(a.enter(),a.hovering=!0,a.visible=!0,this.draw(a)):!b&&a.hovering&&(a.leave(),a.hovering=!1,a.visible=!1,this.redrawRect(a.rect))};MessageLayer.prototype.addLink=function(a){a.vertical=this.vertical;this.links.push(a)};
MessageLayer.prototype.addButtonLinkImages=function(){for(var a=0;a<this.buttons.length;a++){var b=this.buttons[a],c=new DrawableCanvas(b.rect);b.rect.x=b.rect.y=0;b.drawOnContext(c.ctx);this.images.push(c);this.redrawRect(c.rect)}for(a=0;a<this.links.length;a++)if(b=this.links[a],b.visible&&b.hovering)for(var d=0;d<b.rects.length;d++)c=new DrawableSolidColor(b.rects[d]),c.importFrom(b),this.images.push(c),this.redrawRect(c.rect)};
MessageLayer.prototype.resetFrameSize=function(){this.frameSolid.rect.width=this.rect.width;this.frameSolid.rect.height=this.rect.height};MessageLayer.prototype.setFrameImage=function(a){if(null==a)this.frameImage?(this.redrawRect(this.frameImage.rect),this.frameImage=void 0):this.redrawRect();else{if(!(a instanceof Drawable))throw"image\u306fdrawable\u3067\u306f\u306a\u3044\u3067\u3059";this.frameImage?this.redrawRect(this.frameImage.frame()):this.redrawRect(this.rect);this.frameImage=a;this.redrawRect(this.frameImage.rect)}};
MessageLayer.prototype.resetMessageLayer=function(){for(var a=this.buttons.length-1;0<=a;a--)this.redrawRect(this.buttons[a].frame());for(a=this.textsProperties.length-1;0<=a;a--)this.redrawRect(this.textsProperties[a].frame());this.buttons=[];this.images=[];this.links=[];this.textsProperties=[];this.font=clone(this.defaultFont);this.style=clone(this.defaultStyle);this.resetCursor();this.resetFrameSize();this.redrawRect()};
var Sound=function(a){this.filepath;this.isPlaying=!1;this.volume=1;this.loop=!1;this.loadDefer;this.audio=new Audio;this.fadeDefer;this.fadeStatus;"string"==typeof a&&this.setFile(a)};Sound.prototype.objectToBeSerialized=function(a){switch(a){case "audio":case "loadDefer":return}return this[a]};Sound.prototype.importFromSaveData=function(a){this.filepath=void 0;Object.prototype.importFromSaveData.call(this,a);if(this.filepath)return a=this.setFile(this.filepath),this.isPlaying&&this.play(),a};
Sound.prototype.setFile=function(a){this.filepath=a;var b=this;this.loadDefer=ResourceLoader.loadAudio(a,!0,this.audio);this.loadDefer.done(function(a){a.volume=b.volume;$(a).on("ended",function(){$(b).trigger("ended");b.isPlaying=!1;if(b.loop&&(browser.isFirefox||browser.isAndroid))a.currentTime=0,a.play()})});return this.loadDefer};Sound.prototype.play=function(a){a&&this.setFile(a);this.isPlaying=!0;if(this.loadDefer)return this.loadDefer.done(function(a){a.play()}),this.loadDefer;console.log("\u8b66\u544a\uff1a\u97f3\u58f0\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u3066\u3044\u306a\u3044\u307e\u307e\u518d\u751f\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u307e\u3059\u3002")};
Sound.prototype.pause=function(){this.isPlaying=!1;this.loadDefer&&this.loadDefer.done(function(a){a.pause()})};Sound.prototype.stop=function(){this.isPlaying=!1;this.loadDefer&&this.loadDefer.done(function(a){a.pause();a.currentTime=0})};Sound.prototype.setTime=function(a){this.loadDefer.done(function(b){try{b.currentTime=a/1E3}catch(c){$(b).one("loadedmetadata",function(){b.currentTime=a/1E3})}})};
Sound.prototype.setVolume=function(a){this.volume=a;this.loadDefer&&this.loadDefer.done(function(b){b.volume=a})};Sound.prototype.setLoop=function(a){this.loop=a;!browser.isFirefox&&!browser.isAndroid&&this.loadDefer.done(function(b){b.loop=a})};
Sound.prototype.fade=function(a){if(a){this.fadeStatus&&this.stopFade();"fromVolume"in a||(a.fromVolume=this.volume);"toVolume"in a||(a.toVolume=this.volume);if(this.loadDefer){this.fadeStatus=new SoundFade(this,a);var b=this;this.fadeStatus.defer.done(function(){delete b.fadeStatus});this.loadDefer.done(function(){b.fadeStatus.start()});return this.fadeStatus.defer}console.log("\u8b66\u544a\uff1a\u97f3\u58f0\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u3066\u3044\u306a\u3044\u307e\u307e\u30d5\u30a7\u30a4\u30c9\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u307e\u3059\u3002")}else if(this.fadeStatus)return this.fadeStatus.defer};
Sound.prototype.stopFade=function(){this.fadeStatus&&this.fadeStatus.stop()};Sound.prototype.dummyLoad=function(){this.audio.src="x";this.audio.load()};SoundFade=function(a,b){this.sound=a;this.fromVolume=1;this.toVolume=0;this.duration=1E3;b&&$.extend(this,b);this.intervalId;this.defer=$.Deferred()};
SoundFade.prototype.start=function(){function a(){var a=(Date.now()-b)/this.duration;1<a&&(a=1);this.sound.setVolume(this.fromVolume+(this.toVolume-this.fromVolume)*a);1<=a&&this.stop()}var b=Date.now();this.intervalId=setInterval(a.bind(this),1E3/60);a.call(this)};SoundFade.prototype.stop=function(){clearInterval(this.intervalId);this.sound.setVolume(this.toVolume);this.defer.resolve()};SoundFade.prototype.objectToBeSerialized=function(a){switch(a){case "defer":case "sound":return}return this[a]};
var Tag,TagAction;
(function(){Tag=function(a,b){this.file;this.tagName=a;this.args=b||{};this.lineNumber;this.originalLineNumber;this.originalCharNumber};Tag.prototype.run=function(){if(this.tagName in Tag.actions){var a=this.argsForAction();return Tag.actions[this.tagName].action.call(this,a)}this.error("\u30bf\u30b0\u30cf\u30f3\u30c9\u30e9\u30fc\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002")};Tag.prototype.preload=function(){if(this.tagName in Tag.actions&&"function"===typeof Tag.actions[this.tagName].preload){var a=this.validate(this.args);
return Tag.actions[this.tagName].preload.call(this,a)}};Tag.prototype.normalizedArgs=function(a){var a=clone(a),b;for(b in a){var c=a[b],d=Tag.actions[this.tagName];d&&(d=d.rules)&&(b in d||this.warn(b+"\u3068\u3044\u3046\u672a\u77e5\u306e\u5c5e\u6027\u304c\u3042\u308a\u307e\u3059\u3002"));if(a.hasOwnProperty(b)&&"string"===typeof c){switch(c.charAt(0)){case "&":c=c.substring(1);c=eval(c);break;case "%":c=c.substring(1),values=c.split("|"),c=values[0]in window.mp?window.mp[values[0]]:values[1]}a[b]=
c}}return a};Tag.prototype.argsForAction=function(){return this.validate(this.normalizedArgs(this.args))};Tag.prototype.validate=function(a){a=a?clone(a):{};if(!Tag.actions[this.tagName])return a;var b=Tag.actions[this.tagName].rules;if(!b)return a;if("function"==typeof b)return b(a);for(var c in b){var d=a[c],e=b[c];b[c].required&&void 0===d&&this.error(c+" \u304c\u5fc5\u8981\u3067\u3059");void 0===d&&"defaultValue"in e&&(d="function"===typeof e.defaultValue?e.defaultValue():e.defaultValue);if(e.type&&
void 0!==d){if("allowString"in e&&"string"===typeof d)for(var h=!1,j=e.allowString.length-1;0<=j;j--)if(e.allowString[j]===d){h=!0;break}if(!h)if(e.type in Tag.validators)try{d=Tag.validators[e.type](d)}catch(k){console.trace&&console.trace(),this.error(c+"\u306f"+k)}else e.type instanceof RegExp&&(e.type.test(d)||this.error(c+" \u306fRegexp\u306e"+e.type.toString()+"\u306b\u5408\u308f\u306a\u3044\u3067\u3059"))}void 0!==d&&(a[c]=d)}return a};Tag.validators={STRING:function(a){if("string"!=typeof a)throw"string\u3067\u306f\u306a\u3044\u3067\u3059";
return a},BOOLEAN:function(a){if("string"===typeof a){if("true"===a)return!0;if("false"===a)return!1}if("boolean"===typeof a)return a;throw"boolean\u3067\u306f\u306a\u3044\u3067\u3059";},INT:function(a){if(isNaN(parseFloat(a))||!(isFinite(a)&&0===a%1))throw"int\u3067\u306f\u306a\u3044\u3067\u3059";return parseInt(a)},FLOAT:function(a){if(isNaN(parseFloat(a))||!isFinite(a))throw"float\u3067\u306f\u306a\u3044\u3067\u3059";return parseFloat(a)},LAYER:function(a){if("base"==a)return{fore:o2.foreLayers.baseLayer,
back:o2.backLayers.baseLayer};try{return this.MESSAGE_LAYER(a)}catch(b){}try{return this.IMAGE_LAYER(a)}catch(c){}throw"\u898b\u3064\u304b\u3089\u306a\u3044\u3067\u3059";},IMAGE_LAYER:function(a){if("base"==a)return{fore:o2.foreLayers.baseLayer,back:o2.backLayers.baseLayer};a=Number(a);if(isNaN(a))throw"number\u3067\u306f\u306a\u3044\u3067\u3059";if(!(a in o2.foreLayers.imageLayers))throw a+"\u3068\u3044\u3046\u30a4\u30e1\u30fc\u30b8\u30ec\u30a4\u30e4\u306f\u5b58\u5728\u3057\u306a\u3044\u3067\u3059";
return{fore:o2.foreLayers.imageLayers[a],back:o2.backLayers.imageLayers[a]}},MESSAGE_LAYER:function(a){if(a.toString().match(/^message$/i))return o2.currentMessageLayer;if(a.toString().match(/^message(\d+)$/i)){var b=Number(a.toString().match(/^message(\d+)$/i)[1]);if(o2.foreLayers.messageLayers[b])return{fore:o2.foreLayers.messageLayers[b],back:o2.backLayers.messageLayers[b]}}throw a+"\u3068\u3044\u3046\u30e1\u30c3\u30bb\u30fc\u30b8\u30ec\u30a4\u30e4\u306f\u5b58\u5728\u3057\u306a\u3044\u3067\u3059";
},COLOR:function(a){a=/0x([0-9a-fA-F]{6})/.exec(a);if(null==a)throw"Color\u3067\u306f\u306a\u3044\u3067\u3059";return"#"+a[1]}};Tag.actions={};Tag.prototype.done=function(a){a?wait(this,a):trigger(this)};Tag.prototype.error=function(a,b){var c="\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002";b&&(c="\u8b66\u544a\uff1a");this.file&&(c+="\u30d5\u30a1\u30a4\u30eb\uff1a"+this.file.filename+"\u3002");void 0!==this.originalLineNumber?c+="Line\uff1a"+this.originalLineNumber+"\u3002":void 0!==
this.lineNumber&&(c+="Line\uff1a"+this.lineNumber+"\u3002");c+="\u30bf\u30b0\u540d\uff1a"+this.tagName+"\u3002";c+=a;b?console.warn(c):console.error(c)};Tag.prototype.warn=function(a){this.error(a,!0)};Tag.prototype.toJSON=function(){return{file:this.file.filename,line:this.lineNumber,initializer:"Tag"}};Tag.restore=function(a){return KAGFiles(a.file).lines[a.line]};TagAction=function(a){this.action=function(){};for(var b in a)this[b]=a[b]}})();
Tag.actions.s=new TagAction({action:function(){o2.skipMode=o2.SKIP_MODE_NONE;return 2}});
Tag.actions.text=new TagAction({rules:{text:{type:"STRING",required:!0}},action:function(a){function b(){o2.skipMode=o2.SKIP_MODE_CLICK;$(o2).off("click",b)}var c=currentConductor.getNextTag();o2.currentMessageLayer.stackedTextsProperties||(o2.currentMessageLayer.stackedTextsProperties=[]);a.text.split("").forEach(function(a){a=new TextProperties(a);o2.currentMessageLayer.currentRubyText&&(a.rubyText=o2.currentMessageLayer.currentRubyText,delete o2.currentMessageLayer.currentRubyText);o2.currentMessageLayer.stackedTextsProperties.push(a)});
if(c&&-1!=["text","ch","ruby","emb"].indexOf(c.tagName))return 0;o2.currentMessageLayer.drawText(o2.currentMessageLayer.stackedTextsProperties,function(){$(o2).off("click",b);trigger("text")});o2.history.add("text",o2.currentMessageLayer.stackedTextsProperties);delete o2.currentMessageLayer.stackedTextsProperties;if(o2.clickSkipEnabled)$(o2).on("click",b);return 1}});
Tag.actions.ch=new TagAction({rules:{text:{type:"STRING",required:!0}},action:function(a){var b=currentConductor.getNextTag();o2.currentMessageLayer.stackedTextsProperties||(o2.currentMessageLayer.stackedTextsProperties=[]);a=new TextProperties(a.text);o2.currentMessageLayer.currentRubyText&&(a.rubyText=o2.currentMessageLayer.currentRubyText,delete o2.currentMessageLayer.currentRubyText);o2.currentMessageLayer.stackedTextsProperties.push(a);if(b&&-1!=["text","ch","ruby","emb"].indexOf(b.tagName))return 0;
o2.currentMessageLayer.drawText(o2.currentMessageLayer.stackedTextsProperties,function(){trigger("ch")});o2.history.add("text",o2.currentMessageLayer.stackedTextsProperties);delete o2.currentMessageLayer.stackedTextsProperties;return 1}});Tag.actions.emb=new TagAction({rules:{o2_exp:{type:"STRING",required:!0}},action:function(a){a=eval(a.o2_exp);a=new Tag("ch",{text:a});currentConductor.stack.push(a);return 0}});
Tag.actions.ruby=new TagAction({rules:{text:{type:"STRING",required:!0}},action:function(a){o2.currentMessageLayer.currentRubyText=a.text;return 0}});Tag.actions.cm=new TagAction({action:function(){for(var a=o2.foreLayers.messageLayers.concat(o2.backLayers.messageLayers),b=a.length-1;0<=b;b--)a[b].resetMessageLayer();o2.history.add("pagebreak");return 0}});Tag.actions.ct=new TagAction({action:function(){(new Tag("cm")).run();o2.currentMessageLayer=o2.foreLayers.messageLayers[0];return 0}});
Tag.actions.er=new TagAction({action:function(){o2.currentMessageLayer.resetMessageLayer();o2.history.add("pagebreak");return 0}});Tag.actions.current=new TagAction({rules:{layer:{type:"MESSAGE_LAYER",required:!0},page:{type:/fore|back/,defaultValue:"fore"}},action:function(a){o2.currentMessageLayer=a.layer[a.page];return 0}});
Tag.actions.position=new TagAction({rules:{layer:{type:"MESSAGE_LAYER"},page:{type:/fore|back/},left:{type:"INT"},top:{type:"INT"},width:{type:"INT"},height:{type:"INT"},frame:{type:"STRING"},color:{type:"COLOR"},opacity:{type:"FLOAT"},marginl:{type:"INT"},margint:{type:"INT"},marginr:{type:"INT"},marginb:{type:"INT"},vertical:{type:"BOOLEAN"},visible:{type:"BOOLEAN"}},action:function(a){var b;b=a.layer&&a.page?a.layer[a.page]:o2.currentMessageLayer;var c=!1,d=clone(b.rect);"left"in a&&(d.x=a.left);
"top"in a&&(d.y=a.top);"width"in a&&(d.width=a.width);"height"in a&&(d.height=a.height);b.setRect(d);"frame"in a&&(""===a.frame?b.setFrameImage():(ResourceLoader.loadImage(a.frame,!1).done(function(c){c=new DrawableImage(c);c.originalURL=a.frame;b.setFrameImage(c)}).always(function(){setTimeout(function(){renderer.animator.requestFrame();trigger("position")})}),c=!0));"color"in a&&(b.frameSolid.color=a.color);"opacity"in a&&(b.frameSolid.opacity=a.opacity/255);"marginl"in a&&(b.margin.left=a.marginl);
"margint"in a&&(b.margin.top=a.margint);"marginr"in a&&(b.margin.right=a.marginr);"marginb"in a&&(b.margin.bottom=a.marginb);"vertical"in a&&(b.vertical=a.vertical);"visible"in a&&b.visible!=a.visible&&(b.visible=a.visible);b.resetMessageLayer();if(c)return 1;renderer.animator.requestFrame();return 0}});
Tag.actions.delay=new TagAction({rules:{speed:{type:"INT",required:!0,allowString:["user","nowait"]}},action:function(a){a.speed="nowait"===a.speed?0:parseFloat(a.speed);for(var b=o2.foreLayers.messageLayers.concat(o2.backLayers.messageLayers),c=b.length-1;0<=c;c--)b[c].delaySpeed=a.speed}});Tag.actions.wc=new TagAction({rules:{time:{type:"INT",required:!0}},action:function(a){var b=this;setTimeout(function(){b.done()},a.time*o2.currentMessageLayer.delaySpeed);return 1}});
(function(){var a=void 0;Tag.actions.nowait=new TagAction({action:function(){a=o2.currentMessageLayer.delaySpeed;return o2.currentMessageLayer.delaySpeed=0}});Tag.actions.endnowait=new TagAction({action:function(){o2.currentMessageLayer.delaySpeed=a;return 0}})})();
Tag.actions.deffont=new TagAction({rules:{size:{type:"INT"},face:{type:"STRING"},color:{type:"COLOR"},rubysize:{type:"INT"},rubyoffset:{type:"INT"},shadow:{type:"BOOLEAN"},edge:{type:"BOOLEAN"},edgecolor:{type:"COLOR"},bold:{type:"BOOLEAN"},shadow:{type:"BOOLEAN"},shadowcolor:{type:"COLOR"},o2_shadow:{type:"BOOLEAN"},o2_shadowcolor:{type:"COLOR"},o2_shadowblur:{type:"INT"},o2_shadowoffsetx:{type:"INT"},o2_shadowoffsety:{type:"INT"}},action:function(a){var b=o2.currentMessageLayer,c={rubysize:"rubySize",
rubyoffset:"rubyOffset",edgecolor:"edgeColor",shadowcolor:"shadowColor",o2_shadow:"shadow",o2_shadowcolor:"shadowColor",o2_shadowblur:"shadowBlur",o2_shadowoffsetx:"shadowOffsetX",o2_shadowoffsety:"shadowOffsetY"},d;for(d in a)b.defaultFont[c[d]||d]=a[d];return 0}});
Tag.actions.font=new TagAction({rules:{size:{type:"INT",allowString:["default"]},face:{type:"STRING"},color:{type:"COLOR",allowString:["default"]},italic:{type:"BOOLEAN",allowString:["default"]},rubysize:{type:"INT",allowString:["default"]},rubyoffset:{type:"INT",allowString:["default"]},edge:{type:"BOOLEAN",allowString:["default"]},edgecolor:{type:"COLOR",allowString:["default"]},bold:{type:"BOOLEAN",allowString:["default"]},shadow:{type:"BOOLEAN"},shadowcolor:{type:"COLOR"},o2_shadow:{type:"BOOLEAN"},
o2_shadowcolor:{type:"COLOR"},o2_shadowblur:{type:"INT"},o2_shadowoffsetx:{type:"INT"},o2_shadowoffsety:{type:"INT"}},action:function(a){var b={rubysize:"rubySize",rubyoffset:"rubyOffset",edgecolor:"edgeColor",shadowcolor:"shadowColor",o2_shadow:"shadow",o2_shadowcolor:"shadowColor",o2_shadowblur:"shadowBlur",o2_shadowoffsetx:"shadowOffsetX",o2_shadowoffsety:"shadowOffsetY"},c;for(c in a){var d=b[c]||c;"default"===a[c]?a[c]=o2.currentMessageLayer.deffont[d]:o2.currentMessageLayer.font[d]=a[c]}return 0}});
Tag.actions.resetfont=new TagAction({action:function(){o2.currentMessageLayer.font=clone(o2.currentMessageLayer.defaultFont)}});
Tag.actions.defstyle=new TagAction({rules:{linespacing:{type:"INT"},pitch:{type:"INT"},linesize:{type:"INT"},o2_kinsoku:{type:/none|oidashi|burasagari-oidashi/},o2_kinsoku_bol_char:{type:"STRING"},o2_kinsoku_eol_char:{type:"STRING"},o2_kinsoku_burasagari_char:{type:"STRING"}},action:function(a){var b={linespacing:"lineSpacing",linesize:"lineSize",o2_kinsoku:"kinsoku",o2_kinsoku_bol_char:"kinsokuBolChar",o2_kinsoku_eol_char:"kinsokuEolChar",o2_kinsoku_burasagari_char:"kinsokuBurasagariChar"},c=o2.currentMessageLayer,
d;for(d in a)c.defaultStyle[b[d]||d]=a[d];if("o2_kinsoku"in a)switch(a.o2_kinsoku){case "none":c.defaultStyle.kinsoku=MessageLayer.KINSOKU_NONE;break;case "oidashi":c.defaultStyle.kinsoku=MessageLayer.KINSOKU_OIDASHI;break;case "burasagari-oidashi":c.defaultStyle.kinsoku=MessageLayer.KINSOKU_BURASAGARI}return 0}});
Tag.actions.style=new TagAction({rules:{align:{type:/left|center|right|top|center|bottom|default/},linespacing:{type:"INT"},pitch:{type:"INT"},linesize:{type:"INT",allowString:["default"]},autoreturn:{type:"BOOLEAN",allowString:["default"]},o2_kinsoku:{type:/none|oidashi|burasagari-oidashi/},o2_kinsoku_bol_char:{type:"STRING"},o2_kinsoku_eol_char:{type:"STRING"},o2_kinsoku_burasagari_char:{type:"STRING"}},action:function(a){var b=o2.currentMessageLayer;"align"in a&&(b.style.align="default"==a.align?
b.vertical?"top":"left":a.align);"linespacing"in a&&(b.style.lineSpacing=a.linespacing);"pitch"in a&&(b.style.pitch=a.pitch);"linesize"in a&&("default"==a.linesize&&(b.style.lineSize=-1),b.style.lineSize=a.linesize);"autoreturn"in a&&("default"==a.autoreturn&&(a.autoreturn=b.defaultStyle.autoReturn),b.style.autoReturn=a.autoreturn);var c={o2_kinsoku_bol_char:"kinsokuBolChar",o2_kinsoku_eol_char:"kinsokuEolChar",o2_kinsoku_burasagari_char:"kinsokuBurasagariChar"},d;for(d in a)d in c&&(b.style[c[d]]=
a[d]);if("o2_kinsoku"in a)switch(a.o2_kinsoku){case "none":b.style.kinsoku=MessageLayer.KINSOKU_NONE;break;case "oidashi":b.style.kinsoku=MessageLayer.KINSOKU_OIDASHI;break;case "burasagari-oidashi":b.style.kinsoku=MessageLayer.KINSOKU_BURASAGARI}}});Tag.actions.resetstyle=new TagAction({action:function(){o2.currentMessageLayer.style=clone(o2.currentMessageLayer.defaultStyle)}});
Tag.actions.locate=new TagAction({rules:{x:{type:"INT"},y:{type:"INT"}},action:function(a){var b=o2.currentMessageLayer;"x"in a&&(b.textCursor.x=a.x);"y"in a&&(b.textCursor.y=a.y);return 0}});Tag.actions.r=new TagAction({action:function(){o2.currentMessageLayer.linebreak();o2.history.add("linebreak");return 0}});
Tag.actions.p=new TagAction({action:function(){o2.history.add("linebreak");if(o2.skipMode<=o2.SKIP_MODE_PAGE)o2.skipMode=o2.SKIP_MODE_NONE;else return 0;glyph.showPageGlyph();wait("click",function(){glyph.hide()});return 1}});Tag.actions.l=new TagAction({action:function(){if(o2.skipMode<=o2.SKIP_MODE_CLICK)o2.skipMode=o2.SKIP_MODE_NONE;else return 0;glyph.showLineGlyph();wait("click",function(){glyph.hide()});return 1}});
Tag.actions.button=new TagAction({rules:{graphic:{type:"STRING",required:!0},graphickey:{type:"COLOR",allowString:["adapt"]},storage:{type:"STRING"},target:{type:"STRING"},o2_url:{type:"STRING"},o2_urltarget:{type:"STRING",defaultValue:"_blank"},o2_exp:{type:"STRING"},o2_onenter:{type:"STRING"},o2_onleave:{type:"STRING"}},action:function(a){var b=this;ResourceLoader.loadImage(a.graphic).done(function(c){setTimeout(function(){var d=o2.currentMessageLayer.textCursor,d=new KAGButton(c,d.x,d.y);d.importFromKAGArgs(a);
o2.currentMessageLayer.addButton(d);b.done()})});return 1}});KAGButton=function(a,b,c){Button.call(this,a,b,c);this.rect.width/=3;this.options.clipLeft=0;this.options.clipWidth=this.rect.width;this.tagArgs};KAGButton.prototype=Object.create(Button.prototype);KAGButton.prototype.initializer="KAGButton";KAGButton.prototype.clone=function(a){var b=new KAGButton(this.image);b.importFrom(a);return b};
KAGButton.prototype.drawOnContext=function(a,b){this.options.clipLeft=this.hovering?2*this.rect.width:0;Button.prototype.drawOnContext.apply(this,arguments)};KAGButton.prototype.importFromKAGArgs=function(a){this.tagArgs=clone(a);this.click=function(){a.o2_exp&&eval(a.o2_exp);a.o2_url&&window.open(a.o2_url,a.o2_urltarget);if(a.storage&&a.target){var b=new Tag("jump",a);currentConductor.stack.push(b)}};a.o2_onenter&&(this.enter=function(){eval(a.o2_onenter)});a.o2_onleave&&(this.leave=function(){eval(a.o2_onleave)})};
KAGButton.prototype.importFrom=function(a){Button.prototype.importFrom.call(this,a);this.importFromKAGArgs(a.tagArgs)};KAGButton.prototype.toJSON=function(){var a=Button.prototype.toJSON.call(this);a.tagArgs=this.tagArgs;return a};KAGButton.restore=function(a){return $.when(ResourceLoader.loadImage(a.image,!0)).then(function(b){b=new KAGButton(b);b.importFrom(a);return b})};
(function(){KAGLink=function(){Link.call(this);this.tagArgs};KAGLink.prototype=Object.create(Link.prototype);KAGLink.prototype.initializer="KAGLink";KAGLink.restore=function(a){var b=new KAGLink;b.importFromKAGArgs(a.tagArgs);delete a.tagArgs;Link.prototype.importFromSaveData(a);return b};KAGLink.prototype.importFromKAGArgs=function(a){this.tagArgs=a;this.click=function(){"o2_exp"in a&&eval(a.o2_exp);"o2_url"in a&&window.open(a.o2_url,a.o2_urltarget);var b=new Tag("jump",this.tagArgs);conductor.stack.push(b)};
"o2_onenter"in a&&(this.enter=function(){eval(a.o2_onenter)});"o2_onleave"in a&&(this.leave=function(){eval(a.o2_onleave)})};var a=0,b={};Tag.actions.link=new TagAction({rules:{storage:{type:"STRING"},target:{type:"STRING"},exp:{type:"STRING"},color:{type:"COLOR"},o2_url:{type:"STRING"},o2_urltarget:{type:"STRING",defaultValue:"_blank"},o2_onenter:{type:"STRING"},o2_onleave:{type:"STRING"},o2_exp:{type:"STRING"}},action:function(c){a=o2.currentMessageLayer.textsProperties.length;b=c;return 0}});Tag.actions.endlink=
new TagAction({action:function(){var c=new KAGLink;c.importFromKAGArgs(b);c.vertical=o2.currentMessageLayer.vertical;for(var d=a;d<o2.currentMessageLayer.textsProperties.length;d++)c.addTextProperties(o2.currentMessageLayer.textsProperties[d]);o2.currentMessageLayer.addLink(c);return 0}})})();
Tag.actions.image=new TagAction({rules:{storage:{type:"STRING",required:!0},layer:{type:"LAYER",required:!0},page:{type:/fore|back/,defaultValue:"fore"},grayscale:{type:"BOOLEAN"},clipleft:{type:"INT"},cliptop:{type:"INT"},clipwidth:{type:"INT"},clipheight:{type:"INT"},flipud:{type:"BOOLEAN"},fliplr:{type:"BOOLEAN"},visible:{type:"BOOLEAN"},left:{type:"INT"},top:{type:"INT"},pos:{type:/left|left_center|center|right_center|right|l|lc|c|rc|r/},opacity:{type:"INT"},allowfail:{type:"BOOLEAN",defaultValue:!1},
o2_zoom:{type:"FLOAT"},o2_rotate:{type:"FLOAT"},o2_orx:{type:"FLOAT"},o2_ory:{type:"FLOAT"}},preload:function(a){ResourceLoader.loadImage(a.storage,!1)},action:function(a){var b=this,c=a.layer[a.page],d={grayscale:!1,rgamma:1,ggamma:1,bgamma:1,shadow:"#000000",shadowOpacity:200,shadowX:10,shadowY:10,shadowBlur:3,clipLeft:void 0,clipTop:void 0,clipWidth:void 0,clipHeight:void 0,flipUD:!1,flipLR:!1,visible:!0,opacity:255},e={shadowopacity:"shadowOpacity",shadowx:"shadowX",shadowy:"shadowY",shadowblur:"shadowBlur",
clipleft:"clipLeft",cliptop:"clipTop",clipwidth:"clipWidth",clipheight:"clipHeight",flipud:"flipUD",fliplr:"flipLR"},h;for(h in a)-1=="storage layer page allowfail left top pos o2_zoom o2_rotate o2_orx o2_ory".split(" ").indexOf(h)&&(d[e[h]||h]=a[h]);"opacity"in d&&(c.opacity=d.opacity/255,d.opacity=1);"visible"in d&&(c.visible=d.visible,d.visible=!0);"shadowOpacity"in d&&(d.shadowOpacity/=255);c.loadImage(a.storage,d,a.allowfail).fail(function(){console.log("image fail")}).always(function(d){if("pos"in
a){switch(a.pos){case "left":case "l":c.rect.x=config.scPositionX_left-d.width/2;break;case "left_center":case "lc":c.rect.x=config.scPositionX_left_center-d.width/2;break;case "center":case "c":c.rect.x=config.scPositionX_center-d.width/2;break;case "right_center":case "rc":c.rect.x=config.scPositionX_right_center-d.width/2;break;case "right":case "r":c.rect.x=config.scPositionX_right-d.width/2}c.rect.y=config.scHeight-d.height}else"left"in a&&(c.rect.x=a.left),"top"in a&&(c.rect.y=a.top);c.rect.width=
Math.max(config.scWidth,d.width);c.rect.height=Math.max(config.scHeight,d.height);c.setRect();"o2_zoom"in a&&(c.scale=a.o2_zoom/100);"o2_rotate"in a&&(c.rotation=a.o2_rotate/180*Math.PI);c.transformOrigin.x="o2_orx"in a?a.o2_orx:d.width/2;c.transformOrigin.y="o2_ory"in a?a.o2_ory:d.height/2;setTimeout(b.done.bind(b))});return 1}});
Tag.actions.freeimage=new TagAction({rules:{layer:{type:"IMAGE_LAYER",required:!0},page:{type:/fore|back/,defaultValue:"fore"}},action:function(a){a.layer[a.page].clearImage();return 0}});Tag.actions.backlay=new TagAction({rules:{layer:{type:"LAYER"}},action:function(a){if(a.layer)a.layer.back.importFrom(a.layer.fore);else for(var a=o2.allForeLayers(),b=o2.allBackLayers(),c=0;c<a.length;c++)b[c].importFrom(a[c]);return 0}});
Tag.actions.copylay=new TagAction({rules:{srclayer:{type:"LAYER",required:!0},destlayer:{type:"LAYER",required:!0},srcpage:{type:/fore|back/,defaultValue:"fore"},destpage:{type:/fore|back/,defaultValue:"fore"}},action:function(a){var b=a.srclayer[a.srcpage],a=a.destlayer[a.destpage];if(b.initializer!=a.initializer)throw"srclayer\u3068destlayer\u306f\u540c\u3058\u7a2e\u985e\u3067\u306f\u306a\u3044\u3002";a.importFrom(b);return 0}});
Tag.actions.layopt=new TagAction({rules:{layer:{type:"LAYER",required:!0},page:{type:/fore|back/,defaultValue:"fore"},visible:{type:"BOOLEAN"},left:{type:"INT"},top:{type:"INT"},opacity:{type:"INT"},autohide:{type:"BOOLEAN"},o2_zoom:{type:"FLOAT"},o2_rotate:{type:"FLOAT"},o2_orx:{type:"FLOAT"},o2_ory:{type:"FLOAT"}},action:function(a){var b=a.layer[a.page];"visible"in a&&(b.visible=a.visible);"left"in a&&(b.rect.x=a.left);"top"in a&&(b.rect.y=a.top);"opacity"in a&&(b.opacity=a.opacity/255);if("autohide"in
a)if(a.autohide)-1==o2.extraAutoHideLayers.indexOf(b)&&o2.extraAutoHideLayers.push(b);else{var c=o2.extraAutoHideLayers.indexOf(b);-1!=c&&o2.extraAutoHideLayers.splice(c,1)}"o2_zoom"in a&&(b.scale=a.o2_zoom/100);"o2_rotate"in a&&(b.rotation=a.o2_rotate/180*Math.PI);"o2_orx"in a&&(b.transformOrigin.x=a.o2_orx);"o2_ory"in a&&(b.transformOrigin.y=a.o2_ory);renderer.animator.requestFrame();return 0}});
Tag.actions.trans=new TagAction({rules:{time:{type:"INT",required:!0},layer:{type:"LAYER",defaultValue:"base"},children:{type:"BOOLEAN",defaultValue:!0},method:{type:"STRING",defaultValue:"crossfade"}},action:function(a){function b(){if(e){Tag.actions.trans.runningTag&&Tag.actions.trans.stopAllTransitions();Tag.actions.trans.runningTag=this;var b=$("#main-wrapper");this.container=$("<div />");this.container.css({position:"absolute",width:b.width()+"px",height:b.height()+"px"});b.append(this.container);
this.container.append([renderer.foreCanvas,renderer.backCanvas]);this.method.transitAllLayers.call(this,a,renderer.backCanvas,renderer.foreCanvas,this.container);renderer.animator.requestFrame(function(){d.end||c()},a.time)}else{a.layer.fore.transit(this);var j=Date.now(),k=function(){d.end||(Date.now()-j<a.time?renderer.animator.requestFrame(k):c())};k()}}function c(){e?Tag.actions.trans.stopAllTransitions():a.layer.fore.stopTransition();d.done()}this.end=!1;this.transArgs=a;(this.method=Tag.actions.trans.methods[a.method])||
this.error(a.method+"\u3068\u3044\u3046method\u306f\u5b58\u5728\u3057\u306a\u3044\u3067\u3059\u3002");"canRun"in this.method&&!this.method.canRun()&&(this.method=Tag.actions.trans.methods.crossfade);var d=this,e=!1;a.layer.fore==o2.foreLayers.baseLayer&&a.children&&(e=!0);!this.method.transit&&!e&&this.error("\u3053\u306emethod\uff08"+a.method+"\uff09\u306flayer=base, children=true\u3058\u3083\u306a\u3051\u308c\u3070\u4f7f\u3048\u306a\u3044\u3067\u3059\u3002");renderer.renderBackCanvas=!0;"function"===
typeof this.method.preload?this.method.preload.call(this,a).done(function(){renderer.animator.requestFrame(function(){b.call(d);d.done()})}):renderer.animator.requestFrame(function(){renderer.animator.requestFrame(function(){b.call(d);d.done()})});return 1},stopAllTransitions:function(){for(var a=o2.allForeLayers(),b=0;b<a.length;b++)a[b].stopTransition();Tag.actions.trans.runningTag&&(function(){"function"==typeof this.method.teardownAllLayers&&this.method.teardownAllLayers.call(this,this.transArgs,
renderer.backCanvas,renderer.foreCanvas,this.container);renderer.renderBackCanvas=!1;for(var a=0;a<renderer.foreLayers.length;a++)renderer.foreLayers[a].importFrom(renderer.backLayers[a]);$(renderer.backCanvas).detach();this.container.remove();delete this.container;$("#main-wrapper").append(renderer.foreCanvas);this.end=!0}.call(Tag.actions.trans.runningTag),Tag.actions.trans.runningTag=void 0)},methods:{}});
TransMethod=function(a){for(var b in a)this[b]=a[b];a.transitAllLayers||(this.transitAllLayers=function(b,d,e,h){function j(){m.end||(Date.now()-k<b.time&&renderer.animator.requestFrame(j),a.transit.call(m,b,e,d,m.transCanvas))}$(d).hide();$(e).hide();this.transCanvas=document.createElement("canvas");this.transCanvas.width=e.width;this.transCanvas.height=d.height;$(this.transCanvas).css({position:"absolute",x:0,y:0});$(h).append(this.transCanvas);a.prepare.call(this,b);var k=Date.now(),m=this;j()},
this.teardownAllLayers=function(b,d,e){"function"==typeof a.teardown&&a.teardown.call(this);$(d).show();$(e).show();$(this.transCanvas).remove();this.transCanvas=null})};Tag.actions.stoptrans=new TagAction({action:function(){Tag.actions.trans.stopAllTransitions();return 0}});
Tag.actions.wt=new TagAction({rules:{canskip:{type:"BOOLEAN",defaultValue:!0}},action:function(a){var b=o2.allForeLayers(),c=!0;if(Tag.actions.trans.runningTag)c=!1;else for(var d=b.length-1;0<=d;d--)if(b[d].isTransiting()){c=!1;break}if(c)return 0;if(a.canskip&&o2.clickSkipEnabled){if(o2.skipMode)return Tag.actions.trans.stopAllTransitions(),0;wait("click",function(){Tag.actions.trans.stopAllTransitions()})}wait("trans");return 1}});
Tag.actions.trans.methods.crossfade=new TransMethod({prepare:function(){this.beginning=Date.now()},transit:function(a,b,c,d){var e=d.getContext("2d"),a=(Date.now()-this.beginning)/a.time;if(1<=a||this.end)a=1;e.save();e.clearRect(0,0,d.width,d.height);e.globalAlpha=1;e.drawImage(b,0,0);e.globalAlpha=a;e.drawImage(c,0,0);e.restore()},teardown:function(){delete this.beginning},transitAllLayers:function(a,b,c){var d=this,e=Date.now();c.style.zIndex=1;b.style.zIndex=2;if(supportCssProperty("animationName"))c=
"@-webkit-keyframes fade { \n0% { \n opacity: 0; \n} 100% { \n opacity: 1; \n}} \n",c+=c.replace(/-webkit-/g,"-moz-")+c.replace(/-webkit-/g,"-o-")+c.replace(/-webkit-/g,""),c=document.createTextNode(c),this.cssTag=document.createElement("style"),this.cssTag.type="text/css",this.cssTag.appendChild(c),document.getElementsByTagName("head")[0].appendChild(this.cssTag),$(b).css("opacity",0),renderer.animator.requestFrame(function(){$(b).css({"animation-duration":a.time+"ms","animation-timing-function":a.timing_function||
"linear","animation-name":"fade"})});else{var h=function(){var c=(Date.now()-e)/a.time;d.end||renderer.animator.requestFrame(h);b.style.opacity=c};requestFrame.animator.requestFrame(h)}},teardownAllLayers:function(a,b){this.end=!0;document.getElementsByTagName("head")[0].removeChild(this.cssTag);$(b).css({opacity:1,"animation-duration":"","animation-timing-function":"","animation-name":""})}});
$.extend(Tag.actions.trans.rules,{from:{type:/left|top|right|bottom/,defaultValue:"left"},stay:{type:/stayfore|stayback|nostay/,defaultValue:"nostay"},o2_timing_function:{type:"STRING",defaultValue:"linear"}});
Tag.actions.trans.methods.scroll=new TransMethod({prepare:function(a){this.beginning=Date.now();if(-1!=a.o2_timing_function.indexOf("cubic-bezier")){a=a.o2_timing_function.replace("cubic-bezier","");a=a.replace("(","");a=a.replace(")","");a=a.split(",").map(function(a){return parseFloat(a)});if(4!=a.length)throw"args.o2_timing_function\u306ecubic-bezier\u306e\u56db\u3064\u3067\u306f\u3042\u308a\u307e\u305b\u3093";this.timingFunction=new KeySpline(a[0],a[1],a[2],a[3])}else switch(a.o2_timing_function){case "ease":this.timingFunction=
new KeySpline(0.25,0.1,0.25,1);break;case "ease-in":this.timingFunction=new KeySpline(0.42,0,1,1);break;case "ease-out":this.timingFunction=new KeySpline(0,0,0.58,1);break;case "ease-in-out":this.timingFunction=new KeySpline(0.42,0,0.58,1);break;default:this.timingFunction=new KeySpline(0,0,1,1)}},transit:function(a,b,c,d){var e=(Date.now()-this.beginning)/a.time,h=d.getContext("2d"),e=this.timingFunction.get(e);h.clearRect(0,0,d.width,d.height);var j=drawY=0;if("stayback"!=a.stay)switch(a.from){case "top":drawY=
d.height*e;break;case "right":j=-1*b.width*e;break;case "bottom":drawY=-1*b.height*e;break;default:j=d.width*e}h.drawImage(b,j,drawY,b.width,b.height);var b=c.height,k=c.width,m=0,i=0;if("stayfore"==a.stay)switch(j=drawY=0,a.from){case "top":b*=e;break;case "right":k*=e;j=m=(1-e)*c.width;break;case "bottom":b*=e;drawY=i=(1-e)*c.height;break;default:k*=e}else switch(a.from){case "top":drawY=c.height*(e-1);break;case "right":j=d.width*(1-e);break;case "bottom":drawY=(1-e)*d.height;break;default:j=c.width*
(e-1)}h.drawImage(c,m,i,k,b,j,drawY,k,b)},teardown:function(){delete this.beginning;delete this.timingFunction}});
Tag.actions.trans.methods.toss=new TransMethod({canRun:function(){return supportCssProperty(["animationName","animationDuration"])},transitAllLayers:function(a,b){this.cssTag=document.createElement("style");this.cssTag.type="text/css";var c="@-webkit-keyframes toss {0% { -webkit-transform: rotate(-30deg) scale(1.3) translate(-20px,-250px); opacity: 0; } 100% { transform: scale(1) translate(0,0) rotate(0deg); opacity: 1; }};",c=c+(c.replace(/-webkit-/g,"-moz-")+c.replace(/-webkit-/g,"-o-")+c.replace(/-webkit-/g,
"")),c=document.createTextNode(c);this.cssTag.appendChild(c);document.getElementsByTagName("head")[0].appendChild(this.cssTag);$(b).css({"animation-duration":a.time+"ms","animation-timing-function":"ease-in-out","animation-fill-mode":"both","animation-name":"toss"})},teardownAllLayers:function(a,b){document.getElementsByTagName("head")[0].removeChild(this.cssTag);$(b).css({"animation-duration":"","animation-timing-function":"","animation-fill-mode":"","animation-name":""});delete this.cssTag}});
Tag.actions.trans.methods.iris=new TransMethod({canRun:function(){return supportCssProperty(["maskImage","maskSize","animation"])},transitAllLayers:function(a,b){this.cssTag=document.createElement("style");this.cssTag.type="text/css";var c="@-webkit-keyframes iris {0% { -webkit-mask-size: 0; } 100% { -webkit-mask-size: "+(Math.max(config.scWidth,config.scHeight)+1500)+"px; }};",c=document.createTextNode(c);this.cssTag.appendChild(c);document.getElementsByTagName("head")[0].appendChild(this.cssTag);
$(b).css({opacity:1,maskImage:"url(./engine/resources/circle-mask.png)",maskRepeat:"no-repeat",maskPosition:"50% 50%",maskSize:"1500px"})},teardownAllLayers:function(a,b){document.getElementsByTagName("head")[0].removeChild(this.cssTag);$(b).css({"mask-image":"","mask-repeat":"","mask-position":"","mask-size":"","animation-duration":"","animation-timing-function":"","animation-fill-mode":"","animation-name":""});delete this.cssTag}});
Tag.actions.trans.methods.cube=new TransMethod({canRun:function(){return browser.isIE?!1:supportCssProperty(["animationName","perspective"])},transitAllLayers:function(a,b,c,d){this.cssTag=document.createElement("style");this.cssTag.type="text/css";var e="@-webkit-keyframes cube-up {0%{ -webkit-transform:rotateX(0deg) translateZ(0);}100%{-webkit-transform:rotateX(90deg) translateZ("+config.scHeight+"px);}};",e=e+(e.replace(/-webkit-/g,"-moz-")+e.replace(/-webkit-/g,"-o-")+e.replace(/-webkit-/g,"")),
e=document.createTextNode(e);this.cssTag.appendChild(e);document.getElementsByTagName("head")[0].appendChild(this.cssTag);this.rotateDiv=document.createElement("div");$(b).css({"transform-origin":"50% 0 0",transform:"rotateX(-90deg) translateZ("+config.scHeight+"px)"});$(c).css({"transform-origin":"50% 0 0"});$(d).css({width:$(d).width()+"px",height:$(d).height()+"px",perspective:"1000px","transform-style":"preserve-3d","transform-origin":"50% 0"}).append(this.rotateDiv);$(this.rotateDiv).css({width:$(d).width()+
"px",height:$(d).height()+"px","transform-origin":"50% 100%","transform-style":"preserve-3d","animation-duration":a.time+"ms","animation-timing-function":"ease-in-out","animation-fill-mode":"both","animation-name":"cube-up"}).append(b).append(c)},teardownAllLayers:function(a,b,c,d){document.getElementsByTagName("head")[0].removeChild(this.cssTag);delete this.cssTag;$(b).css({"transform-origin":"",transform:""});$(c).css({"transform-origin":""});$(d).append(c).append(b);$(this.rotateDiv).remove();
delete this.rotateDiv}});
Tag.actions.trans.methods.multiflip=new TransMethod({canRun:function(){return supportCssProperty(["animationName","perspective"])},transitAllLayers:function(a,b,c,d){this.cssTag=document.createElement("style");this.cssTag.type="text/css";var e="@-webkit-keyframes flip-out { \n0% { \n-webkit-transform:rotateX(0deg); \n} 100% { \n-webkit-transform:rotateX(90deg) \n}} \n@-webkit-keyframes flip-in { \n0% { -webkit-transform:rotateX(-90deg); m} 100% { \n-webkit-transform:rotateX(0deg); \n} \n} ",e=e+(e.replace(/-webkit-/g,
"-moz-")+e.replace(/-webkit-/g,"-o-")+e.replace(/-webkit-/g,"")),e=document.createTextNode(e);this.cssTag.appendChild(e);document.getElementsByTagName("head")[0].appendChild(this.cssTag);$(c).css({display:"none"});$(b).css({display:"none"});$(d).css("perspective","1000px");var h=Math.round(c.width/10),j=a.time/1.72,k=0.08*j;this.foreCanvases=[];this.backCanvases=[];for(a=0;10>a;a++){var e=document.createElement("canvas"),m=document.createElement("canvas");e.height=m.height=c.height;e.width=m.width=
c.width/10;$([e,m]).css({position:"absolute",left:h*a+"px",top:"0","animation-duration":j/2+"ms","animation-fill-mode":"both"}).appendTo(d);$(e).css({"animation-name":"flip-out","animation-delay":a*k+"ms","animation-timing-function":"ease-in"});$(m).css({"animation-name":"flip-in","animation-delay":a*k+j/2+"ms","animation-timing-function":"ease-out"});this.foreCanvases.push(e);this.backCanvases.push(m)}var i=Date.now(),l=this;this.syncCanvases=function(a){for(var d=0;d<l.foreCanvases.length;d++){var e=
Date.now()-i,m=l.foreCanvases[d],v=l.backCanvases[d];(e<d*k+j/2||!0===a)&&m.getContext("2d").drawImage(c,h*d,0,h,c.height,0,0,h,c.height);(e>=d*k+j/2||!0===a)&&v.getContext("2d").drawImage(b,h*d,0,h,b.height,0,0,h,b.height)}};$([c,b]).on("draw",this.syncCanvases);this.syncCanvases(!0)},teardownAllLayers:function(a,b,c,d){$([c,b]).off("draw",this.syncCanvases);document.getElementsByTagName("head")[0].removeChild(this.cssTag);delete this.cssTag;$(c).css({display:"block"});$(b).css({display:"block"});
$(d).css("perspective","");for(a=0;a<this.foreCanvases;a++)$([this.foreCanvases[a],this.backCanvases[a]]).remove();delete this.foreCanvases;delete this.backCanvases;delete this.syncCanvases}});
Tag.actions.trans.methods.blindup=new TransMethod({prepare:function(){this.beginning=Date.now()},transit:function(a,b,c,d){var e=d.getContext("2d");e.clearRect(0,0,d.width,d.height);d=(Date.now()-this.beginning)/a.time;1<d&&(d=1);a=c.height/10;d=a*(1-d);e.drawImage(c,0,0,c.width,c.height);for(c=0;10>c;c++){var h=a*c;0<d&&e.drawImage(b,0,h,b.width,d,0,h,b.width,d)}},teardown:function(){delete this.beginning}});
Tag.actions.trans.methods.blinddown=new TransMethod({prepare:function(){this.beginning=Date.now()},transit:function(a,b,c,d){var e=d.getContext("2d");e.clearRect(0,0,d.width,d.height);d=(Date.now()-this.beginning)/a.time;1<d&&(d=1);a=c.height/10;d*=a;e.drawImage(b,0,0,b.width,b.height);for(b=0;10>b;b++){var h=a*b;0<d&&e.drawImage(c,0,h,c.width,d,0,h,c.width,d)}},teardown:function(){delete this.beginning}});
Tag.actions.trans.methods.fadethrough=new TransMethod({canRun:function(){return supportCssProperty(["animationName","animationDuration"])},transitAllLayers:function(a,b,c){this.cssTag=document.createElement("style");this.cssTag.type="text/css";var d="@-webkit-keyframes fadethrough {0% { -webkit-transform: scale(1) translate(0,0);opacity: 1;} 100% { -webkit-transform: scale(1.5) translate(0,-40px); opacity: 0; }};",d=d+(d.replace(/-webkit-/g,"-moz-")+d.replace(/-webkit-/g,"-o-")+d.replace(/-webkit-/g,
"")),d=document.createTextNode(d);this.cssTag.appendChild(d);document.getElementsByTagName("head")[0].appendChild(this.cssTag);$(c).css({"animation-duration":a.time+"ms","animation-timing-function":"ease-in-out","animation-fill-mode":"both","animation-name":"fadethrough","z-index":"2"});$(b).css("z-index","1")},teardownAllLayers:function(a,b,c){document.getElementsByTagName("head")[0].removeChild(this.cssTag);$(c).css({"animation-duration":"","animation-timing-function":"","animation-fill-mode":"",
"animation-name":"","z-index":""});$(b).css("z-index","");delete this.cssTag}});
Tag.actions.trans.methods.horizontalflip=new TransMethod({canRun:function(){return supportCssProperty(["animationName","animationDuration","animationFillMode","perspective"])},transitAllLayers:function(a,b,c,d){this.cssTag=document.createElement("style");this.cssTag.type="text/css";var e="@-webkit-keyframes flip-in {0%{-webkit-transform:rotateX(-90deg);}100%{-webkit-transform:rotateX(0deg);}} \n@-webkit-keyframes flip-out {0%{-webkit-transform:rotateX(0deg);}100%{-webkit-transform:rotateX(90deg);}};",e=
e+(e.replace(/-webkit-/g,"-moz-")+e.replace(/-webkit-/g,"-o-")+e.replace(/-webkit-/g,"")),e=document.createTextNode(e);this.cssTag.appendChild(e);document.getElementsByTagName("head")[0].appendChild(this.cssTag);$(d).css("perspective","1000px");$(c).css({"animation-duration":a.time/2+"ms","animation-timing-function":"ease-in","animation-fill-mode":"both","animation-name":"flip-out"});$(b).css({"animation-duration":a.time/2+"ms","animation-delay":a.time/2+"ms","animation-timing-function":"ease-out",
"animation-fill-mode":"both","animation-name":"flip-in"})},teardownAllLayers:function(a,b,c,d){document.getElementsByTagName("head")[0].removeChild(this.cssTag);$(d).css("perspective","");$(c).css({"animation-duration":"","animation-timing-function":"","animation-fill-mode":"","animation-name":""});delete this.cssTag}});$.extend(Tag.actions.trans.rules,{vague:{type:"INT",defaultValue:64},rule:{type:"STRING"},liveview:{type:"BOOLEAN",allowString:["auto"],defaultValue:"auto"}});
Tag.actions.trans.methods.universal=new TransMethod({preload:function(a){if(!("rule"in a))throw"rule\u304c\u5fc5\u8981\u3067\u3059";var b=this;this.liveview=function(){if(!0===a.liveview)return!0;if("auto"==a.liveview){var b;b=a.layer.fore==o2.foreLayers.baseLayer?o2.allLayers():a.layer;for(var d in b)if(b[d].moveTag)return!0}return!1}();return ResourceLoader.loadImage(a.rule).done(function(a){b.maskImage=a})},prepare:function(){this.beginning=Date.now();this.maskCanvas=document.createElement("canvas");
this.maskCanvas.width=this.maskImage.width;this.maskCanvas.height=this.maskImage.height;this.maskContext=this.maskCanvas.getContext("2d");this.maskContext.drawImage(this.maskImage,0,0);this.maskData=this.maskContext.getImageData(0,0,this.maskCanvas.width,this.maskCanvas.height)},transit:function(a,b,c,d){var e=(Date.now()-this.beginning)/a.time;1<e&&(e=1);var h,j=b.getContext("2d");h=c.getContext("2d");b=j.getImageData(0,0,b.width,b.height);c=h.getImageData(0,0,c.width,c.height).data;h=b.data;this.liveview||
(this.beforeBitmap=h,this.afterBitmap=c);var a=a.vague,e=a+(a+255)*-e,b=this.maskData.data,j=d.getContext("2d"),k=j.createImageData(d.width,d.height),m=k.data;if(this.maskCanvas.width==d.width&&this.maskCanvas.height==d.height)for(var d=0,i=m.length;d<i;d+=4){var l=1-(b[d]+e)/a,l=Math.max(0,Math.min(1,l));m[d]=h[d]+(c[d]-h[d])*l;m[d+1]=h[d+1]+(c[d+1]-h[d+1])*l;m[d+2]=h[d+2]+(c[d+2]-h[d+2])*l;m[d+3]=255}else for(var n=d.width,q=this.maskCanvas.width,s=this.maskCanvas.height,d=0,i=m.length;d<i;d+=4)l=
Math.floor(d/4/n),maskX=d/4%q,maskY=l%s,maskIndex=4*(maskX+maskY*q),l=1-(b[maskIndex]+e)/a,l=Math.max(0,Math.min(1,l)),m[d]=h[d]+(c[d]-h[d])*l,m[d+1]=h[d+1]+(c[d+1]-h[d+1])*l,m[d+2]=h[d+2]+(c[d+2]-h[d+2])*l,m[d+3]=255;j.putImageData(k,0,0)},teardown:function(){delete this.beginning;delete this.maskCanvas;delete this.maskContext;delete this.maskData;delete this.maskImage}});$.extend(Tag.actions.trans.rules,{zoom_out_to:{type:"FLOAT"},zoom_in_from:{type:"FLOAT"},zoom_in_draw_count:{type:"INT"}});
Tag.actions.trans.methods.zoom=new TransMethod({prepare:function(a){this.beginning=Date.now();this.tempCanvas=document.createElement("canvas");this.tempCanvas.width=config.scWidth;this.tempCanvas.height=config.scHeight;this.tempContext=this.tempCanvas.getContext("2d");this.zoomOutTo=0.5;this.zoomInFrom=1.5;this.drawCount=10;"zoom_out_to"in a&&(this.zoomOutTo=a.zoom_out_to);"zoom_in_from"in a&&(this.zoomInFrom=a.zoom_in_from);"zoom_in_draw_count"in a&&(this.drawCount=a.zoom_in_draw_count)},transit:function(a,
b,c,d){a=(Date.now()-this.beginning)/a.time;1<a&&(a=1);for(var d=d.getContext("2d"),e=this.drawCount,h=1-(1-this.zoomOutTo)*a,j=0;j<e;j++){var k=j/(e-1),m=1-(1-h)*k,i=b.width*m,m=b.height*m,l=(b.width-i)/2,n=(b.height-m)/2;d.globalAlpha=1-k;d.drawImage(b,0,0,b.width,b.height,l,n,i,m)}this.tempContext.clearRect(0,0,this.tempCanvas.width,this.tempCanvas.height);b=this.zoomInFrom-(this.zoomInFrom-1)*a;for(j=0;j<e;j++)k=j/(e-1),m=1+(b-1)*k,i=c.width*m,m*=c.height,l=(c.width-i)/2,n=(c.height-m)/2,this.tempContext.globalAlpha=
1-k,this.tempContext.drawImage(c,0,0,c.width,c.height,l,n,i,m);d.save();d.globalAlpha=a;d.drawImage(this.tempCanvas,0,0,this.tempCanvas.width,this.tempCanvas.height);d.restore()},teardown:function(){delete this.beginning;delete this.tempCanvas;delete this.zoomOutTo;delete this.zoomInFrom;delete this.drawCount}});
Tag.actions.move=new TagAction({rules:{layer:{type:"LAYER",required:!0},page:{type:/fore|back/,defaultValue:"fore"},spline:{type:"BOOLEAN"},time:{type:"INT",required:!0},delay:{type:"INT"},path:{type:"STRING"},accel:{type:"INT"},o2_path:{type:"STRING"},o2_orx:{type:"FLOAT"},o2_ory:{type:"FLOAT"}},action:function(a){var b=this,c=a.time,d=a.layer[a.page];"o2_orx"in a&&(d.transformOrigin.x=a.o2_orx);"o2_ory"in a&&(d.transformOrigin.y=a.o2_ory);if(!("path"in a)&&!("o2_path"in a))return this.error("path\u304bo2_path\u304c\u5fc5\u8981\u3067\u3059"),
0;var e=function(a,b,c,d,e){this.x=parseFloat(a);this.y=parseFloat(b);this.opacity=parseFloat(c);this.zoom=parseFloat(d);this.rotation=parseFloat(e)},h=[],j=a.path;"o2_path"in a&&(j=a.o2_path);var k=j.match(/\((-?[0-9,\s]+)*\)/g);null==k&&this.error("path\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u9593\u9055\u3063\u3066\u307e\u3059\u3002");h.push(new e(d.rect.x,d.rect.y,d.opacity,d.scale,d.rotation));for(var m=0;m<k.length;m++){var i=k[m],i=i.replace("(","").replace(")",""),i=i.split(","),l=
new e,n=parseFloat(i[0]);l.x=isNaN(n)?h[h.length-1].x:n;n=parseFloat(i[1]);l.y=isNaN(n)?h[h.length-1].y:n;n=parseFloat(i[2]);l.opacity=isNaN(n)?h[h.length-1].opacity:n/255;n=parseFloat(i[3]);if(isNaN(n))l.zoom=h[h.length-1].zoom;else{if(j==a.path)return this.error("path\u5c5e\u6027\u306fzoom\u304c\u3042\u3063\u3066\u306f\u3044\u3051\u306a\u3044\u3002zoom\u3068rotate\u3092\u4f7f\u3044\u305f\u3044\u306a\u3089o2_path\u3092\u4f7f\u3063\u3066\u304f\u3060\u3055\u3044\u3002"),0;l.zoom=n/100}i=parseFloat(i[4]);
l.rotation=isNaN(i)?h[h.length-1].rotation:i/180*Math.PI;h.push(l)}e=function(){d.moveTag&&(d.moveTag.end=!0);d.moveTag=this;var e;e=-1>a.accel?new KeySpline(0.08,0.44,0.42,0.93):1<a.accel?new KeySpline(0.45,0,0.97,0.65):new KeySpline(0,0,1,1);var i=void 0;a.spline&&2<=h.length&&(i=B_Spline_Generator(h.map(function(a){return[a.x,a.y]})));var j=Date.now();renderer.animator.requestFrame(function L(){var a=(Date.now()-j)/c,k=1/(h.length-1);1<=a||b.end?(a=1,b.done(),delete d.moveTag):renderer.animator.requestFrame(L);
var a=e.get(a),l=Math.floor((h.length-1)*a),m=l+1,k=a/k-l;m>=h.length&&(m=h.length-1);l=h[l];m=h[m];a=i?i(100*a):{x:l.x+(m.x-l.x)*k,y:l.y+(m.y-l.y)*k};d.rect.x=a.x;d.rect.y=a.y;d.opacity=l.opacity+(m.opacity-l.opacity)*k;d.scale=l.zoom+(m.zoom-l.zoom)*k;d.rotation=l.rotation+(m.rotation-l.rotation)*k})};a.delay?setTimeout(e.bind(this),a.delay):e.call(this);return 0}});
Tag.actions.stopmove=new TagAction({action:function(){for(var a=o2.allLayers(),b=a.length-1;0<=b;b--)a[b].moveTag&&(a[b].moveTag.end=!0);return 0}});Tag.actions.wm=new TagAction({rules:{canskip:{type:"BOOLEAN",defaultValue:!0}},action:function(a){function b(){for(var a=o2.allLayers(),b=a.length-1;0<=b;b--)a[b].moveTag&&(a[b].moveTag.end=!0)}if(a.canskip&&o2.clickSkipEnabled){if(o2.skipMode)return b(),0;wait("click",b)}wait("move");return 1}});
(function(){var a=!1,b=!1;Tag.actions.quake=new TagAction({rules:{time:{type:"INT",required:!0},hmax:{type:"INT",defaultValue:10},vmax:{type:"INT",defaultValue:10}},action:function(c){var d=Date.now(),e=Math.ceil(c.time/50),h=[];a&&this.error("\u3059\u3067\u306bquake\u3057\u3066\u3044\u307e\u3059\u3002");a=!0;for(var j=0;j<e;j++)h.push({x:Math.floor(2*Math.random()*c.hmax)-c.hmax,y:Math.floor(2*Math.random()*c.vmax)-c.vmax});h.push({x:0,y:0});var k=this;renderer.animator.requestFrame(function i(){var e=
Date.now()-d,j=1/(h.length-1),q=e/c.time;1<q||b?(q=1,b=a=!1,k.done()):renderer.animator.requestFrame(i);var s=Math.floor((h.length-1)*q),e=s+1,j=q/j-s;e>=h.length&&(e=h.length-1);s=h[s];e=h[e];renderer.xShift=s.x+(e.x-s.x)*j;renderer.yShift=s.y+(e.y-s.y)*j});return 0}});Tag.actions.stopquake=new TagAction({rules:{},action:function(){a&&(b=!0);return 0}});Tag.actions.wq=new TagAction({rules:{canskip:{type:"BOOLEAN",defaultValue:!1}},action:function(c){if(!a)return 0;if(c.canskip&&o2.clickSkipEnabled){if(o2.skipMode)return b=
!0,0;wait("click",function(){b=!0})}wait("quake");return 1}})})();Tag.actions.label=new TagAction({rules:{name:{type:"STRING",required:!0},caption:{type:"STRING"}},action:function(){return 0}});
Tag.actions.jump=new TagAction({rules:{storage:{type:"STRING"},target:{type:"STRING"},o2_url:{type:"STRING"},o2_urltarget:{type:"STRING",defaultValue:"_blank"}},action:function(a){"o2_url"in a&&window.open(a.o2_url,a.o2_urltarget);var b;b=a.storage?KAGFiles(a.storage):conductor.file;a.target?(a=a.target,"*"==a.charAt(0)&&(a=a.substring(1)),(b=b.getLabelTag(a))||this.error(a+"\u3068\u3044\u3046\u30e9\u30d9\u30eb\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002")):b=b.lines[0];currentConductor.setTag(b);
currentConductor.clearIfStack();currentConductor.clearMacroStack();return 0}});Tag.actions.call=new TagAction({rules:{storage:{type:"STRING"},target:{type:"STRING"}},action:function(){var a=conductor.getNextTag();conductor.callStack.push(a);a=new Tag("jump",this.args);currentConductor.stack.push(a);return 0}});
Tag.actions["return"]=new TagAction({rules:{storage:{type:"STRING"},target:{type:"STRING"}},action:function(a){var b=conductor.callStack.pop();b||this.error("\u30b5\u30d6\u30eb\u30fc\u30c1\u30f3\u5916\u3067[return]\u304c\u5b9f\u884c\u3055\u308c\u307e\u3057\u305f");a.storage||a.target?(a=new Tag("jump",this.args),currentConductor.stack.push(a)):conductor.setTag(b);return 0}});
Tag.actions.macro=new TagAction({rules:{name:{type:"STRING",required:!0}},action:function(a){var b=new MacroDefinition({startTag:conductor.getNextTag()});currentConductor.macros[a.name.toLowerCase()]=b;(a=currentConductor.getNextTag("endmacro"))||this.error("endmacro\u30bf\u30b0\u304c\u898b\u3064\u304b\u3089\u306a\u3044");currentConductor.setTag(a);return 0}});Tag.actions.endmacro=new TagAction({action:function(){return 0}});
Tag.actions.erasemacro=new TagAction({rules:{name:{type:"STRING",required:!0}},action:function(a){delete currentConductor.macros[a.name];return 0}});Tag.actions.seopt=new TagAction({rules:{buf:{type:"INT",defaultValue:0},volume:{type:"INT"}},action:function(a){o2.se[a.buf].setVolume(a.volume/100);return 0}});
Tag.actions.playse=new TagAction({rules:{buf:{type:"INT",defaultValue:0},storage:{type:"STRING",required:!0},loop:{type:"BOOLEAN",defaultValue:!1},o2_start:{type:"INT"},o2_block:{type:"BOOLEAN"}},action:function(a){var b=o2.se[a.buf];b.play(a.storage);b.setLoop(a.loop);"o2_start"in a&&b.setTime(a.o2_start);var c=this;return a.o2_block?(b.loadDefer.done(function(){setTimeout(function(){c.done()})}),1):0}});
Tag.actions.stopse=new TagAction({rules:{buf:{type:"INT",defaultValue:0}},action:function(a){o2.se[a.buf].stop();return 0}});Tag.actions.fadese=new TagAction({rules:{buf:{type:"INT",defaultValue:0},volume:{type:"INT",required:!0},time:{type:"INT",required:!0}},action:function(a){o2.se[a.buf].fade({toVolume:a.volume/100,duration:a.time});return 0}});
Tag.actions.fadeinse=new TagAction({rules:{buf:{type:"INT",defaultValue:0},storage:{type:"STRING",required:!0},time:{type:"INT",required:!0},loop:{type:"BOOLEAN",defaultValue:!1},o2_start:{type:"FLOAT"},o2_volume:{type:"INT"},o2_block:{type:"BOOLEAN",defaultValue:!1}},action:function(a){var b=o2.se[a.buf];b.play(a.storage);b.setLoop(a.loop);"o2_start"in a&&b.setTime(a.o2_start);"o2_volume"in a&&b.setVolume(a.o2_volume/100);b.fade({fromVolume:0,duration:a.time});var c=this;return a.o2_block?(b.loadDefer.done(function(){setTimeout(function(){c.done()})}),
1):0}});Tag.actions.fadeoutse=new TagAction({rules:{buf:{type:"INT",defaultValue:0},time:{type:"INT",required:!0}},action:function(a){var b=o2.se[a.buf];b.fade({toVolume:0,duration:a.time}).done(function(){b.pause()});return 0}});
Tag.actions.wf=new TagAction({rules:{buf:{type:"INT",defaultValue:0},canskip:{type:"BOOLEAN",defaultValue:!1}},action:function(a){var b=this,c=o2.se[a.buf],d=c.fade(),e=!1;if(!d)return 0;if(a.canskip&&o2.clickSkipEnabled){if(o2.skipMode)return c.stopFade(),0;wait("click",function(){e=!0;c.stopFade()})}d.done(function(){e||b.done()});return 1}});
Tag.actions.ws=new TagAction({rules:{buf:{type:"INT",defaultValue:0},canskip:{type:"BOOLEAN",defaultValue:!1}},action:function(a){var b=o2.se[a.buf],c=this,d=!1;if(!b.isPlaying)return 0;if(a.canskip&&o2.clickSkipEnabled){if(o2.skipMode)return b.stop(),0;wait("click",function(){d=!0;b.stop()})}$(b).one("ended",function(){d||c.done()});return 1}});Tag.actions.bgmopt=new TagAction({rules:{volume:{type:"INT"}},action:function(a){o2.bgm.setVolume(a.volume/100);return 0}});
Tag.actions.playbgm=new TagAction({rules:{storage:{type:"STRING",required:!0},loop:{type:"BOOLEAN",defaultValue:!0},o2_start:{type:"INT"},o2_block:{type:"BOOLEAN"}},action:function(a){var b=o2.bgm;b.play(a.storage);b.setLoop(a.loop);"o2_start"in a&&b.setTime(a.o2_start);var c=this;return a.o2_block?(b.loadDefer.done(function(){setTimeout(function(){c.done()})}),1):0}});Tag.actions.pausebgm=new TagAction({action:function(){o2.bgm.pause();return 0}});
Tag.actions.resumebgm=new TagAction({action:function(){o2.bgm.play();return 0}});Tag.actions.stopbgm=new TagAction({action:function(){o2.bgm.stop();return 0}});Tag.actions.fadebgm=new TagAction({rules:{volume:{type:"INT",required:!0},time:{type:"INT",required:!0}},action:function(a){o2.bgm.fade({toVolume:a.volume/100,duration:a.time});return 0}});
Tag.actions.fadeinbgm=new TagAction({rules:{storage:{type:"STRING",required:!0},time:{type:"INT",required:!0},loop:{type:"BOOLEAN",defaultValue:!0},o2_start:{type:"FLOAT"},o2_volume:{type:"INT"},o2_block:{type:"BOOLEAN",defaultValue:!1}},action:function(a){var b=o2.bgm;b.play(a.storage);b.setLoop(a.loop);"o2_start"in a&&b.setTime(a.o2_start);"o2_volume"in a&&b.setVolume(a.o2_volume/100);b.fade({fromVolume:0,duration:a.time});var c=this;return a.o2_block?(b.loadDefer.done(function(){setTimeout(function(){c.done()})}),
1):0}});Tag.actions.fadeoutbgm=new TagAction({rules:{time:{type:"INT",required:!0}},action:function(a){var b=o2.bgm,c=b.volume;(a=b.fade({toVolume:0,duration:a.time}))&&a.done(function(){b.stop();b.setVolume(c)});return 0}});Tag.actions.fadepausebgm=new TagAction({rules:{time:{type:"INT",required:!0}},action:function(a){var b=o2.bgm;(a=b.fade({toVolume:0,duration:a.time}))&&a.done(function(){b.pause()});return 0}});
Tag.actions.xchgbgm=new TagAction({rules:{storage:{type:"STRING",required:!0},loop:{type:"BOOLEAN",defaultValue:!0},time:{type:"INT",required:!0},overlap:{type:"INT",defaultValue:0},volume:{type:"INT"},o2_start:{type:"INT"}},action:function(a){var b;b="volume"in a?a.volume:o2.bgm.volume;var c=new Sound,d=o2.bgm,e=this;c.setFile(a.storage).done(function(){o2.bgm=c;d.fade({toVolume:0,duration:a.time,id:"old"}).done(function(){d.stop()});setTimeout(function(){c.play();"o2_start"in a&&c.setTime(a.o2_start);
c.fade({fromVolume:0,toVolume:b,duration:a.time})},a.time-a.overlap);e.done()});c.setLoop(a.loop);return 1}});Tag.actions.wb=new TagAction({rules:{canskip:{type:"BOOLEAN",defaultValue:!1}},action:function(a){var b=this,c=o2.bgm,d=c.fade();if(!d)return 0;if(a.canskip&&o2.clickSkipEnabled){if(o2.skipMode)return c.stopFade(),0;wait("click",function(){c.stopFade()})}d.done(function(){b.done()});return 1}});
Tag.actions.wl=new TagAction({rules:{canskip:{type:"BOOLEAN",defaultValue:!1}},action:function(a){var b=this,c=o2.bgm;if(!c.isPlaying)return 0;if(a.canskip&&o2.clickSkipEnabled){if(o2.skipMode)return c.stop(),0;wait("click",function(){c.stop()})}$(c).one("ended",function(){b.done()});return 1}});
(function(){function a(a){var c=currentConductor.upCommingTags(),d=0;"string"===typeof a&&(a=[a]);for(var e=0;e<c.length;e++){var h=c[e];if(0===d&&-1!==a.indexOf(h.tagName))return h;"if"===h.tagName&&d++;"endif"===h.tagName&&d--}}IfStatus=function(){this.conditionFulfilled=!1;this.endTag};Tag.actions["if"]=Tag.actions.ignore=new TagAction({rules:{o2_exp:{type:"STRING",required:!0}},action:function(b){var c=new IfStatus;currentConductor.ifStack.push(c);c.conditionFulfilled=eval(b.o2_exp);"ignore"===
this.tagName&&(c.conditionFulfilled=!c.conditionFulfilled);c.conditionFulfilled||(b=a(["else","elsif","endif","endignore"]))&&currentConductor.setTag(b);return 0}});Tag.actions["else"]=new TagAction({action:function(){var b=currentConductor.ifStack[currentConductor.ifStack.length-1];if(!b)return 0;b.conditionFulfilled&&(b=a(["endif","endignore"]))&&currentConductor.setTag(b);return 0}});Tag.actions.elsif=new TagAction({rules:{o2_exp:{type:"STRING",required:!0}},action:function(b){var c=currentConductor.ifStack[currentConductor.ifStack.length-
1],d=!1;if(!c)return 0;c.conditionFulfilled?d=!0:eval(b.o2_exp)?c.conditionFulfilled=!0:d=!0;d&&(b=a(["else","elsif","endif","endignore"]))&&currentConductor.setTag(b);return 0}});Tag.actions.endif=Tag.actions.endignore=new TagAction({action:function(){currentConductor.ifStack.pop();return 0}})})();
Tag.actions.wait=new TagAction({rules:{time:{type:"INT",required:!0},mode:{type:/normal|until/,defaultValue:"normal"},canskip:{type:"BOOLEAN",defaultValue:!0}},action:function(a){var b=this,c=setTimeout(function(){b.done()},a.time);if(a.canskip&&o2.clickSkipEnabled){if(o2.skipMode)return clearTimeout(c),0;wait("click",function(){clearTimeout(c)})}return 1}});Tag.actions.waitclick=new TagAction({action:function(){wait("click",function(){o2.skipMode=o2.SKIP_MODE_NONE});return 1}});
Tag.actions.cancelskip=new TagAction({action:function(){o2.skipMode=o2.SKIP_MODE_NONE;return 0}});Tag.actions.clickskip=new TagAction({rules:{enabled:{type:"BOOLEAN",required:!0}},action:function(a){o2.clickSkipEnabled=a.enabled;return 0}});Tag.actions.eval=new TagAction({rules:{o2_exp:{type:"STRING",required:!0}},action:function(a){eval(a.o2_exp);return 0}});Tag.actions.o2_iscript=new TagAction({rules:{o2_exp:{type:"STRING",required:!0}},action:function(a){eval(a.o2_exp);return 0}});
$(function(){function a(){c=[];for(var a=o2.autoHideLayers(),b=0;b<a.length;b++){var d=a[b];c.push(d.visible);d.visible=!1}renderer.animator.requestFrame();glyph.hide()}var b={call:!1,jump:!1,target:void 0,storage:void 0,enabled:!0},c=void 0;$(o2).on("rclick",function(){if(-1!=["p","l","s"].indexOf(currentConductor.currentTag.tagName)&&b.enabled&&!c)if(b.call){var e=new Tag("call",b);currentConductor.stack.push(e)}else b.jump?(e=new Tag("jump",b),currentConductor.stack.push(e)):(a(),$(o2).bindFirst("click",
d),$(o2).bindFirst("rclick",d))});var d=function(a){a.stopImmediatePropagation();if(c){for(var a=o2.autoHideLayers(),b=0;b<a.length;b++)a[b].visible=c[b];renderer.animator.requestFrame();c=void 0;glyph.show()}$(o2).off("click",d);$(o2).off("rclick",d)};Tag.actions.rclick=new TagAction({rules:{call:{type:"BOOLEAN"},jump:{type:"BOOLEAN"},target:{type:"STRING"},storage:{type:"STRING"},enabled:{type:"BOOLEAN"}},action:function(a){if("call"in a&&!0===a.call&&"jump"in a&&!0===a.jump)return this.error("call\u3068jump\u3092\u540c\u6642\u306btrue\u306b\u3057\u3066\u306f\u3044\u3051\u306a\u3044\u3002"),
0;for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return 0}});Tag.actions.hidemessage=new TagAction({action:function(){a();var b=this;$(o2).bindFirst("click",d);$(o2).bindFirst("click",function j(){setTimeout(function(){b.done()});$(o2).off("click",j)});return 1}})});
(function(){var a=void 0;Tag.actions.o2_request=new TagAction({rules:{method:{type:/get|post/i,required:!0},url:{type:"STRING",required:!0},req:{type:"STRING",required:!0},"return":{type:"STRING",defaultValue:"req"}},action:function(b){a=$.ajax({url:b.url,type:b.method,data:b.req}).done(function(c){ev[b["return"]]=c;a=void 0});return 0}});Tag.actions.o2_wr=new TagAction({rules:{canskip:{type:"BOOLEAN",defaultValue:!1},timeout:{type:"INT"}},action:function(b){function c(){e||(d.done(),e=!0)}if(!a)return 0;
var d=this,e=!1;a.done(function(){setTimeout(c)});"timeout"in b&&setTimeout(c,b.timeout);b.canskip&&o2.clickSkipEnabled&&wait("click",function(){e=!0});return 1}})})();
function setupEventHandlers(){$(o2).on("click",function(){glyph.hide();currentConductor.trigger("click")});$("body").on("touchstart touchmove touchcancel touchend mousemove mouseup",function(a){var b=a.type,c=function(){var b=a.target;if(!b)return!1;for(;b;){if(b.tagName&&"a"==b.tagName.toLowerCase())return!0;b=b.parentNode}return!1}();if(a.type&&c)a.stopImmediatePropagation();else if(!o2.history.isShown){if("touchmove"==b||"touchstart"==b)b="mousemove";else if("touchend"==b||"touchcancel"==b)b="mouseup";
for(c=o2.foreLayers.messageLayers.length-1;0<=c;c--){var j=o2.foreLayers.messageLayers[c];if(j[b]&&j[b](a)){a.stopImmediatePropagation();break}}}});$("body").on("mouseup",function(a){3==a.which?o2.history.isShown?o2.history.hide():$(o2).trigger("rclick"):o2.history.isShown||$(o2).trigger("click")});$("body").on("keydown",function(a){if("keyCode"in a)switch(a.keyCode){case 38:o2.history.scrolled({x:0,y:30});break;case 40:o2.history.isShown&&o2.history.scrolled({x:0,y:-30});break;case 13:o2.history.isShown||
$(o2).trigger("click")}});$("body").on("mousewheel DOMMouseScroll wheel",function(a){a.preventDefault();a=wheelDistance(a.originalEvent);o2.history.scrolled(a)});var a=!1,b,c;$("body").on("touchstart touchmove touchend touchcancel",function(d){var e=d.originalEvent,h=e.normalizedCoordinate();d.preventDefault();if(a){if(c=b=void 0,("touchend"==d.type||"touchcancel"==d.type)&&0==e.touches.length)a=!1}else{"touchstart"==d.type&&(b||(b=h),c=h,d.target!=o2.history.historyContent&&d.preventDefault());if("touchmove"==
d.type){var j=h.x-b.x,k=h.y-b.y,m;m=c?{x:h.x-c.x,y:h.y-c.y}:{x:0,y:0};var i=!1;20>Math.abs(j)&&100<Math.abs(k)?0<k&&!o2.history.isShown&&(o2.history.touchmoved({x:0,y:30}),a=i=!0):100<Math.abs(j)&&20>Math.abs(k)&&(0>j&&!o2.history.isShown)&&(o2.history.touchmoved({x:-30,y:0}),a=i=!0);o2.history.isShown&&!i&&(o2.history.touchmoved(m),o2.history.animating&&(a=!0));c=h}if("touchend"==d.type||"touchcancel"==d.type)1==e.changedTouches.length&&0==e.touches.length?(c=b=void 0,1==e.changedTouches.length&&
(o2.history.isShown||$(o2).trigger("click"))):2==e.changedTouches.length+e.touches.length&&(o2.history.isShown?o2.history.hide():($(o2).trigger("rclick"),e.touches.length&&(a=!0)))}});$("body").on("contextmenu",function(a){a.preventDefault()})}HistoryRecorder=function(){this.options={enabled:!0,output:!0,repage:!1};this.historyPages=[];this.lineCount=this.pageCount=this.currentPage=0;this.historyInner=this.historyContent=this.historyWrapper=void 0;this.animating=!1;this.isShown=!0;this.taketori;this.taketoriDiv};
HistoryRecorder.prototype.init=function(){this.historyWrapper=document.getElementsByClassName("history-wrapper")[0];this.historyContent=document.getElementsByClassName("history-content")[0];this.historyInner=document.getElementsByClassName("history-inner")[0];this.options.repage=config.historyLayerEverypage;this.historyInner.style.fontFamily=config.historyLayerFontFace;this.historyInner.style.color=config.historyLayerFontColor;this.historyInner.style.fontWeight=config.historyLayerFontBold?"bold":
"normal";this.historyInner.style.fontSize=config.historyLayerFontHeight+"px";this.historyInner.style.lineHeight=config.historyLayerLineHeight+"px";if(""!=config.historyLayerFrame)this.historyWrapper.style.backgroundImage="url("+o2.imageList[config.historyLayerFrame]+")";else{var a=hexToRgb(config.historyLayerColor),a="rgba("+a.r+","+a.g+","+a.b+","+config.historyLayerOpacity+")";this.historyWrapper.style.backgroundColor=a}this.historyContent.style.top=config.historyLayerMarginT+"px";this.historyContent.style.left=
config.historyLayerMarginL+"px";this.historyContent.style.right=config.historyLayerMarginR+"px";this.historyContent.style.bottom=config.historyLayerMarginB+"px";this.historyWrapper.style.left=config.historyLayerCurrentPositionX+"px";this.historyWrapper.style.top=config.historyLayerCurrentPositionY+"px";this.historyWrapper.style.width=config.historyLayerCurrentWidth+"px";this.historyWrapper.style.height=config.historyLayerCurrentHeight+"px";this.taketori=new Taketori;this.taketori.set({lang:"ja-jp",
cssPath:"engine/",height:config.historyLayerCurrentHeight-config.historyLayerMarginT-config.historyLayerMarginB+"px",fontFamily:"serif"})};HistoryRecorder.prototype.touchmoved=function(a){o2.currentMessageLayer.vertical?this.scrolled({x:a.x,y:0}):this.scrolled({x:0,y:a.y})};
HistoryRecorder.prototype.scrolled=function(a){if(!this.animating){var b=parseFloat(this.historyInner.style.marginTop),c=parseFloat(this.historyInner.style.marginLeft);b||(b=0);c||(c=0);if(o2.currentMessageLayer.vertical)if(this.isShown){if(0==c&&0>a.x-a.y&&this.prevPage(20<Math.abs(a.y)?"down":"left"),c+=a.x-a.y,0>c&&(c=0),this.taketoriDiv){var b=this.historyLength(),d=o2.history.historyInner.offsetWidth;this.historyInner.style.marginLeft=c+"px";c+d>=b+30&&this.nextPage(20<Math.abs(a.y)?"up":"right")}}else this.resetCurrentPage(),
0<a.y?this.show("down"):0>a.x&&this.show("left");else b+=a.y,!this.isShown&&0<a.y?(this.resetCurrentPage(),this.show()):0<b?this.prevPage():(this.historyInner.style.marginTop=b+"px",b+this.historyInner.scrollHeight<this.historyContent.offsetHeight-30&&this.nextPage(10<Math.abs(a.y)?"up":"right"))}};
HistoryRecorder.historyDataRenderer={text:function(a){for(var b="",c=!1,d=0;d<a.length;d++){var e=a[d];if(!c&&!e.rubyText)c=!0,b+="<span>";else if(c&&(e.rubyText||d==a.length-1))c=!1,b+="</span>";b+=e.text}return b},linebreak:function(){return"<BR/>"},pagebreak:function(){this.addPage();return""}};
HistoryRecorder.prototype.add=function(a,b){this.options.output&&("pagebreak"==a?this.addPage():(this.historyPages.length||this.addPage(),this.historyPages[this.historyPages.length-1].push({type:a,data:b}),this.lineCount++,this.ensureHistoryLimit()))};HistoryRecorder.prototype.addPage=function(){if(this.options.output){var a=this.historyPages.length-1;this.historyPages[a]&&0==this.historyPages[a].length||(this.pageCount++,this.historyPages.push([]))}};
HistoryRecorder.prototype.ensureHistoryLimit=function(){100<this.historyPages.length&&this.historyPages.shift();1E3<this.lineCount&&this.historyPages[0].shift()};
HistoryRecorder.prototype.render=function(){function a(a){for(var b="",a=c.historyPages[a],d=0;d<a.length;d++){var k=a[d],m=HistoryRecorder.historyDataRenderer[k.type];"function"==typeof m&&(b+=m(k.data))}return b}var b="",c=this;if(this.options.repage)b=a(this.currentPage);else for(var d=0;d<this.historyPages.length;d++)b+=a(d);this.historyInner.innerHTML=b};
HistoryRecorder.prototype.prevPage=function(a){if(this.options.repage)if(0>=this.currentPage)this.currentPage=0;else{var b=this;a||(a=o2.currentMessageLayer.vertical?"left":"down");this.hide(a).done(function(){b.currentPage--;b.show(a)})}};HistoryRecorder.prototype.nextPage=function(a){a||(a=o2.currentMessageLayer.vertical?"right":"up");if(this.currentPage>=this.historyPages.length-1)this.hide(a);else{var b=this;this.hide(a).done(function(){b.currentPage++;b.show(a,!0)})}};
HistoryRecorder.prototype.show=function(a,b){a||(a="down");var c=$.Deferred();if(this.animating||!this.options.enabled||!this.historyPages.length)return c.reject(),c.promise();this.isShown=!0;this.render();this.historyWrapper.style.display="block";if(o2.currentMessageLayer.vertical)this.historyInner.style.overflow="visible",this.taketori.element("div.history-inner").toVertical(!1),this.taketoriDiv=$(o2.history.historyInner).children(".taketori-col")[0],b?this.historyInner.style.marginLeft="0px":setTimeout(function(){var a=
this.historyLength();this.historyInner.style.marginLeft=a-this.historyInner.offsetWidth+"px"}.bind(this),120);else{this.historyInner.style.height="0px";var d=this.historyLength(),e=this.historyContent.offsetHeight-30;d<e&&(d=e);this.historyInner.style.height=d+"px";b?this.historyInner.style.marginTop="0px":(d=this.historyContent.offsetHeight-d,0<d&&(d=0),this.historyInner.style.marginTop=d+"px")}if("none"!=a){this.animating=!0;var h=this,e=d="0px";switch(a){case "left":e="300px";break;case "right":e=
"-300px";break;case "up":d="300px";break;case "down":d="-300px"}$(this.historyWrapper).css({marginTop:d,marginLeft:e,opacity:0}).animate({marginTop:"0px",marginLeft:"0px",opacity:1},600,"swing",function(){h.animating=!1;c.resolve()})}else c.resolve();return c.promise()};
HistoryRecorder.prototype.hide=function(a){if(!this.animating){this.isShown=!1;a||(a="up");var b=this,c=$.Deferred();if("none"!=a){this.animating=!0;var d="0px",e="0px";switch(a){case "left":e="-300px";break;case "right":e="300px";break;case "up":d="-300px";break;case "down":d="300px"}$(this.historyWrapper).css({opacity:1}).animate({marginTop:d,marginLeft:e,opacity:0},600,"swing",function(){b.historyInner.innerHTML="";b.historyWrapper.style.display="none";b.historyWrapper.style.opacity=1;b.animating=
!1;b.taketori.clear(b.historyInner);delete b.taketoriDiv;c.resolve()})}else b.historyWrapper.style.opacity=1,b.historyWrapper.style.display="none",c.resolve();return c}};HistoryRecorder.prototype.resetCurrentPage=function(){this.currentPage=this.historyPages.length-1};
HistoryRecorder.prototype.historyLength=function(){if(o2.currentMessageLayer.vertical)return!this.taketoriDiv?this.historyInner.offsetWidth:browser.isFirefox?this.taketoriDiv.scrollHeight:this.taketoriDiv.scrollWidth;this.historyInner.style.overflow="scroll";var a=this.historyInner.scrollHeight;this.historyInner.style.overflow="hidden";return a};
Tag.actions.history=new TagAction({rules:{output:{type:"BOOLEAN"},enabled:{type:"BOOLEAN"}},action:function(a){"output"in a&&(o2.history.options.output=a.output);"enabled"in a&&(o2.history.options.enabled=a.enabled);return 0}});Tag.actions.hr=new TagAction({rules:{repage:{type:"BOOLEAN",defaultValue:!1}},action:function(a){o2.history.options.repage?a.repage?o2.history.addPage():o2.history.add("linebreak"):o2.history.add("linebreak");return 0}});
Tag.actions.showhistory=new TagAction({action:function(){o2.history.show();return 1}});Tag.actions.hact=new TagAction({rules:{o2_exp:{type:"STRING",required:!0}},action:function(a){o2.history.add("hact",a.o2_exp);return 0}});HistoryRecorder.historyDataRenderer.hact=function(a){return'<a href="#" onclick="'+a.replace(/"/g,"&quot;")+'">'};Tag.actions.endhact=new TagAction({action:function(){o2.history.add("endhact");return 0}});HistoryRecorder.historyDataRenderer.endhact=function(){return"</a>"};
var Video=function(){this.element=document.createElement("video");this.element.setAttribute("webkit-playsinline",!0);this.filepath;this.rect=new Rect(0,0,320,240);this.loop=!1;this.outputs=[];this.volume=1;this.mode=Video.MODE_OVERLAY;this.loadDefer};Video.prototype.toJSON=function(){return{rect:this.rect,loop:this.loop,outputs:this.outputs,volume:this.volume,mode:this.mode,currentTime:this.element.currentTime,paused:this.paused(),filepath:this.filepath}};
Video.prototype.importFromSaveData=function(a){var b=$.Deferred();a.filepath&&(this.setFile(a.filepath),delete a.filepath);"paused"in a&&(a.paused?this.pause():this.play());"currentTime"in a?this.setTime(1E3*a.currentTime):b.resolve();this.mode=a.mode;this.setVolume(a.volume);this.setLoop(a.loop);this.setRect(a.rect);return b.promise()};Video.MODE_OVERLAY=0;Video.MODE_LAYER=1;Video.canPlayInline=function(){var a=null!=navigator.userAgent.match(/iPad/i);return browser.isIOs&&!a?!1:!0}();
Video.prototype.setFile=function(a){if(Video.canPlayInline){this.filepath=a;var b=this;return this.loadDefer=ResourceLoader.loadVideo(a,!0,this.element).done(function(a){b.setLoop();b.setRect();$(a).on("ended",function(){$(b).trigger("ended")})})}};Video.prototype.setVisible=function(a){if(Video.canPlayInline){var b=document.getElementsByClassName("video-wrapper")[0],c=!!this.element.parentNode;c&&!a?b.removeChild(this.element):!c&&a&&b.appendChild(this.element)}};
Video.prototype.setRect=function(a){a&&(this.rect=a);var b=this;this.loadDefer&&this.loadDefer.done(function(a){a.style.marginLeft=b.rect.x+"px";a.style.marginTop=b.rect.y+"px";a.width=b.rect.width;a.height=b.rect.height})};Video.prototype.setLoop=function(a){void 0!==a&&(this.loop=a);if(this.loadDefer){var b=this;this.loadDefer.done(function(a){a.loop=b.loop})}};Video.prototype.setPlaybackRate=function(a){this.loadDefer&&this.loadDefer.done(function(b){b.playbackRate=a})};
Video.prototype.setVolume=function(a){void 0!==a&&(this.volume=a);if(this.loadDefer){var b=this;this.loadDefer.done(function(a){a.volume=b.volume})}};Video.prototype.play=function(a){a&&this.setFile(a);this.element.play()};Video.prototype.pause=function(){this.element.pause()};Video.prototype.paused=function(){return!this.element||!this.loadDefer?!0:this.element.paused};Video.prototype.stop=function(){this.pause();this.setTime(0)};
Video.prototype.setTime=function(a){this.loadDefer&&this.loadDefer.done(function(b){try{b.currentTime=a/1E3}catch(c){$(b).one("loadedmetadata",function(){b.currentTime=a/1E3})}})};Video.prototype.dummyLoad=function(){this.element.src="x";this.element.load()};
Tag.actions.video=new TagAction({rules:{slot:{type:"INT",defaultValue:0},visible:{type:"BOOLEAN"},left:{type:"INT"},top:{type:"INT"},width:{type:"INT"},height:{type:"INT"},loop:{type:"BOOLEAN"},position:{type:"INT"},frame:{type:"INT"},mode:{type:/overlay|layer/i},playrate:{type:"FLOAT"},volume:{type:"FLOAT"}},action:function(a){var b=o2.videos[a.slot];if(!b)return this.error("slot("+a.slot+")\u304c\u898b\u3064\u304b\u3089\u306a\u3044"),0;"visible"in a&&b.setVisible(a.visible);var c=!1;"left"in a&&
(b.rect.x=a.left,c=!0);"top"in a&&(b.rect.y=a.top,c=!0);"width"in a&&(b.rect.width=a.width,c=!0);"height"in a&&(b.rect.height=a.height,c=!0);c&&b.setRect();"loop"in a&&b.setLoop(a.loop);"position"in a&&b.setTime(a.position);"mode"in a&&("layer"==a.mode?b.setMode(Video.MODE_LAYER):b.setMode(Video.MODE_OVERLAY));"playrate"in a&&b.setPlaybackRate(a.playrate);"volume"in a&&b.setVolume(a.volume/100);return 0}});
Tag.actions.videolayer=new TagAction({rules:{slot:{type:"INT",defaultValue:0},channel:{type:/1|2/,required:!0},page:{type:/fore|back/,required:!0},layer:{type:"LAYER",required:!0}},action:function(a){var b=o2.videos[a.slot];if(!b)return this.error("slot("+a.slot+")\u304c\u898b\u3064\u304b\u3089\u306a\u3044"),0;b.outputs[a.channel]=a.layer[a.page];return 0}});
Tag.actions.openvideo=new TagAction({rules:{slot:{type:"INT",defaultValue:0},storage:{type:"STRING",required:!0}},action:function(a){var b=o2.videos[a.slot];if(!b)return this.error("slot("+a.slot+")\u304c\u898b\u3064\u304b\u3089\u306a\u3044"),0;try{b.setFile(a.storage)}catch(c){this.error(c)}return 0}});
Tag.actions.preparevideo=new TagAction({rules:{slot:{type:"INT",defaultValue:0}},action:function(){var a=this;renderer.animator.requestFrame(function(){renderer.animator.requestFrame(function(){a.done()})});return 1}});Tag.actions.playvideo=new TagAction({rules:{slot:{type:"INT",defaultValue:0},storage:{type:"STRING"}},action:function(a){var b=o2.videos[a.slot];if(!b)return this.error("slot("+a.slot+")\u304c\u898b\u3064\u304b\u3089\u306a\u3044"),0;try{b.play(a.storage)}catch(c){this.error(c)}return 0}});
Tag.actions.pausevideo=new TagAction({rules:{slot:{type:"INT",defaultValue:0}},action:function(a){var b=o2.videos[a.slot];if(!b)return this.error("slot("+a.slot+")\u304c\u898b\u3064\u304b\u3089\u306a\u3044"),0;b.pause();return 0}});Tag.actions.resumevideo=new TagAction({rules:{slot:{type:"INT",defaultValue:0}},action:function(a){var b=o2.videos[a.slot];if(!b)return this.error("slot("+a.slot+")\u304c\u898b\u3064\u304b\u3089\u306a\u3044"),0;b.play();return 0}});
Tag.actions.stopvideo=new TagAction({rules:{slot:{type:"INT",defaultValue:0}},action:function(a){var b=o2.videos[a.slot];if(!b)return this.error("slot("+a.slot+")\u304c\u898b\u3064\u304b\u3089\u306a\u3044"),0;b.stop();return 0}});Tag.actions.rewindvideo=new TagAction({rules:{slot:{type:"INT",defaultValue:0}},action:function(a){var b=o2.videos[a.slot];if(!b)return this.error("slot("+a.slot+")\u304c\u898b\u3064\u304b\u3089\u306a\u3044"),0;b.setTime(0);return 0}});
Tag.actions.wv=new TagAction({rules:{slot:{type:"INT",defaultValue:0},canskip:{type:"BOOLEAN",defaultValue:!1}},action:function(a){var b=o2.videos[a.slot];if(!b)return this.error("slot("+a.slot+")\u304c\u898b\u3064\u304b\u3089\u306a\u3044"),0;if(b.paused())return 0;if(a.canskip&&o2.clickSkipEnabled){if(o2.skipMode)return b.stop(),0;wait("click",function(){b.stop()})}var c=this;$(b).on("ended",function(){c.done()});return 1}});
Object.defineProperty(Object.prototype,"objectToBeSerialized",{enumerable:!1,writable:!0,value:function(a){return this[a]}});Object.defineProperty(Object.prototype,"toJSON",{enumerable:!1,writable:!0,value:function(){var a=this instanceof Array?[]:{},b;for(b in this){var c=this.objectToBeSerialized(b);void 0!==c&&"function"!=typeof c&&(a[b]=c)}return a}});var saveStack=[];
Object.defineProperty(Object.prototype,"importFromSaveData",{enumerable:!1,writable:!0,value:function(a){var b=[],c=this,d;for(d in a)(function(d){var h=c[d],j=a[d];saveStack.push(d);console.log(saveStack.join(">"));"object"==typeof h?b.push(h.importFromSaveData(j)):(h=!1,j.initializer&&(h=!0,b.push($.when(j.restore()).done(function(a){c[d]=a}))),h||(c[d]=j));saveStack.pop()})(d);return $.when.apply($,b).then(function(){return c})}});
Object.defineProperty(Object.prototype,"restore",{enumerable:!1,writable:!0,value:function(){return"function"===typeof window[this.initializer]?window[this.initializer].restore!=Object.prototype.restore?window[this.initializer].restore(this):(new window[this.initializer]).importFromSaveData(this):this}});
function serializeCurrentState(){window.serializeLog="";return JSON.stringify({o2:o2,f:f,mp:mp,conductor:conductor},function(a,b){if("nodeName"==a)debugger;serializeLog+=a+":"+b+",";var c=Object.prototype.toString.apply(b);if(/\[object HTML[A-Za-z]*Element\]/.test(c))debugger;else if("function"==typeof b)debugger;else return b})}function applyDeserializedData(a){a=JSON.parse(a);return window.importFromSaveData(a).done(function(){o2.allLayers().forEach(function(a){a.redrawRect()})})}
Tag.actions.save=Tag.actions.o2_savestat=new TagAction({rules:{place:{type:"INT",defaultValue:0},ask:{type:"BOOLEAN",defaultValue:!1}},action:function(a){console.time("save");var b=serializeCurrentState(!0);console.timeEnd("save");var c=config.gameID+"_"+a.place;(!a.ask||confirm("\u672c\u5f53\u306b\u30bb\u30fc\u30d6\u3057\u307e\u3059\u304b\uff1f"))&&localStorage.setItem(c,b);return 0}});
Tag.actions.load=new TagAction({rules:{place:{type:"INT",defaultValue:0},ask:{type:"BOOLEAN",defaultValue:!1}},action:function(a){var b=this,c=localStorage.getItem(config.gameID+"_"+a.place);if(a.ask&&!confirm("\u672c\u5f53\u306b\u30ed\u30fc\u30c9\u3057\u307e\u3059\u304b\uff1f"))return 0;applyDeserializedData(c).done(function(){setTimeout(function(){b.done()})});return 1}});
(function(){var a;Tag.actions.o2_geo_watch=new TagAction({action:function(){if(a)return 0;a=navigator.geolocation.watchPosition(function(a){ev.geo=a});return 0}});Tag.actions.o2_geo_endwatch=new TagAction({action:function(){navigator.geolocation.clearWatch(a);a=void 0;return 0}});Tag.actions.o2_geo_get=new TagAction({action:function(){var a=this;navigator.geolocation.getCurrentPosition(function(c){ev.geo=c;a.done()},function(){a.done()});return 0}});Tag.actions.o2_geo_wg=new TagAction({rules:{canskip:{type:"BOOLEAN"}},
action:function(a){a.canskip&&wait("click");wait("o2_geo_get");return 1}})})();Tag.actions.clearsysvar=new TagAction({action:function(){window.sf={};return 0}});Tag.actions.clearvar=new TagAction({action:function(){window.f={}}});
Tag.actions.o2_prov_glyph=new TagAction({rules:{line:{type:"STRING"},page:{type:"STRING"},fix:{type:"BOOLEAN"},left:{type:"INT"},top:{type:"INT"}},action:function(a){a.line&&(config.messageLayerDefaultGlyphLine=a.line);a.page&&(config.messageLayerDefaultGlyphPage=a.page);a.fix&&(config.messageLayerDefaultGlyphFixed=a.fix);a.left&&(config.messageLayerDefaultGlyphX=a.left);a.top&&(config.messageLayerDefaultGlyphY=a.top);return 0}});
$(function(){window.glyph={show:function(){config.messageLayerDefaultGlyphFixed?$(this.image).css({left:config.messageLayerDefaultGlyphX+"px",top:config.messageLayerDefaultGlyphY+"px"}):o2.currentMessageLayer.vertical?$(this.image).css({left:o2.currentMessageLayer.textCursor.x+o2.currentMessageLayer.rect.x+o2.currentMessageLayer.font.size-$(this.image).width()+"px",top:o2.currentMessageLayer.textCursor.y+o2.currentMessageLayer.rect.y-$(this.image).height()+o2.currentMessageLayer.style.lineSpacing+
"px"}):$(this.image).css({left:o2.currentMessageLayer.textCursor.x+o2.currentMessageLayer.rect.x+"px",top:o2.currentMessageLayer.textCursor.y+o2.currentMessageLayer.rect.y+Math.max(o2.currentMessageLayer.style.lineSize,o2.currentMessageLayer.font.size)-$(this.image).height()+o2.currentMessageLayer.style.lineSpacing+"px"});$(this.image).show();var a=this;$(this.image).one("load",function(){a.show()})},hide:function(){$(this.image).hide()},showPageGlyph:function(){this.image.src=o2.imageList[config.messageLayerDefaultGlyphLine];
this.show()},showLineGlyph:function(){this.image.src=o2.imageList[config.messageLayerDefaultGlyphPage];this.show()},image:$("#glyph")[0]}});
var config={title:"untitled",scWidth:800,scHeight:600,numMessageLayers:2,numImageLayers:2,backgroundColor:"#eeeeee",chSpeeds:40,numSEBuffers:2,numMovies:1,scPositionX_left:0,scPositionX_left_center:0,scPositionX_center:0,scPositionX_right_center:0,scPositionX_right:0,initialMessageLayerVisible:!1,messageLayerColor:"#000000",messageLayerOpacity:0.75,messageLayerMarginT:6,messageLayerMarginL:6,messageLayerMarginR:6,messageLayerMarginB:6,messageLayerCurrentPositionX:10,messageLayerCurrentPositionY:60,
messageLayerCurrentWidth:480,messageLayerCurrentHeight:35,messageLayerDefaultAutoReturn:!0,messageLayerDefaultFontSize:12,messageLayerDefaultFontFace:"\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af",messageLayerDefaultFontColor:"#FFFFFF",messageLayerDefaultFontBold:!1,messageLayerDefaultFontItalic:!1,messageLayerDefaultStyleLineSpacing:6,messageLayerDefaultStylePitch:0,messageLayerDefaultGlyphLine:"linebreak",messageLayerDefaultGlyphPage:"pagebreak",messageLayerDefaultGlyphFixed:!1,messageLayerDefaultGlyphX:0,
messageLayerDefaultGlyphY:0,historyLayerFontFace:"\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af",historyLayerFontColor:"#FFFFFF",historyLayerFontBold:!1,historyLayerFontHeight:24,historyLayerLineHeight:26,historyLayerEverypage:!1,historyLayerMaxPages:30,historyLayerMaxLines:20,historyLayerStoreState:!1,historyLayerColor:"#000000",historyLayerOpacity:1,historyLayerFrame:"",historyLayerMarginT:30,historyLayerMarginL:30,historyLayerMarginR:30,historyLayerMarginB:30,historyLayerCurrentPositionX:10,historyLayerCurrentPositionY:10,
historyLayerCurrentWidth:300,historyLayerCurrentHeight:300,defaultLinkColor:"#00f",preloadEnabled:!1,useWebFont:void 0,disableSeOnSingleSoundMode:!1},mp={},tf={},sf={},f={},ev={},o2={foreLayers:{baseLayer:void 0,imageLayers:[],messageLayers:[]},backLayers:{baseLayer:void 0,imageLayers:[],messageLayers:[]},currentMessageLayer:void 0,allForeLayers:function(){return[this.foreLayers.baseLayer].concat(this.foreLayers.imageLayers).concat(this.foreLayers.messageLayers)},allBackLayers:function(){return[this.backLayers.baseLayer].concat(this.backLayers.imageLayers).concat(this.backLayers.messageLayers)},
allLayers:function(){return this.allBackLayers().concat(this.allForeLayers())},autoHideLayers:function(){return this.foreLayers.messageLayers.concat(this.backLayers.messageLayers).concat(this.extraAutoHideLayers)},extraAutoHideLayers:[],imageList:[],soundList:[],videoList:[],config:{scriptTagNameKey:"name",scriptTagArgsKey:"args",scriptTagLineKey:"line",scriptTagCharKey:"char"},se:[],seVolume:1,bgm:new Sound,bgmVolume:1,videos:[],skipMode:0,clickSkipEnabled:!0,history:new HistoryRecorder,SKIP_MODE_NONE:0,
SKIP_MODE_CLICK:1,SKIP_MODE_PAGE:2,SKIP_MODE_STOP:3,SKIP_MODE_FAST_FORWARD:4,objectToBeSerialized:function(a){function b(a){for(var b=0;b<o2.foreLayers.messageLayers.length;b++){var e=o2.foreLayers.messageLayers[b];if(a==e)return{page:"fore",layer:b}}for(b=0;b<o2.backLayers.messageLayers.length;b++)if(e=o2.backLayers.messageLayers[b],a==e)return{page:"back",layer:b}}if("function"!=typeof this[a]){switch(a){case "imageList":case "soundList":case "videoList":case "config":case "imageList":case "soundList":case "videoList":case "history":case "SKIP_MODE_NONE":case "SKIP_MODE_CLICK":case "SKIP_MODE_PAGE":case "SKIP_MODE_STOP":case "SKIP_MODE_FAST_FORWARD":return;
case "currentMessageLayer":return b(this.currentMessageLayer);case "autoHideLayers":return this.autoHideLayers.map(function(a){return b(a)})}return this[a]}},importFromSaveData:function(a){this.currentMessageLayer=this["back"==a.currentMessageLayer.page?"backLayers":"foreLayers"].messageLayers[a.currentMessageLayer.layer];delete a.currentMessageLayer;return Object.prototype.importFromSaveData.call(this,a)}};
function initialize(a){var b="scWidth scHeight fps chSpeeds numSEBuffers numImageLayers numMessageLayers numMovies scPositionX_left scPositionX_left_center scPositionX_center scPositionX_right_center scPositionX_right messageLayerOpacity messageLayerMarginT messageLayerMarginL messageLayerMarginR messageLayerMarginB messageLayerCurrentPositionX messageLayerCurrentPositionY messageLayerCurrentWidth messageLayerCurrentHeight messageLayerDefaultFontSize messageLayerDefaultStyleLineSpacing messageLayerDefaultStylePitch messageLayerDefaultGlyphX messageLayerDefaultGlyphY historyLayerFontHeight historyLayerLineHeight historyLayerMaxPages historyLayerMaxLines historyLayerOpacity historyLayerMarginT historyLayerMarginL historyLayerMarginR historyLayerMarginB historyLayerCurrentPositionX historyLayerCurrentPositionY historyLayerCurrentWidth historyLayerCurrentHeight".split(" "),c=
"initialMessageLayerVisible historyLayerFontBold messageLayerDefaultFontBold messageLayerDefaultFontItalic messageLayerDefaultGlyphFixed historyLayerEverypage historyLayerStoreState preloadEnabled disableSeOnSingleSoundMode".split(" "),d;for(d in a.config)config[d]=-1!=b.indexOf(d)?Number(a.config[d]):-1!=c.indexOf(d)?"boolean"==typeof a.config[d]?a.config[d]:"true"==a.config[d].toLowerCase()?!0:"false"==a.config[d].toLowerCase()?!1:Boolean(a.config[d]):a.config[d];var b={videolist:"videoList",imagelist:"imageList",
soundlist:"soundList"},e;for(e in b)b.hasOwnProperty(e)&&"object"===typeof a[e]&&(o2[b[e]]=a[e]);for(e=0;e<config.numSEBuffers;e++)o2.se.push(new Sound);for(e=0;e<config.numMovies;e++)o2.videos.push(new Video);o2.foreLayers.baseLayer=new BaseLayer;o2.backLayers.baseLayer=new BaseLayer;for(e=0;e<config.numImageLayers;e++)b=new ImageLayer,o2.foreLayers.imageLayers.push(b),b=new ImageLayer,o2.backLayers.imageLayers.push(b);for(e=0;e<config.numMessageLayers;e++)b=new MessageLayer,o2.foreLayers.messageLayers.push(b),
b=new MessageLayer,o2.backLayers.messageLayers.push(b);o2.currentMessageLayer=o2.foreLayers.messageLayers[0];config.initialMessageLayerVisible&&(o2.currentMessageLayer.visible=!0);o2.history.init();o2.history.hide("none");setupRenderer();for(var h in a.scripts){b=a.scripts[h];c=new KAGFile(h);for(e=0;e<b.length;e++){d=b[e];var j=new Tag(d[o2.config.scriptTagNameKey],d[o2.config.scriptTagArgsKey]);c.lines.push(j);"undefined"!=typeof d[o2.config.scriptTagLineKey]&&(j.originalLineNumber=d[o2.config.scriptTagLineKey]);
"undefined"!=typeof d[o2.config.scriptTagCharKey]&&(j.originalCharNumber=d[o2.config.scriptTagCharKey])}}glyph.hide();$("body").css("background-color",config.backgroundColor);window.addEventListener("resize",scaleToFitPage)}var renderer;
function setupRenderer(){renderer=new Renderer;renderer.foreLayers=[o2.foreLayers.baseLayer].concat(o2.foreLayers.imageLayers,o2.foreLayers.messageLayers);renderer.backLayers=[o2.backLayers.baseLayer].concat(o2.backLayers.imageLayers,o2.backLayers.messageLayers);$("#main-wrapper").append(renderer.foreCanvas);$("#main-wrapper").css({width:config.scWidth+"px",height:config.scHeight+"px"})}var conductor,currentConductor;
function getScripts(a,b){$.get(a,function(a){void 0!=b&&(a.config.gameID=b);initScripts(a)})}
function initScripts(a){initialize(a);a=null;currentConductor=conductor=new Conductor({file:KAGFiles("first.ks")});conductor.run();setupEventHandlers();if(browser.isIOs||browser.isAndroid)$("body").one("touchstart",function(){o2.bgm.dummyLoad();for(var a=o2.se.length-1;0<=a;a--)o2.se[a].dummyLoad();for(a=o2.videos.length-1;0<=a;a--)o2.videos[a].dummyLoad()});window.FPSMeter&&(window.meter=new FPSMeter({smoothing:2,position:"fixed",top:"auto",left:"auto",bottom:"0px",right:"0px",graph:1,heat:1}))}
window.onerror=function(a,b,c){console.log("window error message"+a+"line"+b+"file"+c,arguments)};$.error=function(){console.log("$error",arguments)};(function(){var a={scriptTagNameKey:0,scriptTagArgsKey:1,scriptTagLineKey:2,scriptTagCharKey:3};"undefined"!==typeof module&&module.exports?exports.config=a:window&&window.o2&&(window.o2.config=a)})();
var TaketoriDblClickAlert={"ja-jp":"\ufeff\u7e26\u66f8\u304d\u5316\u3057\u305f\u3044\u90e8\u5206\u3092\u30c0\u30d6\u30eb\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044\u3002","zh-tw":"\u9ede\u5169\u4e0b\u4ee5\u5207\u63db\u5230\u76f4\u6392\u986f\u793a\u3002","zh-cn":"Double click to make text vertical.","ko-kr":"Double click to make text vertical."},TaketoriDefaultLang=document.getElementsByTagName("html")[0]&&document.getElementsByTagName("html")[0].lang?-1!=document.getElementsByTagName("html")[0].lang.search(/tw/i)?
"zh-tw":"ja-jp":"ja-jp",TaketoriTool=function(){};
TaketoriTool.prototype={element:function(a){1<arguments.length&&(a=Array.prototype.slice.call(arguments));this.elements=[];return this.appendElement(a)},list:function(){return this.elements?this.elements:[]},appendElement:function(a){1<arguments.length&&(a=Array.prototype.slice.call(arguments));if(!a)return this;this.elements||(this.elements=[]);if(a.constructor==Array)for(var b=0;b<a.length;b++)this.appendElement(a[b]);else if("object"==typeof a)this.isIncluded(a)||(this.elements[this.elements.length]=
a);else if("string"==typeof a)if(a.match(/^(\w+)\.([\w\-]+)$/)){var c=RegExp.$1.toLowerCase(),d=RegExp.$2,e=[];if("function"==typeof document.getElementsByClassName){e=document.getElementsByClassName(d);for(b=0;b<e.length;b++)e[b].tagName.toLowerCase()==c&&!this.isIncluded(e[b])&&(this.elements[this.elements.length]=e[b])}if("function"!=typeof document.getElementsByClassName||0==e.length){e=document.getElementsByTagName(c);c=RegExp("(^|\\s)"+d+"(?![\\w\\-])");for(b=0;b<e.length;b++)-1!=e[b].className.search(c)&&
!this.isIncluded(e[b])&&(this.elements[this.elements.length]=e[b])}}else(a=document.getElementById(a.replace("#","")))&&!this.isIncluded(a)&&(this.elements[this.elements.length]=a);return this},isIncluded:function(a){for(var b=0;b<this.elements.length;b++)if(this.elements[b]==a)return!0;return!1},removeClassName:function(a){return this.replaceClassName(a,"","ig")},replaceClassName:function(a,b,c){if(this.elements&&null!=a&&""!=a){a=RegExp("(^|\\s)"+a+"(?![\\w\\-])",c);null==b&&(b="");for(c=0;c<this.elements.length;c++)null!=
this.elements[c].className&&(this.elements[c].className=this.elements[c].className.replace(a,b))}return this},addClassName:function(a){if(this.elements&&null!=a&&""!=a)for(var b=RegExp("(^|\\s)"+a+"(?![\\w\\-])"),c=0;c<this.elements.length;c++)null==this.elements[c].className||""==this.elements[c].className?this.elements[c].className=a:-1==this.elements[c].className.search(b)&&(this.elements[c].className+=" "+a);return this},addEventListener:function(a,b,c){null==c&&(c=!1);if(this.elements)for(var d=
0;d<this.elements.length;d++)"function"==typeof this.elements[d].addEventListener?this.elements[d].addEventListener(a,b,c):"object"==typeof this.elements[d].attachEvent&&this.elements[d].attachEvent("on"+a,b);return b},removeEventListener:function(a,b,c){if(this.elements)for(var d=0;d<this.elements.length;d++)"function"==typeof this.elements[d].removeEventListener?this.elements[d].removeEventListener(a,b,c):this.elements[d].detachEvent&&this.elements[d].detachEvent("on"+a,b)},stopPropagation:function(a){a.stopPropagation?
a.stopPropagation():event.cancelBubble=!0},preventDefault:function(a){a.preventDefault?a.preventDefault():event.returnValue=!1}};var Taketori=function(){};
Taketori.prototype={isMSIE:-1!=navigator.appVersion.search(/MSIE/)?document.documentMode?document.documentMode:5:0,isWritingModeReady:-1!=navigator.appVersion.search(/MSIE/)||"undefined"!=typeof document.createElement("div").style.MozWritingMode||"undefined"!=typeof document.createElement("div").style.webkitWritingMode&&(!window.devicePixelRatio||2>window.devicePixelRatio||-1==navigator.userAgent.search(/Chrome\/([0-9]+)/)||30<parseInt(RegExp.$1))||"undefined"!=typeof document.createElement("div").style.OWritingMode?
!0:!1,isMultiColumnReady:"undefined"!=typeof document.createElement("div").style.MozColumnWidth||"undefined"!=typeof document.createElement("div").style.webkitColumnWidth||"undefined"!=typeof document.createElement("div").style.webkitWritingMode&&"undefined"!=typeof document.createElement("div").style.webkitColumnWidth||"undefined"!=typeof document.createElement("div").style.OColumnWidth||"undefined"!=typeof document.createElement("div").style.msColumnWidth||"undefined"!=typeof document.createElement("div").style.columnWidth?
!0:!1,isLegacy:-1!=navigator.appVersion.search(/MSIE/)||"undefined"!=typeof document.createElement("div").style.MozTransform||"undefined"!=typeof document.createElement("div").style.webkitTransform||"undefined"!=typeof document.createElement("div").style.OTransform||"undefined"!=typeof document.createElement("div").style.transform?!1:!0,isTextEmphasisReady:"undefined"!=typeof document.createElement("div").style.MozTextEmphasisStyle||"undefined"!=typeof document.createElement("div").style.webkitTextEmphasisStyle||
"undefined"!=typeof document.createElement("div").style.OTextEmphasisStyle||"undefined"!=typeof document.createElement("div").style.msTextEmphasisStyle||"undefined"!=typeof document.createElement("div").style.textEmphasisStyle?!0:!1,document:new TaketoriTool,importCSS:function(){for(var a=!1,b=document.getElementsByTagName("link"),c=0;c<b.length;c++)null!=b[c].href&&-1!=b[c].href.search(/taketori\.css$/)&&(a=!0);if(a)return!0;if(null==this.config.cssPath||"auto"==this.config.cssPath){a=document.getElementsByTagName("script");
for(c=0;c<a.length;c++)if(null!=a[c].src&&-1!=a[c].src.search(/taketori\.js$/)){this.config.cssPath=a[c].src.replace("taketori.js","");break}}(c=document.getElementsByTagName("head")[0])?(a=document.createElement("link"),a.setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),a.setAttribute("href",this.config.cssPath+"taketori.css"),c.appendChild(a)):document.write('<link rel="stylesheet" type="text/css" href="'+this.config.cssPath+'taketori.css" />')},setTemporaryCSS:function(a){this.temporaryStyle||
(this.temporaryStyle=document.createElement("style"),this.temporaryStyle.setAttribute("type","text/css"),document.getElementsByTagName("head")[0].appendChild(this.temporaryStyle));this.temporaryStyle.appendChild(document.createTextNode(a))},removeTemporaryCSS:function(){this.temporaryStyle&&(document.getElementsByTagName("head")[0].removeChild(this.temporaryStyle),this.temporaryStyle=null)},init:function(){if(!this.windowWidth){var a=this;this.document.element(window).addEventListener("resize",function(){a.resizeTimer&&
clearTimeout(a.resizeTimer);a.resizeTimer=setTimeout(function(){a.refresh()},500)})}this.windowWidth=self.innerWidth?self.innerWidth:null!=document.compatMode&&"BackCompat"!=document.compatMode?self.document.documentElement.clientWidth:self.document.body.clientWidth;this.windowHeight=self.innerHeight?self.innerHeight:null!=document.compatMode&&"BackCompat"!=document.compatMode?self.document.documentElement.clientHeight:self.document.body.clientHeight;if(!this.isMSIE&&null==this.rubyDisabled)if(window.opera)this.rubyDisabled=
!0;else{var b=document.createElement("ruby");this.rubyDisabled="block"==this.getStyle(b).display?!0:!1}},set:function(a){if(this.isLegacy)return this;this.config||(this.config={});null!=a&&this.merge(this.config,a);this.config.lang&&(this.config.lang=this.config.lang.toLowerCase());return this},merge:function(a,b){a||(a={});if(null!=b)for(var c in b)if(null!=b[c])if(b[c].constructor==Array)this.merge(a[c],b[c]);else if("string"==typeof b[c]||"number"==typeof b[c]||"boolean"==typeof b[c])a[c]=b[c];
return a},element:function(a){if(this.isLegacy)return this;1<arguments.length&&(a=Array.prototype.slice.call(arguments));this.config.elements||(this.config.elements=[]);if(a&&a.constructor==Array)for(var b=0;b<a.length;b++)this.config.elements[this.config.elements.length]=a[b];else a&&(this.config.elements[this.config.elements.length]=a);return this},reset:function(a){this.config=null;this.set(a)},japaneseReadableElements:function(a){for(var b=[],c=[],d=document.getElementsByTagName("p"),e=0;e<d.length;e++)c[c.length]=
d[e];d=document.getElementsByTagName("br");for(e=0;e<d.length;e++)c[c.length]=d[e];for(e=0;e<c.length;e++)if(d=this.lookUpBlockElements(c[e],b),null!=d&&!this.isCountedElement(b,d)){var h=0;d.innerHTML.replace(/\u3002/g,function(){h++}).replace(/\u3001/g,function(){h+=0.5});b[b.length]={element:d,readabilityScore:h}}if(0<b.length){b=b.sort(function(a,b){return b.readabilityScore-a.readabilityScore});c=[];for(e=0;e<b.length;e++)if(!this.isVerticalTextElement(b[e].element)&&(!a||a<b[e].readabilityScore))c[c.length]=
b[e].element;return c}return[document.body]},isVerticalTextElement:function(a){a=this.getStyle(a);return-1!=navigator.appVersion.search(/MSIE/)&&"string"==typeof a.writingMode&&("tb-rl"==a.writingMode.toLowerCase()||"vertical-rl"==a.writingMode.toLowerCase())||"string"==typeof a.MozWritingMode&&"vertical-rl"==a.MozWritingMode.toLowerCase()||"string"==typeof a.webkitWritingMode&&"vertical-rl"==a.webkitWritingMode.toLowerCase()||"string"==typeof a.OWritingMode&&"vertical-rl"==a.OWritingMode.toLowerCase()||
"string"==typeof a.writingMode&&"vertical-rl"==a.writingMode.toLowerCase()?!0:!1},isCountedElement:function(a,b){for(var c=0;c<a.length;c++)if(a[c].element==b)return!0;return!1},lookUpBlockElements:function(a){for(var b=null;a;){var c=a.tagName.toLowerCase();if("div"==c||"td"==c||"th"==c||"dd"==c||"section"==c||"article"==c||"body"==c){if(a.taketori||!b)b=a;if("body"==c)break}a=a.parentNode}return b},isIncludedIn:function(a,b){if(a&&a.constructor==Array)for(var c=0;c<a.length;c++)if(a[c]==b)return!0;
return!1},escapeHTML:function(a){var b=document.createElement("div"),a=document.createTextNode(a);b.appendChild(a);return b.innerHTML},unescapeHTML:function(a){return null==a?"":a.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},getCookie:function(a){for(var b=[],c=document.cookie.split(/;\s*/),d=0;d<c.length;d++)if(""!=c[d]){var e=c[d].indexOf("=");if(0<=e){var h=c[d].substring(0,e),e=c[d].substring(e+1,c[d].length);b[h]=e}}return null!=a&&null!=b[a]?b[a]:""},
setCookie:function(a,b,c){c||(this.config.cookieExpires?c=this.config.cookieExpires:(c=new Date,c.setTime(c.getTime()+864E8)));document.cookie=a+"="+b+"; expires="+c.toGMTString()+";"+(null!=this.config.cookieDomain&&""!=this.config.cookieDomain?" domain="+this.config.cookieDomain+";":"")+(null!=this.config.cookiePath&&""!=this.config.cookiePath?" path="+this.config.cookiePath:"")},deleteCookie:function(a){this.setCookie(a,"",new Date(70,0,1,0,0,1))},setOnLoad:function(a){if(this.isLegacy)return this;
"function"==typeof window.addEventListener?window.addEventListener("load",a,!1):"object"==typeof window.attachEvent&&window.attachEvent("onload",!this.isMultiColumnReady?function(){setTimeout(a,600)}:a);return this},getStyle:function(a){if(a.currentStyle)return a.currentStyle;var b=document.defaultView.getComputedStyle(a,null),c=document.createElement("div");if(b.length){for(var d=0;d<b.length;d++)c.style.setProperty(b[d],b.getPropertyValue(b[d]),"");for(d=0;d<a.style.length;d++)c.style.setProperty(a.style[d],
a.style.getPropertyValue(a.style[d]),"")}else c.style.cssText=b.cssText+a.style.cssText;return c.style},counterClockwiseRotatedOuterHTML:function(a,b,c){var d,e="inline"!=b.display||b.cssFloat&&"none"!=b.cssFloat||b.styleFloat&&"none"!=b.styleFloat?!0:!1,h=!1;b||(b=this.getStyle(a));d=c?document.createElement("div"):a.cloneNode(!0);this.isWritingModeReady&&c&&(b.width&&-1!=b.width.search(/\d+\.?\d*(px|em)/i)&&0<parseInt(b.width)&&b.height&&-1!=b.height.search(/\d+\.?\d*(px|em)/i)&&0<parseInt(b.height)?
a.currentStyle||b.cssFloat&&"none"!=b.cssFloat||"inline-block"==b.display?h=!0:(d.style.width="auto",d.style.height="auto"):b.width&&-1!=b.width.search(/\d+\.?\d*%/)||b.height&&-1!=b.height.search(/\d+\.?\d*%/)?(d.style.width=b.height&&-1!=b.height.search(/\d+\.?\d*%/)?b.height:"auto",d.style.height=b.width&&-1!=b.width.search(/\d+\.?\d*%/)?b.width:"auto"):("0px"==b.width&&(d.style.width="auto"),"0px"==b.height&&(d.style.height="auto")));if(!this.isWritingModeReady||h||this.isWritingModeReady&&!c){var j=
0,k=0,m=!1;this.isWritingModeReady?(j=this.getMarginSize([b.paddingLeft,b.paddingRight,b.borderLeftWidth,b.borderRightWidth]),k=this.getMarginSize([b.paddingTop,b.paddingBottom,b.borderTopWidth,b.borderBottomWidth]),m=!0):(j=this.getMarginSize([b.paddingTop,b.paddingBottom,b.borderTopWidth,b.borderBottomWidth]),k=this.getMarginSize([b.paddingLeft,b.paddingRight,b.borderLeftWidth,b.borderRightWidth]));var i=!isNaN(parseInt(b.width))&&0<parseInt(b.width)?parseInt(b.width):a.width?a.width:a.offsetWidth?
a.offsetWidth-(m?j:k):null,l=!isNaN(parseInt(b.height))&&0<parseInt(b.height)?parseInt(b.height):a.height?a.height:a.offsetHeight?a.offsetHeight-(m?k:j):null,n=!1;if(!i||!l)this.makeClipboard(this.process.target,!0),this.clipboard.appendChild(d),i=d.offsetWidth?d.offsetWidth-(m?j:k):d.clientWidth,l=d.offsetHeight?d.offsetHeight-(m?k:j):d.clientHeight,this.clipboard.removeChild(d);if(!isNaN(i)&&!isNaN(l)&&(i+=j,l+=k,l>this.process.config.height&&(i=parseInt(i*this.process.config.height/l),l=this.process.config.height,
n=!0),i>this.process.config.width&&(l=parseInt(l*this.process.config.width/i),i=this.process.config.width,n=!0),n||h))j=i-j,k=l-k,h?(a.currentStyle||"inline-block"==b.display?(d.width=k,d.style.width=k+"px"):d.style.width="auto",d.height=j,d.style.height=j+"px"):(d.width=j,d.height=k,d.style.width=j+"px",d.style.height=k+"px",n&&e&&(d.style.overflow="auto"))}d.style.borderTopWidth=b.borderLeftWidth||0;d.style.borderRightWidth=b.borderTopWidth||0;d.style.borderBottomWidth=b.borderRightWidth||0;d.style.borderLeftWidth=
b.borderBottomWidth||0;d.style.borderTopColor=b.borderLeftColor||"";d.style.borderRightColor=b.borderTopColor||"";d.style.borderBottomColor=b.borderRightColor||"";d.style.borderLeftColor=b.borderBottomColor||"";d.style.borderTopStyle=b.borderLeftStyle||"none";d.style.borderRightStyle=b.borderTopStyle||"none";d.style.borderBottomStyle=b.borderRightStyle||"none";d.style.borderLeftStyle=b.borderBottomStyle||"none";if(e||!c||this.isWritingModeReady&&(!this.isMSIE||8>this.isMSIE))d.style.paddingTop=b.paddingLeft||
0,d.style.paddingRight=b.paddingTop||0,d.style.paddingBottom=b.paddingRight||0,d.style.paddingLeft=b.paddingBottom||0;if(this.isWritingModeReady){if(e&&c&&(d.style.overflowX=b.overflowY?b.overflowY:"visible",d.style.overflowY=b.overflowX?b.overflowX:"visible"),b.backgroundPositionX||b.backgroundPositionY?(d.style.backgroundPositionX=b.backgroundPositionY?"top"==b.backgroundPositionY?"left":"bottom"==b.backgroundPositionY?"right":b.backgroundPositionY:"50%",d.style.backgroundPositionY=b.backgroundPositionX?
"left"==b.backgroundPositionX?"top":"right"==b.backgroundPositionX?"bottom":b.backgroundPositionX:"50%"):b.backgroundPosition&&-1!=b.backgroundPosition.search(/(\S+)\s+(\S)/)&&(d.style.backgroundPosition=RegExp.$2+" "+RegExp.$1+";"),e||!c||!this.isMSIE||8>this.isMSIE)d.style.marginTop=b.marginLeft||0,d.style.marginRight=b.marginTop||0,d.style.marginBottom=b.marginRight||0,d.style.marginLeft=b.marginBottom||0}else d.style.marginTop=parseInt((b.marginTop&&"auto"!=b.marginTop?parseInt(b.marginTop):0)+
(i-l)/2)+"px",d.style.marginRight=parseInt((b.marginRight&&"auto"!=b.marginRight?parseInt(b.marginRight):0)+(l-i)/2)+"px",d.style.marginBottom=parseInt((b.marginBottom&&"auto"!=b.marginBottom?parseInt(b.marginBottom):0)+(i-l)/2)+"px",d.style.marginLeft=parseInt((b.marginLeft&&"auto"!=b.marginLeft?parseInt(b.marginLeft):0)+(l-i)/2)+"px",b.backgroundPosition&&-1!=b.backgroundPosition.search(/(\S+)\s+(\S)/)&&(d.style.backgroundPosition=RegExp.$2+" "+RegExp.$1+";");return c?d.style.cssText+";"+a.style.cssText:
this.outerHTML(d)},outerHTML:function(a){if(!a)return"";var b=document.createElement("div");b.appendChild(a.cloneNode(!0));return b.innerHTML},rotatedBlockAdditionalCSSText:function(a,b,c,d){null==c&&(c=0);return this.isWritingModeReady?"width:"+b+"px;height:"+a+"px;"+(c?(!d?"padding-bottom:":"margin-bottom:")+c+"px;":"")+(!d?"position:relative;overflow:auto;overflow-x:visible;overflow-y:visible;":""):"width:"+a+"px;height:"+b+"px;margin-top:-"+b+"px;margin-right:"+(b-a-c)+"px;margin-bottom:"+(a+
c)+"px;margin-left:0;"+(!d?"padding-right:"+c+"px;overflow:auto;overflow-x:visible;overflow-y:visible;":"")},toVertical:function(a){if(this.isLegacy)return this;var b=this;if(null==a||a)this.setOnLoad(function(){b.toVertical(!1)});else{this.importCSS();var c=!1,d=!1;if(!this.targetElements)if(!this.config.elements||"=auto"==this.config.elements[0])this.targetElements=this.japaneseReadableElements(null==this.config.minScore?3:this.config.minScore),this.config.togglable=!1,c=!0;else if("=dblclick"==
this.config.elements[0])d=c=!0;else{var e=this.document.element(this.config.elements).list();this.targetElements=[];for(a=0;a<e.length;a++)this.isVerticalTextElement(e[a])||(this.targetElements[this.targetElements.length]=e[a])}if(c&&(this.toggleEventAttached||(this.document.element(document.body).addEventListener("dblclick",function(a){b.toggle(b.lookUpBlockElements(a.target||event.target||event.srcElement));b.document.stopPropagation(a);b.document.preventDefault(a)}),this.toggleEventAttached=!0),
d))return a=navigator.browserLanguage||navigator.language||navigator.userLanguage,a=-1!=a.search(/tw/i)?"zh-tw":-1!=a.search(/(zh|cn)/i)?"zh-cn":-1!=a.search(/(ko|kr)/i)?"ko-kr":"ja-jp",alert(TaketoriDblClickAlert[a]),this;null==this.ttbDisabled&&(this.ttbDisabled="true"==this.getCookie("TTB_DISABLED")?!0:!1);if(this.config.togglable){this.config.cookieDomain||(this.config.cookieDomain=document.domain);this.config.cookiePath||(this.config.cookiePath="/");for(a=0;a<this.targetElements.length;a++)c=
this.targetElements[a],c.taketori||(c.taketori={}),c.taketori.toggleEventAttached||(this.document.element(c).addEventListener("dblclick",function(a){b.document.stopPropagation(a);b.document.preventDefault(a);b.ttbDisabled?(b.deleteCookie("TTB_DISABLED"),b.ttbDisabled=!1):(b.setCookie("TTB_DISABLED","true"),b.ttbDisabled=!0);b.toVertical(!1)}),c.taketori.toggleEventAttached=!0),this.toggle(c,this.ttbDisabled,!0)}else if(!this.ttbDisabled)for(a=0;a<this.targetElements.length;a++)this.make(this.targetElements[a])}return this},
configClone:function(a){if(!a)return{};for(var b={},c="width height fontFamily maxHeight multiColumnEnabled gap contentWidth contentHeight onbreak classNameImported lang".split(" "),d=0;d<c.length;d++)null!=a[c[d]]&&(b[c[d]]=a[c[d]]);return b},toggleAll:function(){if(this.isLegacy)return this;this.config.cookieDomain||(this.config.cookieDomain=document.domain);this.config.cookiePath||(this.config.cookiePath="/");this.ttbDisabled?(this.deleteCookie("TTB_DISABLED"),this.ttbDisabled=!1):(this.setCookie("TTB_DISABLED",
"true"),this.ttbDisabled=!0);for(var a=0;a<this.targetElements.length;a++)this.toggle(this.targetElements[a],this.ttbDisabled,!0);return this},clearAll:function(){if(this.isLegacy)return this;this.config.cookieDomain||(this.config.cookieDomain=document.domain);this.config.cookiePath||(this.config.cookiePath="/");this.ttbDisabled||(this.setCookie("TTB_DISABLED","true"),this.ttbDisabled=!0);for(var a=0;a<this.targetElements.length;a++)this.toggle(this.targetElements[a],!0,!0,!0);return this},appendTarget:function(a){this.isVerticalTextElement(a)||
(this.targetElements?this.isIncludedIn(this.targetElements,a)||(this.targetElements[this.targetElements.length]=a):this.targetElements=Array(a))},removeTarget:function(a){if(this.targetElements){for(var b=[],c=0;c<this.targetElements.length;c++)this.targetElements[c]!=a&&(b[b.length]=this.targetElements[c]);this.targetElements=b}},makeClipboard:function(a,b){if(b||this.process.isBreakable)if(this.clipboard&&this.clipboard.parentNode!=a&&this.removeClipboard(),!this.clipboard){this.clipboard=document.createElement("div");
this.clipboard.style.position="absolute";a.appendChild(this.clipboard);var c=this.windowWidth>this.windowHeight?this.windowWidth:this.windowHeight;this.clipboard.style.top="-"+(c+100)+"px";this.clipboard.style.left="-"+(c+100)+"px";this.clipboard.style.width=c+"px";this.clipboard.style.height=c+"px";this.clipboard.style.overflow="auto"}},removeClipboard:function(){this.temporaryContent&&this.temporaryContent.parentNode.removeChild(this.temporaryContent);this.clipboard&&this.clipboard.parentNode.removeChild(this.clipboard);
this.temporaryContent=this.clipboard=null},toPx:function(a,b,c,d){return!a?0:c?-1!=a.search(/(\d+\.\d+)/)?parseInt(RegExp.$1*b):parseInt(1.5*b):-1!=a.search(/\d+\.?\d*em/i)?parseInt(parseFloat(a)*b):-1!=a.search(/\d+\.?\d*%/)?parseInt(parseFloat(a)*(d?d:b)/100):-1!=a.search(/\d/)?parseInt(a):a},getFontSize:function(a){if(!isNaN(a)||-1!=a.search(/\d+px/))return parseInt(a);var b=this.getStyle(document.body).fontSize,b=-1!=b.search(/\d+\.?\d*(em|%)/)?this.toPx(b,16):parseInt(b),a=this.toPx(a,b);return 0<
a?a:16},setCurrentConfig:function(a,b){b||(b=this.configClone(this.config));if(!b.classNameImported){var c=a.className;if(c)for(var d="width height fontFamily maxHeight multiColumnEnabled gap contentWidth contentHeight lang".split(" "),e=0;e<d.length;e++)-1!=c.search(RegExp("(^|\\s)taketori-"+d[e]+"-([\\w\\.\\-\\%]+)(?![\\w\\-])","i"))&&(b[d[e]]=RegExp.$2);b.classNameImported=!0}b.lang=b.lang?b.lang.toLowerCase():TaketoriDefaultLang;this.init();d=this.getStyle(a);c=this.getFontSize(d.fontSize);this.process=
{target:a,done:!1,isMultiColumnEnabled:!1,noCJK:0,latin:0,width:0,columnCount:0,openTagsHTML:"",listStart:[],listStyleType:[],currentStyle:{},openTags:[],closeTags:[],columnHTML:"",content:"",config:{}};if("boolean"==typeof b.multiColumnEnabled&&b.multiColumnEnabled||this.isMultiColumnReady&&b.multiColumnEnabled&&"auto"==b.multiColumnEnabled)this.process.config.multiColumnEnabled=!0;this.isMultiColumnReady&&this.process.config.multiColumnEnabled&&(this.process.isMultiColumnEnabled=!0);if(!this.isMultiColumnReady&&
this.process.config.multiColumnEnabled||b.contentHeight&&b.contentWidth)this.process.isBreakable=!0;d=this.getElementWidth(a,d);b.contentWidth&&(this.process.config.contentWidth=this.toPx(b.contentWidth,c,!1,d));b.contentHeight&&(this.process.config.contentHeight=this.toPx(b.contentHeight,c,!1,d));this.process.config.width=b.width?this.toPx(b.width,c,!1,d):null!=this.process.config.contentWidth?this.process.config.contentWidth:d;this.process.config.gap=null!=b.gap?this.toPx(b.gap,c):2*c;null==b.height?
(b.maxHeight||(b.maxHeight="36em"),d=this.toPx(b.maxHeight,c),c=this.process.config.contentHeight?this.process.config.contentHeight:this.windowHeight,this.process.config.multiColumnEnabled?(d=Math.ceil(c/(d+this.process.config.gap)),this.process.config.height=parseInt((c-40)/d)-this.process.config.gap,this.process.config.contentHeight&&(this.process.config.columnCount=d)):(c=c-this.process.config.gap-18,this.process.config.height=c>d?d:c)):this.process.config.contentHeight&&this.process.config.multiColumnEnabled?
(c=this.toPx(b.height,c),this.process.config.columnCount=Math.ceil(this.process.config.contentHeight/(c+this.process.config.gap)),this.process.config.height=parseInt((this.process.config.contentHeight+this.process.config.gap)/this.process.config.columnCount)-this.process.config.gap):this.process.config.height=b.height&&"width"==b.height?this.process.config.width:this.process.config.multiColumnEnabled?this.toPx(b.height,c):this.process.config.contentHeight||this.toPx(b.height,c);this.process.currentConfig=
b;return this},getElementWidth:function(a,b){return(a.offsetWidth?a.offsetWidth:a.scrollWidth)-this.getMarginSize([b.paddingLeft,b.paddingRight,b.borderLeftWidth,b.borderRightWidth])},getMarginSize:function(a){for(var b=0,c=0;c<a.length;c++)a[c]&&!isNaN(parseInt(a[c]))&&(b+=parseInt(a[c]));return b},getWidth:function(a){this.setTaketoriClassName(this.clipboard);this.temporaryContent||(this.temporaryContent=document.createElement("div"),this.setTemporaryContentStyle(),this.clipboard.appendChild(this.temporaryContent));
this.temporaryContent.innerHTML=a;this.process.width=this.getTemporaryContentWidth();this.clipboard.className="";return this.process.width},setTemporaryContentStyle:function(){this.temporaryContent.className="taketori-col";this.isWritingModeReady?(this.temporaryContent.style.height=this.process.config.height+"px",this.temporaryContent.style.width="16px"):(this.temporaryContent.style.overflow="auto",this.temporaryContent.style.width=this.process.config.height+"px")},getTemporaryContentWidth:function(){return this.isWritingModeReady?
this.temporaryContent.scrollWidth||this.temporaryContent.clientWidth||this.temporaryContent.offsetWidth:this.temporaryContent.scrollHeight||this.temporaryContent.clientHeight||this.temporaryContent.offsetHeight},hasToBreak:function(a){this.temporaryContent||(this.temporaryContent=document.createElement("div"),this.clipboard.appendChild(this.temporaryContent));var b=0,b=!1;this.temporaryContent.className="taketori-col";this.temporaryContent.style.overflow="auto";this.setTaketoriClassName(this.clipboard);
if(this.process.config.columnCount&&1<this.process.config.columnCount){var c=this.process.config.width*this.process.config.columnCount;this.process.width+50<c&&(this.setTemporaryContentStyle(),this.temporaryContent.innerHTML=a,this.process.width=this.getTemporaryContentWidth());this.process.width+50>=c&&(b=this.getMultiColumnWidth(a),b=b>this.process.config.contentHeight?!0:!1)}else this.isWritingModeReady?(this.temporaryContent.style.height=this.process.config.contentHeight+"px",this.temporaryContent.innerHTML=
a,this.process.width=this.temporaryContent.scrollWidth||this.temporaryContent.clientWidth||this.temporaryContent.offsetWidth):(this.temporaryContent.style.width=this.process.config.contentHeight+"px",this.temporaryContent.innerHTML=a,this.process.width=this.temporaryContent.scrollHeight||this.temporaryContent.clientHeight||this.temporaryContent.offsetHeight),b=this.process.width>this.process.config.contentWidth?!0:!1;this.clipboard.className="";return b},getMultiColumnWidth:function(a){this.temporaryContent||
(this.temporaryContent=document.createElement("div"),this.clipboard.appendChild(this.temporaryContent));var b=0;this.setTaketoriClassName(this.clipboard);this.setMultiColumnStyle(this.temporaryContent);this.temporaryContent.innerHTML=a;b=this.isWritingModeReady?this.getTotalHeight(this.temporaryContent):this.getTotalWidth(this.temporaryContent);this.clipboard.className="";return b},setMultiColumnStyle:function(a){a.className="taketori-col taketori-multi-column";a.style.overflow="auto";this.isWritingModeReady?
(a.style.width=this.process.config.width+"px",a.style.height=this.process.config.height+"px"):(a.style.width=this.process.config.height+"px",a.style.height=this.process.config.width+"px");a.style.MozColumnWidth=this.process.config.height+"px";a.style.webkitColumnWidth=this.process.config.height+"px";a.style.OColumnWidth=this.process.config.height+"px";a.style.columnWidth=this.process.config.height+"px";a.style.MozColumnGap=this.process.config.gap+"px";a.style.webkitColumnGap=this.process.config.gap+
"px";a.style.OColumnGap=this.process.config.gap+"px";a.style.columnGap=this.process.config.gap+"px"},setMultiColumnWidth:function(a){if(this.isWritingModeReady){var b=this.getTotalHeight(a);a.style.height=b+"px";a.style.overflow="visible";this.fixMargin(a,this.process.config.width,b)}else b=this.getTotalWidth(a),a.style.width=b+"px",a.style.overflow="visible",this.fixMargin(a,b,this.process.config.width)},getTotalWidth:function(a){return Math.ceil((a.scrollWidth||a.clientWidth||a.offsetWidth)/(this.process.config.height+
this.process.config.gap))*(this.process.config.height+this.process.config.gap)-this.process.config.gap},getTotalHeight:function(a){return Math.ceil((a.scrollHeight||a.clientHeight||a.offsetHeight)/(this.process.config.height+this.process.config.gap))*(this.process.config.height+this.process.config.gap)-this.process.config.gap},setTaketoriClassName:function(a){var b=this.isWritingModeReady?"taketori-writingmode-ttb":"taketori-ttb";this.rubyDisabled&&(b+=" taketori-ruby-disabled");this.isTextEmphasisReady||
(b+=" taketori-text-emphasis-disabled");b+=(this.isWritingModeReady&&-1!=navigator.userAgent.search(/WebKit/i)&&-1!=navigator.userAgent.search(/Windows/i)?" taketori-atsign":!this.process.currentConfig.fontFamily?" taketori-serif":"sans-serif"==this.process.currentConfig.fontFamily?" taketori-sans-serif":"cursive"==this.process.currentConfig.fontFamily?" taketori-cursive":"kai"==this.process.currentConfig.fontFamily?" taketori-kai":" taketori-serif")+"-"+this.process.currentConfig.lang;b+=" taketori-lang-"+
this.process.currentConfig.lang;a.className+=(a.className?" ":"")+b},removeTaketoriClassName:function(a){this.document.element(a).removeClassName("taketori-ttb").removeClassName("taketori-writingmode-ttb").removeClassName("taketori-ruby-disabled").removeClassName("taketori-(lang|serif|sans-serif|cursive|kai)[\\w\\-]*")},make:function(a,b){b||this.setCurrentConfig(a);this.makeClipboard(a);this.parse(a,!0);this.complement(a);this.removeClipboard()},isSkipClass:function(a){if(this.config.skipClass&&
a.className)for(a=0;a<this.config.skipClass.length;a++)if(-1!=this.elements.className.search(RegExp("(^|\\s)"+this.config.skipClass[a]+"(?![\\w\\-])")))return!0;return!1},isSkipId:function(a){return this.config.skipId&&a.id&&this.isIncludedIn(this.config.skipId,thisNode.id)?!0:!1},parse:function(a,b){if(a!=this.clipboard){a.taketori&&a.taketori.ttb&&this.toggle(a,!0,!0);var c=a.nodeName.toLowerCase(),d="",e="",h="",j="",k="",m="",m=!1,i=a.nodeType,l=null,n=!1,q=a.hasChildNodes&&a.hasChildNodes();
switch(i){case 1:i=this.getStyle(a);if(this.process.isBreakable){var s=this.getFontSize(i.fontSize);this.process.lineHeight=this.toPx(i.lineHeight,s,!0);this.process.lineLength||(this.process.lineLength=this.process.config.height);if(!b&&"block"==i.display){var I=this.process.lineLength;this.process.lineLength-=this.getMarginSize([i.marginTop,i.marginBottom,i.paddingTop,i.paddingBottom,i.borderTopWidth,i.borderBottomWidth]);this.process.lineLength<s&&(this.process.lineLength=s)}this.process.roughFormula=
s*this.process.lineHeight/this.process.lineLength}if(!b){if(this.isIncludedIn("img object embed video audio textarea".split(" "),c)){this.appendHTML(this.counterClockwiseRotatedOuterHTML(a,i));break}else if(this.isSkipClass(a)||this.isSkipId(a)){this.appendHTML(this.counterClockwiseRotatedOuterHTML(a,i));break}else if(this.isIncludedIn("link meta base script style map".split(" "),c)){this.process.columnHTML+=this.outerHTML(a);break}else if("!"==c)break;else if(this.isIncludedIn(["br","input","select",
"option"],c)||this.isMSIE&&8>this.isMSIE&&"table"==c){this.appendHTML(this.outerHTML(a));break}for(var s=a.attributes,v=!1,L=!1,G=0;G<s.length;G++){var O=s[G],H=O.nodeName.toLowerCase(),P="string"==typeof O.nodeValue||"number"==typeof O.nodeValue?this.escapeHTML(O.nodeValue):"style"==H&&null!=a.style.cssText?a.style.cssText.replace(/[\w\-]+:/g,function(a){return a.toLowerCase()}):"class"==H&&null!=a.className?a.className:null;if(O.specified&&P&&!this.isIncludedIn(this.stripAttributes,H)){switch(H){case "style":j=
P;P="";break;case "class":k+=(k?" ":"")+P;-1!=P.search(/(^|\s)ltr(?![\w\-])/)&&(this.process.ltr||(v=!0),this.process.ltr=!0);P="";break;case "dir":-1!=P.search(/(^|\s)ltr(?![\w\-])/)&&(this.process.ltr||(v=!0),this.process.ltr=!0),k+=(k?" ":"")+P}null!=P&&""!=P&&(h+=" "+H+'="'+P+'"')}}v?j+=this.counterClockwiseRotatedOuterHTML(a,i,!0):this.isWritingModeReady&&!this.isIncludedIn("table caption thead tbody tr td th tfoot".split(" "),c)&&(j+=this.counterClockwiseRotatedOuterHTML(a,i,!0));if(!this.process.ltr&&
(!this.isMSIE||7<this.isMSIE)){"li"==c&&(this.process.listStyleType&&""!=this.process.listStyleType[this.process.listStyleType.length-1])&&(h+=' data-marker="'+this.getListMarkerText()+'"');if("ul"==c||"ol"==c)m=!0,this.process.listStart[this.process.listStart.length]=0,s=i.listStyleType.toLowerCase(),this.isIncludedIn(["none","disc","circle","square"],s)?this.process.listStyleType[this.process.listStyleType.length]="":(this.process.listStyleType[this.process.listStyleType.length]=s,k+=(k?" ":"")+
"cjk");this.isWritingModeReady&&"strong"==c&&(this.isTextEmphasisReady||(this.process.kenten||(L=!0),this.process.kenten=!0),k+=(k?" ":"")+"bo-ten");!this.isWritingModeReady&&(i.fontStyle&&"italic"==i.fontStyle.toLowerCase()&&q)&&(k+=(k?" ":"")+"italic");i.textDecoration&&q&&(s=i.textDecoration.toLowerCase(),"none"!=s&&(-1!=s.search(/underline/i)&&-1!=s.search(/overline/i)?(k+=(k?" ":"")+"bothline",l=this.lineMarginHeight(i)):-1!=s.search(/underline/i)?(k+=(k?" ":"")+"underline",l=this.lineMarginHeight(i)):
-1!=s.search(/overline/i)&&(k+=(k?" ":"")+"overline",l=this.lineMarginHeight(i)),!this.isWritingModeReady&&l&&(this.process.lineMarginHeight||(n=!0),this.process.lineMarginHeight=l)))}k&&(h+=' class="'+k+'"');j&&(h+=' style="'+j+'"');b||(d+="<"+c+h)}if(q){b||(this.process.columnHTML+=d+">",m&&(d+=' start=""'),e="</"+c+">",this.process.openTags[this.process.openTags.length]=d+">",this.process.closeTags[this.process.closeTags.length]=c);for(G=0;G<a.childNodes.length;G++)this.parse(a.childNodes[G]);
b||(this.process.columnHTML+=e,this.process.openTags.pop(),this.process.closeTags.pop(),v&&(this.process.ltr=null),L&&(this.process.kenten=null),n&&(this.process.lineMarginHeight=null),m&&(this.process.listStart.pop(),this.process.listStyleType.pop()))}else b||(d+="></"+c+">",this.process.columnHTML+=d);I&&(this.process.lineLength=I);break;case 3:var m=this.escapeHTML(a.nodeValue),m=m.replace(/\uFF0F\uFF3C/g,"\u3033\u3035").replace(/\uFF3C\uFF0F/g,"\u3033\u3035").replace(/\uFF0F\u0022\uFF3C/g,"\u3034\u3035").replace(/\uFF3C\u0022\uFF0F/g,
"\u3034\u3035"),D=this,U=0;m.replace(/&#?\w+;|\s+|./g,function(a){if(-1!=a.search(/^[\u1100-\u11FF\u2030-\u217F\u2460-\u24FF\u2600-\u261B\u2620-\u277F\u2E80-\u2FDF\u2FF0-\u4DBF\u4E00-\u9FFF\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF\uF900-\uFAFF\uFE30-\uFE4F\uFF00\uFF01\uFF03-\uFF06\uFF08-\uFF0C\uFF0E-\uFF1B\uFF1F-\uFF3D\uFF40-\uFF5B\uFF5D-\uFFEF]$/)){D.setCJK();if((!D.isWritingModeReady||D.process.kenten)&&!D.process.ltr)a=D.kinsokuShori("<span"+(!D.process.ltr?' class="'+D.getCJKClassName(a)+'"':"")+
(!D.process.ltr&&D.process.lineMarginHeight?' style="margin-top:'+D.process.lineMarginHeight+"px;margin-bottom:"+D.process.lineMarginHeight+'px;"':"")+">"+a+"</span>");U++}else-1!=a.search(/^\s+$/)?0<U&&(U+=0.5):(-1!=a.search(/^[0-9a-zA-Z]$/)?(U+=0.5,D.process.latin++):(U++,D.process.latin=0),0==D.process.noCJK&&(a='<span class="nocjk notcy">'+a),this.isTextEmphasisReady||D.process.noCJK++);!D.process.isBreakable||1<U&&D.isNoBreak(D.process.width+U*D.process.roughFormula+D.process.lineHeight)?D.process.columnHTML+=
a:(U=1,D.appendHTML(a))});this.setCJK()}}},isNoBreak:function(a){return this.isWritingModeReady||!this.process.isMultiColumnEnabled?a<this.process.config.width?!0:!1:this.process.config.contentHeight&&this.process.config.contentWidth?this.process.config.columnCount&&1<this.process.config.columnCount?a+50<this.process.config.width*this.process.config.columnCount?!0:!1:a<this.process.config.contentHeight?!0:!1:!0},setCJK:function(){0<this.process.noCJK&&(this.process.columnHTML=(this.process.noCJK==
this.process.latin&&2>=this.process.latin?this.process.columnHTML.replace('<span class="nocjk notcy">','<span class="tcy">'):this.process.columnHTML.replace('<span class="nocjk notcy">','<span class="nocjk">'))+"</span>");this.process.latin=this.process.noCJK=0},lineMarginHeight:function(a){var b=a.lineHeight,a=this.getFontSize(a.fontSize);return-1!=b.search(/\d+px/)?parseInt((parseInt(b)-a)/2):parseInt((parseFloat(b)*a-a)/2)},getListMarkerText:function(){var a=++this.process.listStart[this.process.listStart.length-
1],b=this.process.listStyleType[this.process.listStyleType.length-1];return"A"==b||"\u30a2"==b||"upper-latin"==b||"katakana"==b?(b="\u30a2\u30a2\u30a4\u30a6\u30a8\u30aa\u30ab\u30ad\u30af\u30b1\u30b3\u30b5\u30b7\u30b9\u30bb\u30bd\u30bf\u30c1\u30c4\u30c6\u30c8\u30ca\u30cb\u30cc\u30cd\u30ce\u30cf\u30d2\u30d5\u30d8\u30db\u30de\u30df\u30e0\u30e1\u30e2\u30e4\u30e6\u30e8\u30e9\u30ea\u30eb\u30ec\u30ed\u30ef\u30f0\u30f1\u30f2\u30f3".split(""),"("+b[a]+")"):"a"==b||"\u3042"==b||"lower-latin"==b||"hiragana"==
b?(b="\u3042\u3042\u3044\u3046\u3048\u304a\u304b\u304d\u304f\u3051\u3053\u3055\u3057\u3059\u305b\u305d\u305f\u3061\u3064\u3066\u3068\u306a\u306b\u306c\u306d\u306e\u306f\u3072\u3075\u3078\u307b\u307e\u307f\u3080\u3081\u3082\u3084\u3086\u3088\u3089\u308a\u308b\u308c\u308d\u308f\u3090\u3091\u3092\u3093".split(""),"("+b[a]+")"):"\u30a4"==b||"katakana-iroha"==b?(b="\u30a4\u30a4\u30ed\u30cf\u30cb\u30db\u30d8\u30c8\u30c1\u30ea\u30cc\u30eb\u30f2\u30ef\u30ab\u30e8\u30bf\u30ec\u30bd\u30c4\u30cd\u30ca\u30e9\u30e0\u30a6\u30f0\u30ce\u30aa\u30af\u30e4\u30de\u30b1\u30d5\u30b3\u30a8\u30c6\u30a2\u30b5\u30ad\u30e6\u30e1\u30df\u30b7\u30f1\u30d2\u30e2\u30bb\u30b9".split(""),
"("+b[a]+")"):"\u3044"==b||"hiragana-iroha"==b?(b="\u3044\u3044\u308d\u306f\u306b\u307b\u3078\u3068\u3061\u308a\u306c\u308b\u3092\u308f\u304b\u3088\u305f\u308c\u305d\u3064\u306d\u306a\u3089\u3080\u3046\u3090\u306e\u304a\u304f\u3084\u307e\u3051\u3075\u3053\u3048\u3066\u3042\u3055\u304d\u3086\u3081\u307f\u3057\u3091\u3072\u3082\u305b\u3059".split(""),"("+b[a]+")"):"I"==b||"upper-roman"==b?(b="I I II III IV V VI VII VIII IX X XI XII XIII XIV XV XVI XVII XVIII XIX XX".split(" "),"("+b[a]+")"):"i"==b||
"lower-roman"==b?(b="i i ii iii iv v vi vii viii ix x xi xii xiii xiv xv xvi xvii xviii xix xx".split(" "),"("+b[a]+")"):"1"==b||"decimal"==b||"\u4e00"==b||"cjk-ideographic"==b||"\u58f1"==b?10>=a?(b="\u58f1"==b?"\u58f1\u58f1\u5f10\u53c2\u56db\u4f0d\u516d\u4e03\u516b\u4e5d\u62fe".split(""):"\u4e00\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341".split(""),"("+b[a]+")"):"("+a+")":""},appendHTML:function(a,b){var c="";null==a&&(a="");if((b||this.process.isBreakable)&&""!=this.process.columnHTML)if(this.isWritingModeReady&&
!this.isMultiColumnReady||!this.process.isMultiColumnEnabled){if(c=b?this.columnComplement():this.columnComplement(this.process.columnHTML+a),b||this.process.config.width<this.getWidth(c))b||(c=this.columnComplement()),this.process.content+='<div class="taketori-col" style="'+this.rotatedBlockAdditionalCSSText(this.process.config.height,this.process.config.width,this.process.config.gap,this.process.config.multiColumnEnabled)+'">'+c+"</div>",this.process.columnCount++,(b||this.process.config.columnCount&&
this.process.config.columnCount==this.process.columnCount)&&this.containerBreak()}else if(this.process.config.contentHeight&&this.process.config.contentWidth){if(c=b?this.columnComplement():this.columnComplement(this.process.columnHTML+a),b||this.hasToBreak(c))b||(c=this.columnComplement()),this.process.content=this.process.config.columnCount&&1<this.process.config.columnCount?this.process.content+('<div class="taketori-col taketori-multi-column" style="-moz-column-width:'+this.process.config.height+
"px;-webkit-column-width:"+this.process.config.height+"px;column-width:"+this.process.config.height+"px;-moz-column-count:"+this.process.config.columnCount+";-webkit-column-count:"+this.process.config.columnCount+";column-count:"+this.process.config.columnCount+";-moz-column-gap:"+this.process.config.gap+"px;-webkit-column-gap:"+this.process.config.gap+"px;column-gap:"+this.process.config.gap+"px;"+this.rotatedBlockAdditionalCSSText(this.process.config.contentHeight,this.process.config.contentWidth,
0,!0)+'">'+c+"</div>"):this.process.content+('<div class="taketori-col" style="'+this.rotatedBlockAdditionalCSSText(this.process.config.contentHeight,this.process.config.contentWidth)+'">'+c+"</div>"),this.containerBreak()}else b&&(this.process.content=document.createElement("div"),this.setMultiColumnStyle(this.process.content),this.process.content.innerHTML=this.columnComplement(),this.containerBreak(),this.setMultiColumnWidth(this.process.target.firstChild));this.process.columnHTML+=a},columnComplement:function(a){var b=
!1,c="";null==a?(c=this.process.columnHTML+(1<this.process.noCJK?"</span>":""),b=!0):c=a+(this.process.noCJK?"</span>":"");b&&(this.process.columnHTML="",this.process.width=0,this.process.noCJK&&(this.process.noCJK=1),this.process.latin&&(this.process.latin=1));for(var a="",d=this.process.openTagsHTML,e=!0,h=this.process.closeTags.length-1;0<=h;h--){var j=this.process.closeTags[h],k=RegExp("<"+j+"(?!\\w)[^>]*>\\s*$");-1==c.search(k)?a+="</"+j+">":""==a&&(c=c.replace(k,""),"li"==j&&(e=!1))}if(b){this.process.openTagsHTML=
this.process.openTags.join("");e&&(this.process.openTagsHTML=this.process.openTagsHTML.replace(/ data-marker=".*?"/g,""));for(h=0;h<this.process.listStart.length;h++)this.process.openTagsHTML=this.process.openTagsHTML.replace(/ start=""/,'start="'+this.process.listStart[h]+'"')}return d+c+a},getCJKClassName:function(a){if("\u30fc"==a||"\u301c"==a||"\uff5e"==a||"\u2026"==a)return this.process.kinsoku=!0,"cjk cho-on";if("\u3001"==a||"\uff0c"==a)return this.process.kinsoku=!0,"ja-jp"==this.process.currentConfig.lang?
"cjk tou-ten":"cjk";if("\u3002"==a||"\uff0e"==a)return this.process.kinsoku=!0,"ja-jp"==this.process.currentConfig.lang?"cjk ku-ten":"cjk";if(-1!=a.search(/^[\u3041\u3043\u3045\u3047\u3049\u3083\u3085\u3087\u3063\u30A1\u30A3\u30A5\u30A7\u30A9\u30E3\u30E5\u30E7\u30C3]$/))return this.process.kinsoku=!0,"cjk kogaki";if(-1!=a.search(/^[\u3009\u300B\u300D\u300F\u3011\u3015\u3017\u3019\uFF09\uFF5D\uFF60]$/))return this.process.kinsoku=!0,"kakko";if(-1!=a.search(/^[\u3008\u300A\u300C\u300E\u3010\u3014\u3016\u3018\uFF08\uFF5B\uFF5F]$/))return"kakko";
-1!=a.search(/^[\uFF01\uFF1A\uFF1B\uFF1F]$/)&&(this.process.kinsoku=!0);return"cjk"},kinsokuShori:function(a){this.process.kinsoku&&(this.process.columnHTML=this.process.columnHTML.replace(/(<span(?!\w)[^>]*class="cjk"[^>]*>.<\/span>)$/,""),RegExp.$1&&(a='<span class="kinsoku">'+RegExp.$1+a+"</span>"),this.process.kinsoku=null);return a},complement:function(){this.appendHTML("",!0)},containerBreak:function(){if("function"==typeof this.process.config.onbreak)this.process.config.onbreak(this);else this._containerBreak()},
_containerBreak:function(){if(this.process.target){this.removeClipboard();this.process.target.taketori||(this.process.target.taketori={});if(!this.process.config.contentWidth||!this.process.config.contentHeight||!this.process.done){var a=this.process.target.innerHTML;this.setTaketoriClassName(this.process.target);if("object"==typeof this.process.content)this.process.target.innerHTML="",this.process.target.appendChild(this.process.content);else{this.process.target.innerHTML=this.process.content;var b=
this.process.target.firstChild,c=this,d=this.process.config.width,e=this.process.config.gap;setTimeout(function(){if(c.isWritingModeReady)b.clientHeight<b.scrollHeight&&(b.style.height=b.scrollHeight+"px");else if(b.clientWidth<b.scrollWidth){var a=b.scrollWidth;b.style.width=a+"px";c.fixMargin(b,a,d,e,c.process.config.multiColumnEnabled)}},600)}this.process.config.contentWidth&&this.process.config.contentHeight&&(this.process.done=!0);this.process.content="";this.process.target.taketori.ttb=!0;this.process.target.taketori.alt=
a;this.process.target.taketori.config=this.configClone(this.process.currentConfig);this.process.target.taketori.clientWidth=this.process.target.clientWidth;this.process.target.taketori.windowHeight=this.windowHeight}this.makeClipboard(this.process.target)}},fixMargin:function(a,b,c,d,e){d||(d=0);this.isWritingModeReady?d&&(e?a.style.marginBottom=d+"px":a.style.paddingBottom=d+"px"):(a.style.marginTop="-"+c+"px",a.style.marginRight=c-b-d+"px",a.style.marginBottom=b+d+"px",a.style.marginLeft=0,!e&&
d&&(a.style.paddingRight=d+"px"))},refresh:function(){if(this.isLegacy)return this;this.init();for(var a=0;a<this.targetElements.length;a++){var b=this.targetElements[a];if(b&&b.taketori&&b.taketori.alt&&b.taketori.ttb&&(b.clientWidth!=b.taketori.clientWidth||b.taketori.windowHeight!=this.windowHeight))if(this.setCurrentConfig(b,b.taketori.config),this.process.isBreakable)this.toggle(b,!0,!0),this.make(b,!0);else{var c=b.firstChild,d;c&&(this.process.isMultiColumnEnabled&&(c.style.overflow="auto"),
b.clientWidth!=b.taketori.clientWidth&&(b.taketori.clientWidth=b.clientWidth,this.isWritingModeReady?c.style.width=this.process.config.width+"px":c.style.height=this.process.config.width+"px"),b.taketori.windowHeight!=this.windowHeight&&(this.process.isMultiColumnEnabled?(d=this.process.config.height,c.style.MozColumnWidth=d+"px",c.style.webkitColumnWidth=d+"px",c.style.OColumnWidth=d+"px",c.style.columnWidth=d+"px"):this.isWritingModeReady?(c.style.height=this.process.config.height+"px",c.clientHeight<
c.scrollHeight&&(c.style.height=c.scrollHeight+"px")):(d=this.process.config.height,c.style.width=d+"px",c.clientWidth<c.scrollWidth&&(d=c.scrollWidth,c.style.width=d+"px")),b.taketori.windowHeight=this.windowHeight),this.process.isMultiColumnEnabled?(this.isWritingModeReady?c.style.height=this.process.config.height+"px":c.style.width=this.process.config.height+"px",this.setMultiColumnWidth(c)):this.isWritingModeReady||this.fixMargin(c,d,this.process.config.width,this.process.config.gap,this.process.config.multiColumnEnabled))}}},
toggle:function(a,b,c,d){if(this.isLegacy||this.isVerticalTextElement(a)||null!=b&&(b&&(!a.taketori||!a.taketori.ttb)||!b&&a.taketori&&a.taketori.ttb))return this;this.init();a.taketori&&a.taketori.alt&&(a.taketori.ttb||a.clientWidth==a.taketori.clientWidth&&a.taketori.windowHeight==this.windowHeight)?(b=a.innerHTML,a.innerHTML=a.taketori.alt,a.taketori.ttb?this.removeTaketoriClassName(a):(this.setTaketoriClassName(a),c=!0),c?(a.taketori.alt=(d||this.config.cacheDisabled)&&a.taketori.ttb?null:b,a.taketori.ttb=
a.taketori.ttb?!1:!0,a.taketori.clientWidth=a.clientWidth,a.taketori.windowHeight=this.windowHeight):(this.removeTarget(a),a.taketori=null)):(this.appendTarget(a),this.make(a,!1));return this},clear:function(a){this.toggle(a,!0,!0,!0)}};
